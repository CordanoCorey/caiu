/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { compareNumbers } from './utils';
/**
 * @template T
 */
export class TreeItem {
    /**
     * @param {?} item
     * @param {?=} parent
     */
    constructor(item, parent) {
        this.item = item;
        this.parent = parent;
        this.id = 0;
        this.order = 0;
        this.parentId = 0;
        this.treeId = 0;
        this.index = 0;
    }
    /**
     * @template T
     * @param {?} item
     * @return {?}
     */
    static Build(item) {
        return /** @type {?} */ ({
            item: item,
            id: item['id'],
            order: item['order'],
            parentId: item['parentId']
        });
    }
    /**
     * @return {?}
     */
    get hasParent() {
        return this.parentId ? true : false;
    }
    /**
     * @return {?}
     */
    get sortOrder() {
        return this.parentId ? this.treeId + (.1 * this.order) : this.treeId;
    }
    /**
     * @return {?}
     */
    get treeOrder() {
        return this.parentId ? this.order : 0;
    }
}
function TreeItem_tsickle_Closure_declarations() {
    /** @type {?} */
    TreeItem.prototype.id;
    /** @type {?} */
    TreeItem.prototype.order;
    /** @type {?} */
    TreeItem.prototype.parentId;
    /** @type {?} */
    TreeItem.prototype.treeId;
    /** @type {?} */
    TreeItem.prototype.index;
    /** @type {?} */
    TreeItem.prototype.item;
    /** @type {?} */
    TreeItem.prototype.parent;
}
/**
 * @template T
 */
export class Tree {
    /**
     * @param {?} _treeItems
     * @param {?} ctor
     */
    constructor(_treeItems, ctor) {
        this._treeItems = _treeItems;
        this.ctor = ctor;
        this._activeId = 0;
        this._activeIndex = -1;
    }
    /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    static FindParent(items, item) {
        return items.find(x => x.id === item.parentId) || new TreeItem(/** @type {?} */ ({}));
    }
    /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    static FindParentOrder(items, item) {
        const /** @type {?} */ parent = Tree.FindParent(items, item);
        return parent.order;
    }
    /**
     * @template T
     * @param {?} items
     * @param {?} ctor
     * @return {?}
     */
    static Build(items, ctor) {
        const /** @type {?} */ treeItems = items.reduce((acc, item) => {
            item.treeId = item.parentId ? Tree.FindParentOrder(items, item) : item.order;
            const /** @type {?} */ treeItem = Object.assign(new TreeItem(/** @type {?} */ ({})), item);
            return [...acc, treeItem];
        }, []);
        const /** @type {?} */ orderedItems = items.sort((a, b) => compareNumbers(a.sortOrder, b.sortOrder))
            .reduce((acc, treeItem, index) => {
            const /** @type {?} */ item = treeItem.item;
            const /** @type {?} */ parent = treeItem.parent;
            return [...acc, /** @type {?} */ (Object.assign(new TreeItem(item, parent), treeItem, { index: index + 1 }))];
        }, []);
        return new Tree(orderedItems, ctor);
    }
    /**
     * @return {?}
     */
    get activeId() {
        return this._activeId;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    set activeId(id) {
        this._activeId = id;
        this._activeIndex = this.getIndexById(id);
    }
    /**
     * @return {?}
     */
    get activeIndex() {
        return this._activeIndex;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    set activeIndex(index) {
        this._activeIndex = index;
        this._activeId = this.getIdByIndex(index);
    }
    /**
     * @return {?}
     */
    get copy() {
        return Object.assign(new Tree(this._treeItems, this.ctor), this);
    }
    /**
     * @return {?}
     */
    get instance() {
        return new this.ctor() || /** @type {?} */ ({});
    }
    /**
     * @return {?}
     */
    get next() {
        return this.getNext(this.activeIndex);
    }
    /**
     * @return {?}
     */
    get nextId() {
        return this.next.id;
    }
    /**
     * @return {?}
     */
    get nextIndex() {
        return this.activeIndex + 1;
    }
    /**
     * @return {?}
     */
    get previous() {
        return this.getPrevious(this.activeIndex);
    }
    /**
     * @return {?}
     */
    get previousId() {
        return this.previous.id;
    }
    /**
     * @return {?}
     */
    get previousIndex() {
        return this.activeIndex - 1;
    }
    /**
     * @return {?}
     */
    get items() {
        return this._treeItems.map(x => x.item);
    }
    /**
     * @return {?}
     */
    get treeItems() {
        return this._treeItems;
    }
    /**
     * @return {?}
     */
    get orderedItems() {
        return this.treeItems.sort((a, b) => compareNumbers(a.index, b.index));
    }
    /**
     * @return {?}
     */
    get subtrees() {
        const /** @type {?} */ trees = this.treeItems.reduce((acc, item) => {
            const /** @type {?} */ treeId = item.treeId;
            const /** @type {?} */ subitems = acc[treeId] || [];
            acc[treeId] = [...subitems, item];
            return acc;
        }, {});
        return Object.keys(trees).map(key => Tree.Build(trees[key], this.ctor));
    }
    /**
     * @return {?}
     */
    get subtreeItems() {
        return this.subtrees.map(tree => tree.treeItems.sort((a, b) => compareNumbers(a.index, b.index)));
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getIdByIndex(index) {
        const /** @type {?} */ item = this.getItemByIndex(index);
        return item.id;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getIndexById(id) {
        return this.getItemById(id).index;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getItemById(id) {
        return this.treeItems.find(item => item.id === id) || new TreeItem(this.instance);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getItemByIndex(index) {
        return this.treeItems.find(item => item.index === index) || new TreeItem(this.instance);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getNext(index) {
        return this.getItemByIndex(index + 1);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getNextId(index) {
        return this.getNext(index).id;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getPrevious(index) {
        return this.getItemByIndex(index - 1);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getPreviousId(index) {
        return this.getPrevious(index).id;
    }
}
function Tree_tsickle_Closure_declarations() {
    /** @type {?} */
    Tree.prototype._activeId;
    /** @type {?} */
    Tree.prototype._activeIndex;
    /** @type {?} */
    Tree.prototype._treeItems;
    /** @type {?} */
    Tree.prototype.ctor;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjYWl1L2xpYnJhcnkvIiwic291cmNlcyI6WyJsaWIvc2hhcmVkL3RyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxTQUFTLENBQUM7Ozs7QUFFekMsTUFBTTs7Ozs7SUFpQkYsWUFBbUIsSUFBTyxFQUFTLE1BQVU7UUFBMUIsU0FBSSxHQUFKLElBQUksQ0FBRztRQUFTLFdBQU0sR0FBTixNQUFNLENBQUk7a0JBZnhDLENBQUM7cUJBQ0UsQ0FBQzt3QkFDRSxDQUFDO3NCQUNILENBQUM7cUJBQ0YsQ0FBQztLQWFSOzs7Ozs7SUFYRCxNQUFNLENBQUMsS0FBSyxDQUFJLElBQU87UUFDbkIsTUFBTSxtQkFBYztZQUNoQixJQUFJLEVBQUUsSUFBSTtZQUNWLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2QsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUM7U0FDN0IsRUFBQztLQUNMOzs7O0lBTUQsSUFBSSxTQUFTO1FBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0tBQ3ZDOzs7O0lBRUQsSUFBSSxTQUFTO1FBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0tBQ3hFOzs7O0lBRUQsSUFBSSxTQUFTO1FBQ1QsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUN6QztDQUNKOzs7Ozs7Ozs7Ozs7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QyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztLQUMxRTs7OztJQUVELElBQUksUUFBUTtRQUNSLHVCQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUM5Qyx1QkFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMzQix1QkFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNuQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFDO1NBQ2QsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNQLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQzNFOzs7O0lBRUQsSUFBSSxZQUFZO1FBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3JHOzs7OztJQUVELFlBQVksQ0FBQyxLQUFhO1FBQ3RCLHVCQUFNLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO0tBQ2xCOzs7OztJQUVELFlBQVksQ0FBQyxFQUFVO1FBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQztLQUNyQzs7Ozs7SUFFRCxXQUFXLENBQUMsRUFBVTtRQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUN4Rjs7Ozs7SUFFRCxjQUFjLENBQUMsS0FBYTtRQUN4QixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM5Rjs7Ozs7SUFFRCxPQUFPLENBQUMsS0FBYTtRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDekM7Ozs7O0lBRUQsU0FBUyxDQUFDLEtBQWE7UUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO0tBQ2pDOzs7OztJQUVELFdBQVcsQ0FBQyxLQUFhO1FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztLQUN6Qzs7Ozs7SUFFRCxhQUFhLENBQUMsS0FBYTtRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUM7S0FDckM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFR5cGVDb25zdHJ1Y3RvciB9IGZyb20gJy4vbW9kZWxzJztcclxuaW1wb3J0IHsgY29tcGFyZU51bWJlcnMgfSBmcm9tICcuL3V0aWxzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBUcmVlSXRlbTxUPiB7XHJcblxyXG4gICAgaWQgPSAwO1xyXG4gICAgb3JkZXIgPSAwO1xyXG4gICAgcGFyZW50SWQgPSAwO1xyXG4gICAgdHJlZUlkID0gMDtcclxuICAgIGluZGV4ID0gMDtcclxuXHJcbiAgICBzdGF0aWMgQnVpbGQ8VD4oaXRlbTogVCk6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gPFRyZWVJdGVtPFQ+PntcclxuICAgICAgICAgICAgaXRlbTogaXRlbSxcclxuICAgICAgICAgICAgaWQ6IGl0ZW1bJ2lkJ10sXHJcbiAgICAgICAgICAgIG9yZGVyOiBpdGVtWydvcmRlciddLFxyXG4gICAgICAgICAgICBwYXJlbnRJZDogaXRlbVsncGFyZW50SWQnXVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGl0ZW06IFQsIHB1YmxpYyBwYXJlbnQ/OiBUKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGdldCBoYXNQYXJlbnQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50SWQgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNvcnRPcmRlcigpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudElkID8gdGhpcy50cmVlSWQgKyAoLjEgKiB0aGlzLm9yZGVyKSA6IHRoaXMudHJlZUlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0cmVlT3JkZXIoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnRJZCA/IHRoaXMub3JkZXIgOiAwO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHJlZTxUPiB7XHJcbiAgICBfYWN0aXZlSWQgPSAwO1xyXG4gICAgX2FjdGl2ZUluZGV4ID0gLTE7XHJcblxyXG4gICAgc3RhdGljIEZpbmRQYXJlbnQ8VD4oaXRlbXM6IFRyZWVJdGVtPFQ+W10sIGl0ZW06IFRyZWVJdGVtPFQ+KTogVHJlZUl0ZW08VD4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtcy5maW5kKHggPT4geC5pZCA9PT0gaXRlbS5wYXJlbnRJZCkgfHwgbmV3IFRyZWVJdGVtPFQ+KDxUPnt9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgRmluZFBhcmVudE9yZGVyPFQ+KGl0ZW1zOiBUcmVlSXRlbTxUPltdLCBpdGVtOiBUcmVlSXRlbTxUPik6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgcGFyZW50ID0gVHJlZS5GaW5kUGFyZW50KGl0ZW1zLCBpdGVtKTtcclxuICAgICAgICByZXR1cm4gcGFyZW50Lm9yZGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBCdWlsZDxUPihpdGVtczogVHJlZUl0ZW08VD5bXSwgY3RvcjogVHlwZUNvbnN0cnVjdG9yPFQ+KTogVHJlZTxUPiB7XHJcbiAgICAgICAgY29uc3QgdHJlZUl0ZW1zID0gaXRlbXMucmVkdWNlKChhY2MsIGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgaXRlbS50cmVlSWQgPSBpdGVtLnBhcmVudElkID8gVHJlZS5GaW5kUGFyZW50T3JkZXIoaXRlbXMsIGl0ZW0pIDogaXRlbS5vcmRlcjtcclxuICAgICAgICAgICAgY29uc3QgdHJlZUl0ZW0gPSBPYmplY3QuYXNzaWduKG5ldyBUcmVlSXRlbTxUPig8VD57fSksIGl0ZW0pO1xyXG4gICAgICAgICAgICByZXR1cm4gWy4uLmFjYywgdHJlZUl0ZW1dO1xyXG4gICAgICAgIH0sIFtdKTtcclxuICAgICAgICBjb25zdCBvcmRlcmVkSXRlbXMgPSBpdGVtcy5zb3J0KChhLCBiKSA9PiBjb21wYXJlTnVtYmVycyhhLnNvcnRPcmRlciwgYi5zb3J0T3JkZXIpKVxyXG4gICAgICAgICAgICAucmVkdWNlKChhY2M6IFRyZWVJdGVtPFQ+W10sIHRyZWVJdGVtOiBUcmVlSXRlbTxUPiwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRyZWVJdGVtLml0ZW07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0cmVlSXRlbS5wYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gWy4uLmFjYywgPFRyZWVJdGVtPFQ+Pk9iamVjdC5hc3NpZ24obmV3IFRyZWVJdGVtPFQ+KGl0ZW0sIHBhcmVudCksIHRyZWVJdGVtLCB7IGluZGV4OiBpbmRleCArIDEgfSldO1xyXG4gICAgICAgICAgICB9LCBbXSk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUcmVlPFQ+KG9yZGVyZWRJdGVtcywgY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfdHJlZUl0ZW1zOiBUcmVlSXRlbTxUPltdLCBwdWJsaWMgY3RvcjogVHlwZUNvbnN0cnVjdG9yPFQ+KSB7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFjdGl2ZUlkKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUlkO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBhY3RpdmVJZChpZDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSWQgPSBpZDtcclxuICAgICAgICB0aGlzLl9hY3RpdmVJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgYWN0aXZlSW5kZXgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlSW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGFjdGl2ZUluZGV4KGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl9hY3RpdmVJbmRleCA9IGluZGV4O1xyXG4gICAgICAgIHRoaXMuX2FjdGl2ZUlkID0gdGhpcy5nZXRJZEJ5SW5kZXgoaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb3B5KCk6IFRyZWU8VD4ge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBUcmVlPFQ+KHRoaXMuX3RyZWVJdGVtcywgdGhpcy5jdG9yKSwgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGluc3RhbmNlKCk6IFQge1xyXG4gICAgICAgIHJldHVybiBuZXcgdGhpcy5jdG9yKCkgfHwgPFQ+e307XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG5leHQoKTogVHJlZUl0ZW08VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldE5leHQodGhpcy5hY3RpdmVJbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG5leHRJZCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5leHQuaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG5leHRJbmRleCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUluZGV4ICsgMTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcHJldmlvdXMoKTogVHJlZUl0ZW08VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFByZXZpb3VzKHRoaXMuYWN0aXZlSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwcmV2aW91c0lkKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJldmlvdXMuaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHByZXZpb3VzSW5kZXgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVJbmRleCAtIDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGl0ZW1zKCk6IFRbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyZWVJdGVtcy5tYXAoeCA9PiB4Lml0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0cmVlSXRlbXMoKTogVHJlZUl0ZW08VD5bXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyZWVJdGVtcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgb3JkZXJlZEl0ZW1zKCk6IFRyZWVJdGVtPFQ+W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRyZWVJdGVtcy5zb3J0KChhLCBiKSA9PiBjb21wYXJlTnVtYmVycyhhLmluZGV4LCBiLmluZGV4KSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHN1YnRyZWVzKCk6IFRyZWU8VD5bXSB7XHJcbiAgICAgICAgY29uc3QgdHJlZXMgPSB0aGlzLnRyZWVJdGVtcy5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0cmVlSWQgPSBpdGVtLnRyZWVJZDtcclxuICAgICAgICAgICAgY29uc3Qgc3ViaXRlbXMgPSBhY2NbdHJlZUlkXSB8fCBbXTtcclxuICAgICAgICAgICAgYWNjW3RyZWVJZF0gPSBbLi4uc3ViaXRlbXMsIGl0ZW1dO1xyXG4gICAgICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgICAgIH0sIHt9KTtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModHJlZXMpLm1hcChrZXkgPT4gVHJlZS5CdWlsZCh0cmVlc1trZXldLCB0aGlzLmN0b3IpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc3VidHJlZUl0ZW1zKCk6IFRyZWVJdGVtPFQ+W11bXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3VidHJlZXMubWFwKHRyZWUgPT4gdHJlZS50cmVlSXRlbXMuc29ydCgoYSwgYikgPT4gY29tcGFyZU51bWJlcnMoYS5pbmRleCwgYi5pbmRleCkpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRJZEJ5SW5kZXgoaW5kZXg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbUJ5SW5kZXgoaW5kZXgpO1xyXG4gICAgICAgIHJldHVybiBpdGVtLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEluZGV4QnlJZChpZDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJdGVtQnlJZChpZCkuaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SXRlbUJ5SWQoaWQ6IG51bWJlcik6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmVlSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGlkKSB8fCBuZXcgVHJlZUl0ZW08VD4odGhpcy5pbnN0YW5jZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SXRlbUJ5SW5kZXgoaW5kZXg6IG51bWJlcik6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmVlSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KSB8fCBuZXcgVHJlZUl0ZW08VD4odGhpcy5pbnN0YW5jZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TmV4dChpbmRleDogbnVtYmVyKTogVHJlZUl0ZW08VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZW1CeUluZGV4KGluZGV4ICsgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TmV4dElkKGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldE5leHQoaW5kZXgpLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFByZXZpb3VzKGluZGV4OiBudW1iZXIpOiBUcmVlSXRlbTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUJ5SW5kZXgoaW5kZXggLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQcmV2aW91c0lkKGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFByZXZpb3VzKGluZGV4KS5pZDtcclxuICAgIH1cclxufVxyXG4iXX0=