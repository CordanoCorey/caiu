/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Output, EventEmitter, forwardRef, Input, ViewEncapsulation, ChangeDetectorRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { BehaviorSubject } from 'rxjs';
import { FileUpload } from './file-upload.model';
import { Ordering } from '../../shared/ordering';
import { build, guid, equals } from '../../shared/utils';
export const /** @type {?} */ FILE_UPLOAD_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => FileUploadComponent),
    multi: true
};
export class FileUploadComponent {
    /**
     * @param {?} ref
     */
    constructor(ref) {
        this.ref = ref;
        this.id = `files-${guid()}`;
        this.multiple = false;
        this.ordered = true;
        this.preview = true;
        this.upload = new EventEmitter();
        this.changes$ = new BehaviorSubject(new FileUpload());
        this.ordering = new Ordering([], FileUpload, 'order', 'name');
    }
    /**
     * @return {?}
     */
    get activeFile() {
        return this.hasUploads ? this.uploads[0] : new FileUpload();
    }
    /**
     * @return {?}
     */
    get hasUploads() {
        return this.uploads.length > 0;
    }
    /**
     * @return {?}
     */
    get showMultiple() {
        return this.preview && this.multiple;
    }
    /**
     * @return {?}
     */
    get uploads() {
        return this.ordering.items.filter(upload => upload.name !== '');
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set uploads(value) {
        this.ordering.updateItems(value.filter(upload => upload.name !== ''));
        this.onChange(this.uploads);
    }
    /**
     * @return {?}
     */
    get orderedUploads() {
        return this.uploads;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.changes$.subscribe(upload => {
            this.onUpload(upload);
        });
    }
    /**
     * @param {?} f
     * @return {?}
     */
    add(f) {
        if (!this.multiple && this.hasUploads) {
            this.remove();
        }
        this.uploads = this.ordering.addItem(f);
    }
    /**
     * @return {?}
     */
    emit() {
        if (this.value.length > 0) {
            if (this.multiple) {
                this.upload.emit(this.value);
            }
            else {
                this.upload.emit(this.value[0]);
            }
        }
    }
    /**
     * @param {?} f
     * @return {?}
     */
    moveUp(f) {
        this.uploads = this.ordering.moveUp(f);
    }
    /**
     * @param {?} f
     * @return {?}
     */
    moveDown(f) {
        this.uploads = this.ordering.moveDown(f);
    }
    /**
     * @param {?=} f
     * @return {?}
     */
    remove(f) {
        const /** @type {?} */ removeFile = f || this.activeFile;
        this.uploads = this.ordering.removeItem(removeFile);
    }
    /**
     * @param {?} f
     * @return {?}
     */
    update(f) {
        const /** @type {?} */ index = this.uploads.findIndex(item => item['name'] === f.name);
        if (index === -1) {
            this.add(f);
        }
        else {
            this.uploads = this.uploads.map((x, i) => i === index ? build(FileUpload, f, { order: x.order }) : x);
            this.ref.detectChanges();
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onModelChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouch = fn;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        this.value = value;
        this.uploadAll(value);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    onChange(value) {
        if (!equals(this.value, value)) {
            this.value = value;
            if (value.every(x => x.readyState === 'DONE')) {
                this.emit();
            }
            if (this.onModelChange) {
                this.onModelChange(value);
            }
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onInputChange(e) {
        const /** @type {?} */ input = event.target;
        const /** @type {?} */ files = input['files'];
        if (files && files.length > 0) {
            for (let /** @type {?} */ i = 0; i < files.length; i++) {
                this.setupReader(files[i]);
            }
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    onBlur(value) {
        this.focused = [];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    onFocus(value) {
        this.focused = value;
        this.onTouch();
    }
    /**
     * @param {?} upload
     * @return {?}
     */
    onUpload(upload) {
        const /** @type {?} */ f = build(FileUpload, upload);
        this.update(f);
    }
    /**
     * @param {?} file
     * @return {?}
     */
    setupReader(file) {
        const /** @type {?} */ reader = new FileReader();
        const /** @type {?} */ changes$ = this.changes$;
        const /** @type {?} */ upload = build(FileUpload, {
            lastModified: file['lastModified'],
            lastModifiedDate: file['lastModifiedDate'],
            name: file['name'],
            size: file['size'],
            type: file['type'],
            webkitRelativePath: file['webkitRelativePath']
        });
        reader.onload = function (e) {
            const /** @type {?} */ src = reader.result;
            const /** @type {?} */ readyState = FileUpload.GetReadyState(reader);
            changes$.next(Object.assign(upload, { src, readyState }));
        };
        reader.readAsDataURL(file);
        this.onUpload(build(FileUpload, upload, { readyState: FileUpload.GetReadyState(reader) }));
    }
    /**
     * @param {?} uploads
     * @return {?}
     */
    uploadAll(uploads) {
        uploads.forEach(upload => {
            this.onUpload(upload);
        });
    }
}
FileUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'iu-file-upload',
                template: `<div class="file-upload">
  <div class="box" fxLayout="row" fxLayoutAlign="center end">
    <p id="dragdrop-message" *ngIf="showMultiple">
      <strong>Choose files</strong>
      <span class="dragndrop"> or drag them here</span>.
    </p>
    <input id="file-upload" *ngIf="showMultiple" type="file" (change)="onInputChange($event)" [id]="id" multiple/>
    <p id="dragdrop-message" *ngIf="!multiple">
      <strong>Choose a file</strong>
      <span class="dragndrop"> or drag it here</span>.
    </p>
    <input id="file-upload" *ngIf="!multiple" type="file" (change)="onInputChange($event)" [id]="id" />
    <label [for]="id" class="custom-file-upload">
      <figure>
        <mat-icon>cloud_upload</mat-icon>
      </figure>
    </label>
  </div>
  <iu-uploads *ngIf="multiple" [uploads]="uploads" [ordered]="ordered" (moveUp)="moveUp($event)" (moveDown)="moveDown($event)"
    (remove)="remove($event)"></iu-uploads>
  <iu-upload *ngIf="preview && !multiple && hasUploads" [upload]="activeFile" [height]="200" (remove)="remove()"></iu-upload>
</div>
`,
                styles: [`.file-upload{margin:10px;padding:10px}.file-upload input[type=file]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.file-upload .box{padding:100px 20px;margin:10px;display:flex;outline:-webkit-focus-ring-color auto 5px;outline-offset:-10px;position:relative}.file-upload .box #dragdrop-message{position:absolute;top:60px;max-width:80%;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;font-size:24px}.file-upload .box #dragdrop-message span{display:inline}.file-upload .custom-file-upload{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);max-width:80%;font-size:20px;font-weight:700;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;padding:10px 20px;margin-top:50px}.file-upload .custom-file-upload figure{width:50px;height:70px;display:flex;position:relative;padding:30px;margin:0 auto 10px}.file-upload .custom-file-upload figure mat-icon{font-size:50px;height:50px;width:50px}.file-upload .custom-file-upload figure::after,.file-upload .custom-file-upload figure::before{width:0;height:0;content:'';position:absolute;top:0;right:0}.file-upload .custom-file-upload figure::before{border-left:20px solid transparent}.file-upload .custom-file-upload figure::after{border-right:20px solid transparent}`],
                providers: [FILE_UPLOAD_ACCESSOR],
                encapsulation: ViewEncapsulation.None
            },] },
];
/** @nocollapse */
FileUploadComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
FileUploadComponent.propDecorators = {
    id: [{ type: Input }],
    multiple: [{ type: Input }],
    ordered: [{ type: Input }],
    preview: [{ type: Input }],
    upload: [{ type: Output }]
};
function FileUploadComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    FileUploadComponent.prototype.id;
    /** @type {?} */
    FileUploadComponent.prototype.multiple;
    /** @type {?} */
    FileUploadComponent.prototype.ordered;
    /** @type {?} */
    FileUploadComponent.prototype.preview;
    /** @type {?} */
    FileUploadComponent.prototype.upload;
    /** @type {?} */
    FileUploadComponent.prototype.onModelChange;
    /** @type {?} */
    FileUploadComponent.prototype.onTouch;
    /** @type {?} */
    FileUploadComponent.prototype.changes$;
    /** @type {?} */
    FileUploadComponent.prototype.value;
    /** @type {?} */
    FileUploadComponent.prototype.focused;
    /** @type {?} */
    FileUploadComponent.prototype.ordering;
    /** @type {?} */
    FileUploadComponent.prototype.ref;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbGUtdXBsb2FkL2ZpbGUtdXBsb2FkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBRUwsaUJBQWlCLEVBQ2pCLGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV2QyxPQUFPLEVBQUUsVUFBVSxFQUFpQixNQUFNLHFCQUFxQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUV6RCxNQUFNLENBQUMsdUJBQU0sb0JBQW9CLEdBQVE7SUFDdkMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixDQUFDO0lBQ2xELEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQThCRixNQUFNOzs7O0lBY0osWUFBb0IsR0FBc0I7UUFBdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7a0JBWjVCLFNBQVMsSUFBSSxFQUFFLEVBQUU7d0JBQ1gsS0FBSzt1QkFDTixJQUFJO3VCQUNKLElBQUk7c0JBQ0osSUFBSSxZQUFZLEVBQTZCO3dCQUd4QixJQUFJLGVBQWUsQ0FBYSxJQUFJLFVBQVUsRUFBRSxDQUFDO3dCQUd4RCxJQUFJLFFBQVEsQ0FBYSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUM7S0FFM0M7Ozs7SUFFL0MsSUFBSSxVQUFVO1FBQ1osTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksVUFBVSxFQUFFLENBQUM7S0FDN0Q7Ozs7SUFFRCxJQUFJLFVBQVU7UUFDWixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0tBQ2hDOzs7O0lBRUQsSUFBSSxZQUFZO1FBQ2QsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQTtLQUNyQzs7OztJQUVELElBQUksT0FBTztRQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0tBQ2pFOzs7OztJQUVELElBQUksT0FBTyxDQUFDLEtBQW1CO1FBQzdCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7S0FDN0I7Ozs7SUFFRCxJQUFJLGNBQWM7UUFDaEIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7S0FDckI7Ozs7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN2QixDQUFDLENBQUM7S0FDSjs7Ozs7SUFFRCxHQUFHLENBQUMsQ0FBYTtRQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDZjtRQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDekM7Ozs7SUFFRCxJQUFJO1FBQ0YsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDbEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQzlCO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2pDO1NBQ0Y7S0FDRjs7Ozs7SUFFRCxNQUFNLENBQUMsQ0FBYTtRQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3hDOzs7OztJQUVELFFBQVEsQ0FBQyxDQUFhO1FBQ3BCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDMUM7Ozs7O0lBRUQsTUFBTSxDQUFDLENBQWM7UUFDbkIsdUJBQU0sVUFBVSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDckQ7Ozs7O0lBRUQsTUFBTSxDQUFDLENBQWE7UUFDbEIsdUJBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RSxFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDYjtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQzFCO0tBQ0Y7Ozs7O0lBRUQsZ0JBQWdCLENBQUMsRUFBWTtRQUMzQixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztLQUN6Qjs7Ozs7SUFFRCxpQkFBaUIsQ0FBQyxFQUFZO1FBQzVCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO0tBQ25COzs7OztJQUVELFVBQVUsQ0FBQyxLQUFtQjtRQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ3ZCOzs7OztJQUVELFFBQVEsQ0FBQyxLQUFtQjtRQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztZQUNuQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNiO1lBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDM0I7U0FDRjtLQUNGOzs7OztJQUVELGFBQWEsQ0FBQyxDQUFNO1FBQ2xCLHVCQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzNCLHVCQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0IsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixHQUFHLENBQUMsQ0FBQyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3RDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDNUI7U0FDRjtLQUNGOzs7OztJQUVELE1BQU0sQ0FBQyxLQUFtQjtRQUN4QixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztLQUNuQjs7Ozs7SUFFRCxPQUFPLENBQUMsS0FBbUI7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQ2hCOzs7OztJQUVELFFBQVEsQ0FBQyxNQUFrQjtRQUN6Qix1QkFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2hCOzs7OztJQUVELFdBQVcsQ0FBQyxJQUFVO1FBQ3BCLHVCQUFNLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQ2hDLHVCQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQy9CLHVCQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFO1lBQy9CLFlBQVksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ2xDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztZQUMxQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNsQixJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNsQixJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNsQixrQkFBa0IsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUM7U0FDL0MsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQU07WUFDOUIsdUJBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDMUIsdUJBQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDcEQsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDM0QsQ0FBQztRQUNGLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzVGOzs7OztJQUVELFNBQVMsQ0FBQyxPQUFxQjtRQUM3QixPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDdkIsQ0FBQyxDQUFDO0tBQ0o7OztZQTdMRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBc0JYO2dCQUNDLE1BQU0sRUFBRSxDQUFDLDAxQ0FBMDFDLENBQUM7Z0JBQ3AyQyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDakMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7YUFDdEM7Ozs7WUExQ0MsaUJBQWlCOzs7aUJBNkNoQixLQUFLO3VCQUNMLEtBQUs7c0JBQ0wsS0FBSztzQkFDTCxLQUFLO3FCQUNMLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIGZvcndhcmRSZWYsXHJcbiAgSW5wdXQsXHJcbiAgT25Jbml0LFxyXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxyXG4gIENoYW5nZURldGVjdG9yUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBGaWxlVXBsb2FkLCBnZXRSZWFkeVN0YXRlIH0gZnJvbSAnLi9maWxlLXVwbG9hZC5tb2RlbCc7XHJcbmltcG9ydCB7IE9yZGVyaW5nIH0gZnJvbSAnLi4vLi4vc2hhcmVkL29yZGVyaW5nJztcclxuaW1wb3J0IHsgYnVpbGQsIGd1aWQsIGVxdWFscyB9IGZyb20gJy4uLy4uL3NoYXJlZC91dGlscyc7XHJcblxyXG5leHBvcnQgY29uc3QgRklMRV9VUExPQURfQUNDRVNTT1I6IGFueSA9IHtcclxuICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGaWxlVXBsb2FkQ29tcG9uZW50KSxcclxuICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2l1LWZpbGUtdXBsb2FkJyxcclxuICB0ZW1wbGF0ZTogYDxkaXYgY2xhc3M9XCJmaWxlLXVwbG9hZFwiPlxyXG4gIDxkaXYgY2xhc3M9XCJib3hcIiBmeExheW91dD1cInJvd1wiIGZ4TGF5b3V0QWxpZ249XCJjZW50ZXIgZW5kXCI+XHJcbiAgICA8cCBpZD1cImRyYWdkcm9wLW1lc3NhZ2VcIiAqbmdJZj1cInNob3dNdWx0aXBsZVwiPlxyXG4gICAgICA8c3Ryb25nPkNob29zZSBmaWxlczwvc3Ryb25nPlxyXG4gICAgICA8c3BhbiBjbGFzcz1cImRyYWduZHJvcFwiPiBvciBkcmFnIHRoZW0gaGVyZTwvc3Bhbj4uXHJcbiAgICA8L3A+XHJcbiAgICA8aW5wdXQgaWQ9XCJmaWxlLXVwbG9hZFwiICpuZ0lmPVwic2hvd011bHRpcGxlXCIgdHlwZT1cImZpbGVcIiAoY2hhbmdlKT1cIm9uSW5wdXRDaGFuZ2UoJGV2ZW50KVwiIFtpZF09XCJpZFwiIG11bHRpcGxlLz5cclxuICAgIDxwIGlkPVwiZHJhZ2Ryb3AtbWVzc2FnZVwiICpuZ0lmPVwiIW11bHRpcGxlXCI+XHJcbiAgICAgIDxzdHJvbmc+Q2hvb3NlIGEgZmlsZTwvc3Ryb25nPlxyXG4gICAgICA8c3BhbiBjbGFzcz1cImRyYWduZHJvcFwiPiBvciBkcmFnIGl0IGhlcmU8L3NwYW4+LlxyXG4gICAgPC9wPlxyXG4gICAgPGlucHV0IGlkPVwiZmlsZS11cGxvYWRcIiAqbmdJZj1cIiFtdWx0aXBsZVwiIHR5cGU9XCJmaWxlXCIgKGNoYW5nZSk9XCJvbklucHV0Q2hhbmdlKCRldmVudClcIiBbaWRdPVwiaWRcIiAvPlxyXG4gICAgPGxhYmVsIFtmb3JdPVwiaWRcIiBjbGFzcz1cImN1c3RvbS1maWxlLXVwbG9hZFwiPlxyXG4gICAgICA8ZmlndXJlPlxyXG4gICAgICAgIDxtYXQtaWNvbj5jbG91ZF91cGxvYWQ8L21hdC1pY29uPlxyXG4gICAgICA8L2ZpZ3VyZT5cclxuICAgIDwvbGFiZWw+XHJcbiAgPC9kaXY+XHJcbiAgPGl1LXVwbG9hZHMgKm5nSWY9XCJtdWx0aXBsZVwiIFt1cGxvYWRzXT1cInVwbG9hZHNcIiBbb3JkZXJlZF09XCJvcmRlcmVkXCIgKG1vdmVVcCk9XCJtb3ZlVXAoJGV2ZW50KVwiIChtb3ZlRG93bik9XCJtb3ZlRG93bigkZXZlbnQpXCJcclxuICAgIChyZW1vdmUpPVwicmVtb3ZlKCRldmVudClcIj48L2l1LXVwbG9hZHM+XHJcbiAgPGl1LXVwbG9hZCAqbmdJZj1cInByZXZpZXcgJiYgIW11bHRpcGxlICYmIGhhc1VwbG9hZHNcIiBbdXBsb2FkXT1cImFjdGl2ZUZpbGVcIiBbaGVpZ2h0XT1cIjIwMFwiIChyZW1vdmUpPVwicmVtb3ZlKClcIj48L2l1LXVwbG9hZD5cclxuPC9kaXY+XHJcbmAsXHJcbiAgc3R5bGVzOiBbYC5maWxlLXVwbG9hZHttYXJnaW46MTBweDtwYWRkaW5nOjEwcHh9LmZpbGUtdXBsb2FkIGlucHV0W3R5cGU9ZmlsZV17d2lkdGg6LjFweDtoZWlnaHQ6LjFweDtvcGFjaXR5OjA7b3ZlcmZsb3c6aGlkZGVuO3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6LTF9LmZpbGUtdXBsb2FkIC5ib3h7cGFkZGluZzoxMDBweCAyMHB4O21hcmdpbjoxMHB4O2Rpc3BsYXk6ZmxleDtvdXRsaW5lOi13ZWJraXQtZm9jdXMtcmluZy1jb2xvciBhdXRvIDVweDtvdXRsaW5lLW9mZnNldDotMTBweDtwb3NpdGlvbjpyZWxhdGl2ZX0uZmlsZS11cGxvYWQgLmJveCAjZHJhZ2Ryb3AtbWVzc2FnZXtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6NjBweDttYXgtd2lkdGg6ODAlO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwO2N1cnNvcjpwb2ludGVyO2Rpc3BsYXk6aW5saW5lLWJsb2NrO292ZXJmbG93OmhpZGRlbjtmb250LXNpemU6MjRweH0uZmlsZS11cGxvYWQgLmJveCAjZHJhZ2Ryb3AtbWVzc2FnZSBzcGFue2Rpc3BsYXk6aW5saW5lfS5maWxlLXVwbG9hZCAuY3VzdG9tLWZpbGUtdXBsb2Fke2JveC1zaGFkb3c6MCAycHggMXB4IC0xcHggcmdiYSgwLDAsMCwuMiksMCAxcHggMXB4IDAgcmdiYSgwLDAsMCwuMTQpLDAgMXB4IDNweCAwIHJnYmEoMCwwLDAsLjEyKTttYXgtd2lkdGg6ODAlO2ZvbnQtc2l6ZToyMHB4O2ZvbnQtd2VpZ2h0OjcwMDt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzO3doaXRlLXNwYWNlOm5vd3JhcDtjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmlubGluZS1ibG9jaztvdmVyZmxvdzpoaWRkZW47cGFkZGluZzoxMHB4IDIwcHg7bWFyZ2luLXRvcDo1MHB4fS5maWxlLXVwbG9hZCAuY3VzdG9tLWZpbGUtdXBsb2FkIGZpZ3VyZXt3aWR0aDo1MHB4O2hlaWdodDo3MHB4O2Rpc3BsYXk6ZmxleDtwb3NpdGlvbjpyZWxhdGl2ZTtwYWRkaW5nOjMwcHg7bWFyZ2luOjAgYXV0byAxMHB4fS5maWxlLXVwbG9hZCAuY3VzdG9tLWZpbGUtdXBsb2FkIGZpZ3VyZSBtYXQtaWNvbntmb250LXNpemU6NTBweDtoZWlnaHQ6NTBweDt3aWR0aDo1MHB4fS5maWxlLXVwbG9hZCAuY3VzdG9tLWZpbGUtdXBsb2FkIGZpZ3VyZTo6YWZ0ZXIsLmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWQgZmlndXJlOjpiZWZvcmV7d2lkdGg6MDtoZWlnaHQ6MDtjb250ZW50OicnO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO3JpZ2h0OjB9LmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWQgZmlndXJlOjpiZWZvcmV7Ym9yZGVyLWxlZnQ6MjBweCBzb2xpZCB0cmFuc3BhcmVudH0uZmlsZS11cGxvYWQgLmN1c3RvbS1maWxlLXVwbG9hZCBmaWd1cmU6OmFmdGVye2JvcmRlci1yaWdodDoyMHB4IHNvbGlkIHRyYW5zcGFyZW50fWBdLFxyXG4gIHByb3ZpZGVyczogW0ZJTEVfVVBMT0FEX0FDQ0VTU09SXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGaWxlVXBsb2FkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XHJcblxyXG4gIEBJbnB1dCgpIGlkID0gYGZpbGVzLSR7Z3VpZCgpfWA7XHJcbiAgQElucHV0KCkgbXVsdGlwbGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSBvcmRlcmVkID0gdHJ1ZTtcclxuICBASW5wdXQoKSBwcmV2aWV3ID0gdHJ1ZTtcclxuICBAT3V0cHV0KCkgdXBsb2FkID0gbmV3IEV2ZW50RW1pdHRlcjxGaWxlVXBsb2FkIHwgRmlsZVVwbG9hZFtdPigpO1xyXG4gIHByaXZhdGUgb25Nb2RlbENoYW5nZTogRnVuY3Rpb247XHJcbiAgcHJpdmF0ZSBvblRvdWNoOiBGdW5jdGlvbjtcclxuICBjaGFuZ2VzJDogQmVoYXZpb3JTdWJqZWN0PEZpbGVVcGxvYWQ+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxGaWxlVXBsb2FkPihuZXcgRmlsZVVwbG9hZCgpKTtcclxuICB2YWx1ZTogRmlsZVVwbG9hZFtdO1xyXG4gIGZvY3VzZWQ6IEZpbGVVcGxvYWRbXTtcclxuICBvcmRlcmluZzogT3JkZXJpbmc8RmlsZVVwbG9hZD4gPSBuZXcgT3JkZXJpbmc8RmlsZVVwbG9hZD4oW10sIEZpbGVVcGxvYWQsICdvcmRlcicsICduYW1lJyk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikgeyB9XHJcblxyXG4gIGdldCBhY3RpdmVGaWxlKCk6IEZpbGVVcGxvYWQge1xyXG4gICAgcmV0dXJuIHRoaXMuaGFzVXBsb2FkcyA/IHRoaXMudXBsb2Fkc1swXSA6IG5ldyBGaWxlVXBsb2FkKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgaGFzVXBsb2FkcygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnVwbG9hZHMubGVuZ3RoID4gMDtcclxuICB9XHJcblxyXG4gIGdldCBzaG93TXVsdGlwbGUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcmV2aWV3ICYmIHRoaXMubXVsdGlwbGVcclxuICB9XHJcblxyXG4gIGdldCB1cGxvYWRzKCk6IEZpbGVVcGxvYWRbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5vcmRlcmluZy5pdGVtcy5maWx0ZXIodXBsb2FkID0+IHVwbG9hZC5uYW1lICE9PSAnJyk7XHJcbiAgfVxyXG5cclxuICBzZXQgdXBsb2Fkcyh2YWx1ZTogRmlsZVVwbG9hZFtdKSB7XHJcbiAgICB0aGlzLm9yZGVyaW5nLnVwZGF0ZUl0ZW1zKHZhbHVlLmZpbHRlcih1cGxvYWQgPT4gdXBsb2FkLm5hbWUgIT09ICcnKSk7XHJcbiAgICB0aGlzLm9uQ2hhbmdlKHRoaXMudXBsb2Fkcyk7XHJcbiAgfVxyXG5cclxuICBnZXQgb3JkZXJlZFVwbG9hZHMoKTogRmlsZVVwbG9hZFtdIHtcclxuICAgIHJldHVybiB0aGlzLnVwbG9hZHM7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuY2hhbmdlcyQuc3Vic2NyaWJlKHVwbG9hZCA9PiB7XHJcbiAgICAgIHRoaXMub25VcGxvYWQodXBsb2FkKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkKGY6IEZpbGVVcGxvYWQpIHtcclxuICAgIGlmICghdGhpcy5tdWx0aXBsZSAmJiB0aGlzLmhhc1VwbG9hZHMpIHtcclxuICAgICAgdGhpcy5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMudXBsb2FkcyA9IHRoaXMub3JkZXJpbmcuYWRkSXRlbShmKTtcclxuICB9XHJcblxyXG4gIGVtaXQoKSB7XHJcbiAgICBpZiAodGhpcy52YWx1ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XHJcbiAgICAgICAgdGhpcy51cGxvYWQuZW1pdCh0aGlzLnZhbHVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnVwbG9hZC5lbWl0KHRoaXMudmFsdWVbMF0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlVXAoZjogRmlsZVVwbG9hZCkge1xyXG4gICAgdGhpcy51cGxvYWRzID0gdGhpcy5vcmRlcmluZy5tb3ZlVXAoZik7XHJcbiAgfVxyXG5cclxuICBtb3ZlRG93bihmOiBGaWxlVXBsb2FkKSB7XHJcbiAgICB0aGlzLnVwbG9hZHMgPSB0aGlzLm9yZGVyaW5nLm1vdmVEb3duKGYpO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKGY/OiBGaWxlVXBsb2FkKSB7XHJcbiAgICBjb25zdCByZW1vdmVGaWxlID0gZiB8fCB0aGlzLmFjdGl2ZUZpbGU7XHJcbiAgICB0aGlzLnVwbG9hZHMgPSB0aGlzLm9yZGVyaW5nLnJlbW92ZUl0ZW0ocmVtb3ZlRmlsZSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGUoZjogRmlsZVVwbG9hZCkge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnVwbG9hZHMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVsnbmFtZSddID09PSBmLm5hbWUpO1xyXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICB0aGlzLmFkZChmKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudXBsb2FkcyA9IHRoaXMudXBsb2Fkcy5tYXAoKHgsIGkpID0+IGkgPT09IGluZGV4ID8gYnVpbGQoRmlsZVVwbG9hZCwgZiwgeyBvcmRlcjogeC5vcmRlciB9KSA6IHgpO1xyXG4gICAgICB0aGlzLnJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBGdW5jdGlvbikge1xyXG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogRnVuY3Rpb24pIHtcclxuICAgIHRoaXMub25Ub3VjaCA9IGZuO1xyXG4gIH1cclxuXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogRmlsZVVwbG9hZFtdKSB7XHJcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB0aGlzLnVwbG9hZEFsbCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZSh2YWx1ZTogRmlsZVVwbG9hZFtdKSB7XHJcbiAgICBpZiAoIWVxdWFscyh0aGlzLnZhbHVlLCB2YWx1ZSkpIHtcclxuICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICBpZiAodmFsdWUuZXZlcnkoeCA9PiB4LnJlYWR5U3RhdGUgPT09ICdET05FJykpIHtcclxuICAgICAgICB0aGlzLmVtaXQoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5vbk1vZGVsQ2hhbmdlKSB7XHJcbiAgICAgICAgdGhpcy5vbk1vZGVsQ2hhbmdlKHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25JbnB1dENoYW5nZShlOiBhbnkpIHtcclxuICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgY29uc3QgZmlsZXMgPSBpbnB1dFsnZmlsZXMnXTtcclxuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB0aGlzLnNldHVwUmVhZGVyKGZpbGVzW2ldKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25CbHVyKHZhbHVlOiBGaWxlVXBsb2FkW10pIHtcclxuICAgIHRoaXMuZm9jdXNlZCA9IFtdO1xyXG4gIH1cclxuXHJcbiAgb25Gb2N1cyh2YWx1ZTogRmlsZVVwbG9hZFtdKSB7XHJcbiAgICB0aGlzLmZvY3VzZWQgPSB2YWx1ZTtcclxuICAgIHRoaXMub25Ub3VjaCgpO1xyXG4gIH1cclxuXHJcbiAgb25VcGxvYWQodXBsb2FkOiBGaWxlVXBsb2FkKSB7XHJcbiAgICBjb25zdCBmID0gYnVpbGQoRmlsZVVwbG9hZCwgdXBsb2FkKTtcclxuICAgIHRoaXMudXBkYXRlKGYpO1xyXG4gIH1cclxuXHJcbiAgc2V0dXBSZWFkZXIoZmlsZTogRmlsZSkge1xyXG4gICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIGNvbnN0IGNoYW5nZXMkID0gdGhpcy5jaGFuZ2VzJDtcclxuICAgIGNvbnN0IHVwbG9hZCA9IGJ1aWxkKEZpbGVVcGxvYWQsIHtcclxuICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlWydsYXN0TW9kaWZpZWQnXSxcclxuICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogZmlsZVsnbGFzdE1vZGlmaWVkRGF0ZSddLFxyXG4gICAgICBuYW1lOiBmaWxlWyduYW1lJ10sXHJcbiAgICAgIHNpemU6IGZpbGVbJ3NpemUnXSxcclxuICAgICAgdHlwZTogZmlsZVsndHlwZSddLFxyXG4gICAgICB3ZWJraXRSZWxhdGl2ZVBhdGg6IGZpbGVbJ3dlYmtpdFJlbGF0aXZlUGF0aCddXHJcbiAgICB9KTtcclxuICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZTogYW55KSB7XHJcbiAgICAgIGNvbnN0IHNyYyA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgIGNvbnN0IHJlYWR5U3RhdGUgPSBGaWxlVXBsb2FkLkdldFJlYWR5U3RhdGUocmVhZGVyKTtcclxuICAgICAgY2hhbmdlcyQubmV4dChPYmplY3QuYXNzaWduKHVwbG9hZCwgeyBzcmMsIHJlYWR5U3RhdGUgfSkpO1xyXG4gICAgfTtcclxuICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgdGhpcy5vblVwbG9hZChidWlsZChGaWxlVXBsb2FkLCB1cGxvYWQsIHsgcmVhZHlTdGF0ZTogRmlsZVVwbG9hZC5HZXRSZWFkeVN0YXRlKHJlYWRlcikgfSkpO1xyXG4gIH1cclxuXHJcbiAgdXBsb2FkQWxsKHVwbG9hZHM6IEZpbGVVcGxvYWRbXSkge1xyXG4gICAgdXBsb2Fkcy5mb3JFYWNoKHVwbG9hZCA9PiB7XHJcbiAgICAgIHRoaXMub25VcGxvYWQodXBsb2FkKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuIl19