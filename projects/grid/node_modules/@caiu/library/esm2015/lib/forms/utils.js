/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { FormBuilder } from '@angular/forms';
import { FormArray } from './models';
import { getAllProps, ignoreKey, inArray, build, getValue } from '../shared/utils';
/**
 * @param {?} fb
 * @param {?} value
 * @return {?}
 */
export function buildAbstractControl(fb, value) {
    return isGroupValue(value) ? fb.group(buildControlsConfig(value, fb)) : fb.control(value);
}
/**
 * Construct form builder and initialize new form array
 * @template T
 * @param {?} ctor
 * @param {?=} validator
 * @param {?=} asyncValidator
 * @return {?}
 */
export function buildArrayFromType(ctor, validator, asyncValidator) {
    const /** @type {?} */ fb = new FormBuilder();
    return FormArray.BuildWithType(ctor, fb, [], validator, asyncValidator);
}
/**
 * @param {?} fb
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function buildControl(fb, model, key) {
    return isFormGroup(model, key) ?
        fb.group(buildControlsConfig(model[key], fb))
        : (isFormArray(model, key) ? buildFormArray(fb, model, key)
            : (hasValidators(model, key) ? [model[key], model['metadata'][key]['validators']]
                : [model[key]]));
}
/**
 * Construct form builder and initialize new form group.
 * @template T
 * @param {?} model
 * @return {?}
 */
export function buildControlFromModel(model) {
    const /** @type {?} */ fb = new FormBuilder();
    const /** @type {?} */ controlsConfig = buildControlsConfig(model, fb);
    return hasGroupValidators(model) ? fb.group(controlsConfig, model['metadata']['validators']) : fb.group(controlsConfig);
}
/**
 * Function to recursively construct form control config object.
 * @param {?} model
 * @param {?} fb
 * @return {?}
 */
export function buildControlsConfig(model, fb) {
    const /** @type {?} */ keys = getAllProps(model);
    const /** @type {?} */ config = {};
    return keys.filter(key => key !== 'metadata' && !ignoreKey(model, key))
        .reduce((acc, key) => Object.assign({}, acc, { [key]: buildControl(fb, model, key) }), {});
}
/**
 * Initialize new form array.
 * @template T
 * @param {?} fb
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function buildFormArray(fb, model, key) {
    const /** @type {?} */ ctor = findFormArrayType(model, key);
    const /** @type {?} */ value = model[key];
    const /** @type {?} */ controls = buildFormArrayControls(fb, value, ctor);
    return ctor ? FormArray.BuildWithType(ctor, fb, controls) : FormArray.Build(fb, []);
}
/**
 * @template T
 * @param {?} fb
 * @param {?} value
 * @param {?=} ctor
 * @return {?}
 */
export function buildFormArrayControls(fb, value, ctor) {
    return ctor ? value.map(x => buildAbstractControl(fb, getValue(build(ctor, x))))
        : value.map(x => buildAbstractControl(fb, x));
}
/**
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function findFormArrayType(model, key) {
    return model['metadata'] && model['metadata'][key] ? /** @type {?} */ (model['metadata'][key]['type']) : null;
}
/**
 * @param {?} model
 * @return {?}
 */
export function hasGroupValidators(model) {
    return model['metadata'] && model['metadata']['validators'];
}
/**
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function hasValidators(model, key) {
    return model['metadata'] && model['metadata'][key] && model['metadata'][key]['validators'];
}
/**
 * @param {?} value
 * @return {?}
 */
export function isArrayValue(value) {
    return Array.isArray(value);
}
/**
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function isFormArray(model, key) {
    return Array.isArray(model[key]) && model['metadata'] && model['metadata'][key] && model['metadata'][key]['isFormArray'];
}
/**
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function isFormControl(model, key) {
    return model['metadata'] && model['metadata']['controls'] && inArray(model['metadata']['controls'], key);
}
/**
 * @param {?} model
 * @param {?} key
 * @return {?}
 */
export function isFormGroup(model, key) {
    return model[key]
        && typeof model[key] === 'object'
        && !Array.isArray(model[key])
        && Object.keys(model[key]).length > 0
        && !isFormControl(model, key)
        && !isFormArray(model, key);
}
/**
 * @param {?} value
 * @return {?}
 */
export function isGroupValue(value) {
    return typeof value === 'object' && Object.keys(value).length > 0 && !isArrayValue(value);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AY2FpdS9saWJyYXJ5LyIsInNvdXJjZXMiOlsibGliL2Zvcm1zL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWEsV0FBVyxFQUErRCxNQUFNLGdCQUFnQixDQUFDO0FBRXJILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFckMsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7O0FBRW5GLE1BQU0sK0JBQStCLEVBQWUsRUFBRSxLQUFVO0lBQzVELE1BQU0sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Q0FDN0Y7Ozs7Ozs7OztBQUtELE1BQU0sNkJBQWdDLElBQXdCLEVBQUUsU0FBdUIsRUFBRSxjQUFpQztJQUN0SCx1QkFBTSxFQUFFLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztJQUM3QixNQUFNLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsY0FBYyxDQUFDLENBQUM7Q0FDM0U7Ozs7Ozs7QUFFRCxNQUFNLHVCQUF1QixFQUFlLEVBQUUsS0FBVSxFQUFFLEdBQVc7SUFDakUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM1QixFQUFFLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMs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Q0FBQyxDQUFDO0NBQzVHOzs7Ozs7QUFFRCxNQUFNLHNCQUFzQixLQUFVLEVBQUUsR0FBVztJQUMvQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztXQUNWLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFFBQVE7V0FDOUIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztXQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDO1dBQ2xDLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUM7V0FDMUIsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0NBQ25DOzs7OztBQUVELE1BQU0sdUJBQXVCLEtBQVU7SUFDbkMsTUFBTSxDQUFDLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7Q0FDN0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sLCBWYWxpZGF0b3JGbiwgQXN5bmNWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbmltcG9ydCB7IEZvcm1BcnJheSB9IGZyb20gJy4vbW9kZWxzJztcclxuaW1wb3J0IHsgRGljdGlvbmFyeSwgVHlwZUNvbnN0cnVjdG9yIH0gZnJvbSAnLi4vc2hhcmVkL21vZGVscyc7XHJcbmltcG9ydCB7IGdldEFsbFByb3BzLCBpZ25vcmVLZXksIGluQXJyYXksIGJ1aWxkLCBnZXRWYWx1ZSB9IGZyb20gJy4uL3NoYXJlZC91dGlscyc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRBYnN0cmFjdENvbnRyb2woZmI6IEZvcm1CdWlsZGVyLCB2YWx1ZTogYW55KTogRm9ybUdyb3VwIHwgRm9ybUFycmF5IHwgRm9ybUNvbnRyb2wge1xyXG4gICAgcmV0dXJuIGlzR3JvdXBWYWx1ZSh2YWx1ZSkgPyBmYi5ncm91cChidWlsZENvbnRyb2xzQ29uZmlnKHZhbHVlLCBmYikpIDogZmIuY29udHJvbCh2YWx1ZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb25zdHJ1Y3QgZm9ybSBidWlsZGVyIGFuZCBpbml0aWFsaXplIG5ldyBmb3JtIGFycmF5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRBcnJheUZyb21UeXBlPFQ+KGN0b3I6IFR5cGVDb25zdHJ1Y3RvcjxUPiwgdmFsaWRhdG9yPzogVmFsaWRhdG9yRm4sIGFzeW5jVmFsaWRhdG9yPzogQXN5bmNWYWxpZGF0b3JGbik6IEZvcm1BcnJheSB7XHJcbiAgICBjb25zdCBmYiA9IG5ldyBGb3JtQnVpbGRlcigpO1xyXG4gICAgcmV0dXJuIEZvcm1BcnJheS5CdWlsZFdpdGhUeXBlKGN0b3IsIGZiLCBbXSwgdmFsaWRhdG9yLCBhc3luY1ZhbGlkYXRvcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBidWlsZENvbnRyb2woZmI6IEZvcm1CdWlsZGVyLCBtb2RlbDogYW55LCBrZXk6IHN0cmluZyk6IEZvcm1Hcm91cCB8IEZvcm1BcnJheSB8IGFueVtdIHtcclxuICAgIHJldHVybiBpc0Zvcm1Hcm91cChtb2RlbCwga2V5KSA/XHJcbiAgICAgICAgZmIuZ3JvdXAoYnVpbGRDb250cm9sc0NvbmZpZyhtb2RlbFtrZXldLCBmYikpXHJcbiAgICAgICAgOiAoaXNGb3JtQXJyYXkobW9kZWwsIGtleSkgPyBidWlsZEZvcm1BcnJheShmYiwgbW9kZWwsIGtleSlcclxuICAgICAgICAgICAgOiAoaGFzVmFsaWRhdG9ycyhtb2RlbCwga2V5KSA/IFttb2RlbFtrZXldLCBtb2RlbFsnbWV0YWRhdGEnXVtrZXldWyd2YWxpZGF0b3JzJ11dXHJcbiAgICAgICAgICAgICAgICA6IFttb2RlbFtrZXldXSkpO1xyXG59XHJcblxyXG4vKipcclxuICogQ29uc3RydWN0IGZvcm0gYnVpbGRlciBhbmQgaW5pdGlhbGl6ZSBuZXcgZm9ybSBncm91cC5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBidWlsZENvbnRyb2xGcm9tTW9kZWw8VD4obW9kZWw6IFQpOiBGb3JtR3JvdXAge1xyXG4gICAgY29uc3QgZmIgPSBuZXcgRm9ybUJ1aWxkZXIoKTtcclxuICAgIGNvbnN0IGNvbnRyb2xzQ29uZmlnID0gYnVpbGRDb250cm9sc0NvbmZpZyhtb2RlbCwgZmIpO1xyXG4gICAgcmV0dXJuIGhhc0dyb3VwVmFsaWRhdG9ycyhtb2RlbCkgPyBmYi5ncm91cChjb250cm9sc0NvbmZpZywgbW9kZWxbJ21ldGFkYXRhJ11bJ3ZhbGlkYXRvcnMnXSkgOiBmYi5ncm91cChjb250cm9sc0NvbmZpZyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGdW5jdGlvbiB0byByZWN1cnNpdmVseSBjb25zdHJ1Y3QgZm9ybSBjb250cm9sIGNvbmZpZyBvYmplY3QuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRDb250cm9sc0NvbmZpZyhtb2RlbDogYW55LCBmYjogRm9ybUJ1aWxkZXIpOiBEaWN0aW9uYXJ5PGFueT4ge1xyXG4gICAgY29uc3Qga2V5cyA9IGdldEFsbFByb3BzKG1vZGVsKTtcclxuICAgIGNvbnN0IGNvbmZpZzogRGljdGlvbmFyeTxhbnk+ID0ge307XHJcbiAgICByZXR1cm4ga2V5cy5maWx0ZXIoa2V5ID0+IGtleSAhPT0gJ21ldGFkYXRhJyAmJiAhaWdub3JlS2V5KG1vZGVsLCBrZXkpKVxyXG4gICAgICAgIC5yZWR1Y2UoKGFjYywga2V5KSA9PiBPYmplY3QuYXNzaWduKHt9LCBhY2MsIHsgW2tleV06IGJ1aWxkQ29udHJvbChmYiwgbW9kZWwsIGtleSkgfSksIHt9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgbmV3IGZvcm0gYXJyYXkuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRGb3JtQXJyYXk8VD4oZmI6IEZvcm1CdWlsZGVyLCBtb2RlbDogYW55LCBrZXk6IHN0cmluZyk6IEZvcm1BcnJheSB7XHJcbiAgICBjb25zdCBjdG9yID0gZmluZEZvcm1BcnJheVR5cGUobW9kZWwsIGtleSk7XHJcbiAgICBjb25zdCB2YWx1ZSA9IG1vZGVsW2tleV07XHJcbiAgICBjb25zdCBjb250cm9scyA9IGJ1aWxkRm9ybUFycmF5Q29udHJvbHMoZmIsIHZhbHVlLCBjdG9yKTtcclxuICAgIHJldHVybiBjdG9yID8gRm9ybUFycmF5LkJ1aWxkV2l0aFR5cGUoY3RvciwgZmIsIGNvbnRyb2xzKSA6IEZvcm1BcnJheS5CdWlsZChmYiwgW10pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRGb3JtQXJyYXlDb250cm9sczxUPihmYjogRm9ybUJ1aWxkZXIsIHZhbHVlOiBUW10sIGN0b3I/OiBUeXBlQ29uc3RydWN0b3I8VD4pOiBBYnN0cmFjdENvbnRyb2xbXSB7XHJcbiAgICByZXR1cm4gY3RvciA/IHZhbHVlLm1hcCh4ID0+IGJ1aWxkQWJzdHJhY3RDb250cm9sKGZiLCBnZXRWYWx1ZShidWlsZChjdG9yLCB4KSkpKVxyXG4gICAgICAgIDogdmFsdWUubWFwKHggPT4gYnVpbGRBYnN0cmFjdENvbnRyb2woZmIsIHgpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRGb3JtQXJyYXlUeXBlKG1vZGVsOiBhbnksIGtleTogc3RyaW5nKTogVHlwZUNvbnN0cnVjdG9yPGFueT4ge1xyXG4gICAgcmV0dXJuIG1vZGVsWydtZXRhZGF0YSddICYmIG1vZGVsWydtZXRhZGF0YSddW2tleV0gP1xyXG4gICAgICAgIDxUeXBlQ29uc3RydWN0b3I8YW55Pj5tb2RlbFsnbWV0YWRhdGEnXVtrZXldWyd0eXBlJ10gOiBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFzR3JvdXBWYWxpZGF0b3JzKG1vZGVsOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBtb2RlbFsnbWV0YWRhdGEnXSAmJiBtb2RlbFsnbWV0YWRhdGEnXVsndmFsaWRhdG9ycyddO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFzVmFsaWRhdG9ycyhtb2RlbDogYW55LCBrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIG1vZGVsWydtZXRhZGF0YSddICYmIG1vZGVsWydtZXRhZGF0YSddW2tleV0gJiYgbW9kZWxbJ21ldGFkYXRhJ11ba2V5XVsndmFsaWRhdG9ycyddO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNBcnJheVZhbHVlKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRm9ybUFycmF5KG1vZGVsOiBhbnksIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShtb2RlbFtrZXldKSAmJiBtb2RlbFsnbWV0YWRhdGEnXSAmJiBtb2RlbFsnbWV0YWRhdGEnXVtrZXldICYmIG1vZGVsWydtZXRhZGF0YSddW2tleV1bJ2lzRm9ybUFycmF5J107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0Zvcm1Db250cm9sKG1vZGVsOiBhbnksIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbW9kZWxbJ21ldGFkYXRhJ10gJiYgbW9kZWxbJ21ldGFkYXRhJ11bJ2NvbnRyb2xzJ10gJiYgaW5BcnJheShtb2RlbFsnbWV0YWRhdGEnXVsnY29udHJvbHMnXSwga2V5KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRm9ybUdyb3VwKG1vZGVsOiBhbnksIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbW9kZWxba2V5XVxyXG4gICAgICAgICYmIHR5cGVvZiBtb2RlbFtrZXldID09PSAnb2JqZWN0J1xyXG4gICAgICAgICYmICFBcnJheS5pc0FycmF5KG1vZGVsW2tleV0pXHJcbiAgICAgICAgJiYgT2JqZWN0LmtleXMobW9kZWxba2V5XSkubGVuZ3RoID4gMFxyXG4gICAgICAgICYmICFpc0Zvcm1Db250cm9sKG1vZGVsLCBrZXkpXHJcbiAgICAgICAgJiYgIWlzRm9ybUFycmF5KG1vZGVsLCBrZXkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNHcm91cFZhbHVlKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPiAwICYmICFpc0FycmF5VmFsdWUodmFsdWUpO1xyXG59XHJcbiJdfQ==