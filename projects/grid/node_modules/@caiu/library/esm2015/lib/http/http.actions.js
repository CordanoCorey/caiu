/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { HttpGetPayload, HttpPutPayload, HttpPostPayload, HttpDeletePayload } from './http.models';
import { ErrorActions } from '../errors/errors.actions';
import { inArray } from '../shared/utils';
export class HttpActions {
    /**
     * @param {?} path
     * @param {?} target
     * @return {?}
     */
    static addPath(path, target) {
        const /** @type {?} */ existingMatches = target['matches'] || [];
        const /** @type {?} */ matches = inArray(existingMatches, path) ? existingMatches : [...existingMatches, path];
        return Object.assign(target, { matches: matches });
    }
    /**
     * @param {?} path
     * @param {?} payload
     * @return {?}
     */
    static matchPath(path, payload) {
        if (payload && payload['results']) {
            return Object.assign(payload, { results: HttpActions.matchPath(path, payload['results']) });
        }
        if (Array.isArray(payload)) {
            return payload.map(x => HttpActions.addPath(path, x));
        }
        return HttpActions.addPath(path, payload);
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    static buildError(payload) {
        return ErrorActions.add(payload);
    }
    /**
     * @param {?} key
     * @param {?} e
     * @return {?}
     */
    static buildErrorPayload(key, e) {
        return {
            key: key,
            error: e
        };
    }
    /**
     * @param {?} e
     * @param {?} onError
     * @return {?}
     */
    static handleError(e, onError) {
        return {
            type: onError,
            payload: e
        };
    }
    /**
     * @param {?} e
     * @param {?} outlet
     * @return {?}
     */
    static handleErrorOutlet(e, outlet) {
        return ErrorActions.addAtOutlet(e, outlet);
    }
    /**
     * @param {?} e
     * @return {?}
     */
    static handleErrorDefault(e) {
        return {
            type: HttpActions.DELETE_ERROR,
            payload: HttpActions.buildErrorPayload('lastError', e)
        };
    }
    /**
     * @param {?} path
     * @param {?} onSuccessPayload
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static delete(path, onSuccessPayload, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpDeletePayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.DELETE_SUCCESS,
            onSuccessPayload,
            onError: onError || HttpActions.DELETE_ERROR
        });
        return HttpActions.httpDelete(payload);
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    static httpDelete(payload) {
        return {
            type: HttpActions.DELETE,
            payload: payload
        };
    }
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    static deleteSuccess(model, actionType) {
        return {
            type: actionType || HttpActions.DELETE_SUCCESS,
            payload: model
        };
    }
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    static deleteError(e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    }
    /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static get(path, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpGetPayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.GET_SUCCESS,
            onError: onError || HttpActions.GET_ERROR
        });
        return HttpActions.httpGet(payload);
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    static httpGet(payload) {
        return {
            type: HttpActions.GET,
            payload: payload
        };
    }
    /**
     * @param {?} response
     * @param {?=} actionType
     * @return {?}
     */
    static getSuccess(response, actionType) {
        return {
            type: actionType || HttpActions.GET_SUCCESS,
            payload: response
        };
    }
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    static getError(e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    }
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static post(path, model, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpPostPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.POST_SUCCESS,
            onError: onError || HttpActions.POST_ERROR
        });
        return HttpActions.httpPost(payload);
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    static httpPost(payload) {
        return {
            type: HttpActions.POST,
            payload: payload
        };
    }
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static postFormUrlEncoded(path, model, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpPostPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.GET_SUCCESS,
            onError: onError || HttpActions.GET_ERROR
        });
        return {
            type: HttpActions.POST_FORM_URL_ENCODED,
            payload
        };
    }
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    static postSuccess(model, actionType) {
        return {
            type: actionType || HttpActions.POST_SUCCESS,
            payload: model
        };
    }
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    static postError(e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        else if (typeof onError === 'object') {
            return HttpActions.handleErrorOutlet(e, onError);
        }
        return HttpActions.handleErrorDefault(e);
    }
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static put(path, model, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpPutPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.PUT_SUCCESS,
            onError: onError || HttpActions.PUT_ERROR
        });
        return HttpActions.httpPut(payload);
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    static httpPut(payload) {
        return {
            type: HttpActions.PUT,
            payload: payload
        };
    }
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    static putSuccess(model, actionType) {
        return {
            type: actionType || HttpActions.PUT_SUCCESS,
            payload: model
        };
    }
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    static putError(e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    }
    /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    static search(path, onSuccess, onError) {
        const /** @type {?} */ payload = Object.assign(new HttpGetPayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.SEARCH_SUCCESS,
            onError: onError || HttpActions.SEARCH_ERROR
        });
        return {
            type: HttpActions.SEARCH,
            payload: payload
        };
    }
    /**
     * @param {?} response
     * @param {?=} actionType
     * @param {?=} path
     * @return {?}
     */
    static searchSuccess(response, actionType, path) {
        const /** @type {?} */ payload = path ? HttpActions.matchPath(path, response) : response;
        return {
            type: actionType || HttpActions.SEARCH_SUCCESS,
            payload: payload
        };
    }
}
HttpActions.DELETE = `[Http] DELETE`;
HttpActions.DELETE_SUCCESS = `[Http] DELETE Success`;
HttpActions.DELETE_ERROR = `[Http] DELETE Error`;
HttpActions.GET = `[Http] GET`;
HttpActions.GET_SUCCESS = `[Http] GET Success`;
HttpActions.GET_ERROR = `[Http] GET Error`;
HttpActions.POST = `[Http] POST`;
HttpActions.POST_SUCCESS = `[Http] POST Success`;
HttpActions.POST_ERROR = `[Http] POST Error`;
HttpActions.POST_FORM_URL_ENCODED = `[Http] POST Form URL Encoded`;
HttpActions.PUT = `[Http] PUT`;
HttpActions.PUT_SUCCESS = `[Http] PUT Success`;
HttpActions.PUT_ERROR = `[Http] PUT Error`;
HttpActions.SEARCH = `[Http] SEARCH`;
HttpActions.SEARCH_SUCCESS = `[Http] SEARCH Success`;
HttpActions.SEARCH_ERROR = `[Http] SEARCH Error`;
function HttpActions_tsickle_Closure_declarations() {
    /** @type {?} */
    HttpActions.DELETE;
    /** @type {?} */
    HttpActions.DELETE_SUCCESS;
    /** @type {?} */
    HttpActions.DELETE_ERROR;
    /** @type {?} */
    HttpActions.GET;
    /** @type {?} */
    HttpActions.GET_SUCCESS;
    /** @type {?} */
    HttpActions.GET_ERROR;
    /** @type {?} */
    HttpActions.POST;
    /** @type {?} */
    HttpActions.POST_SUCCESS;
    /** @type {?} */
    HttpActions.POST_ERROR;
    /** @type {?} */
    HttpActions.POST_FORM_URL_ENCODED;
    /** @type {?} */
    HttpActions.PUT;
    /** @type {?} */
    HttpActions.PUT_SUCCESS;
    /** @type {?} */
    HttpActions.PUT_ERROR;
    /** @type {?} */
    HttpActions.SEARCH;
    /** @type {?} */
    HttpActions.SEARCH_SUCCESS;
    /** @type {?} */
    HttpActions.SEARCH_ERROR;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5hY3Rpb25zLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9odHRwL2h0dHAuYWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVILGNBQWMsRUFDZCxjQUFjLEVBQ2QsZUFBZSxFQUVmLGlCQUFpQixFQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHeEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTFDLE1BQU07Ozs7OztJQW1CRixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNO1FBQ3ZCLHVCQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hELHVCQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDOUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7S0FDdEQ7Ozs7OztJQUVELE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLE9BQU87UUFDMUIsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUMvRjtRQUNELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxP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Ozs7O0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFZLEVBQUUsU0FBa0IsRUFBRSxPQUE4QjtRQUMxRSx1QkFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLGNBQWMsRUFBTyxFQUNuRDtZQUNJLElBQUksRUFBRSxJQUFJO1lBQ1YsU0FBUyxFQUFFLFNBQVMsSUFBSSxXQUFXLENBQUMsY0FBYztZQUNsRCxPQUFPLEVBQUUsT0FBTyxJQUFJLFdBQVcsQ0FBQyxZQUFZO1NBQy9DLENBQUMsQ0FBQztRQUNQLE1BQU0sQ0FBQztZQUNILElBQUksRUFBRSxXQUFXLENBQUMsTUFBTTtZQUN4QixPQUFPLEVBQUUsT0FBTztTQUNuQixDQUFDO0tBQ0w7Ozs7Ozs7SUFFRCxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQWEsRUFBRSxVQUFtQixFQUFFLElBQWE7UUFDbEUsdUJBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUN4RSxNQUFNLENBQUM7WUFDSCxJQUFJLEVBQUUsVUFBVSxJQUFJLFdBQVcsQ0FBQyxjQUFjO1lBQzlDLE9BQU8sRUFBRSxPQUFPO1NBQ25CLENBQUM7S0FDTDs7cUJBek9lLGVBQWU7NkJBQ1AsdUJBQXVCOzJCQUN6QixxQkFBcUI7a0JBQzlCLFlBQVk7MEJBQ0osb0JBQW9CO3dCQUN0QixrQkFBa0I7bUJBQ3ZCLGFBQWE7MkJBQ0wscUJBQXFCO3lCQUN2QixtQkFBbUI7b0NBQ1IsOEJBQThCO2tCQUNoRCxZQUFZOzBCQUNKLG9CQUFvQjt3QkFDdEIsa0JBQWtCO3FCQUNyQixlQUFlOzZCQUNQLHVCQUF1QjsyQkFDekIscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIEh0dHBBY3Rpb24sXHJcbiAgICBIdHRwR2V0UGF5bG9hZCxcclxuICAgIEh0dHBQdXRQYXlsb2FkLFxyXG4gICAgSHR0cFBvc3RQYXlsb2FkLFxyXG4gICAgSHR0cEFjdGlvblBheWxvYWQsXHJcbiAgICBIdHRwRGVsZXRlUGF5bG9hZFxyXG59IGZyb20gJy4vaHR0cC5tb2RlbHMnO1xyXG5pbXBvcnQgeyBFcnJvckFjdGlvbnMgfSBmcm9tICcuLi9lcnJvcnMvZXJyb3JzLmFjdGlvbnMnO1xyXG5pbXBvcnQgeyBFcnJvck91dGxldCwgRXJyb3JQYXlsb2FkIH0gZnJvbSAnLi4vZXJyb3JzL2Vycm9ycy5tb2RlbHMnO1xyXG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi9zdG9yZS9tb2RlbHMnO1xyXG5pbXBvcnQgeyBpbkFycmF5IH0gZnJvbSAnLi4vc2hhcmVkL3V0aWxzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBIdHRwQWN0aW9ucyB7XHJcblxyXG4gICAgc3RhdGljIERFTEVURSA9IGBbSHR0cF0gREVMRVRFYDtcclxuICAgIHN0YXRpYyBERUxFVEVfU1VDQ0VTUyA9IGBbSHR0cF0gREVMRVRFIFN1Y2Nlc3NgO1xyXG4gICAgc3RhdGljIERFTEVURV9FUlJPUiA9IGBbSHR0cF0gREVMRVRFIEVycm9yYDtcclxuICAgIHN0YXRpYyBHRVQgPSBgW0h0dHBdIEdFVGA7XHJcbiAgICBzdGF0aWMgR0VUX1NVQ0NFU1MgPSBgW0h0dHBdIEdFVCBTdWNjZXNzYDtcclxuICAgIHN0YXRpYyBHRVRfRVJST1IgPSBgW0h0dHBdIEdFVCBFcnJvcmA7XHJcbiAgICBzdGF0aWMgUE9TVCA9IGBbSHR0cF0gUE9TVGA7XHJcbiAgICBzdGF0aWMgUE9TVF9TVUNDRVNTID0gYFtIdHRwXSBQT1NUIFN1Y2Nlc3NgO1xyXG4gICAgc3RhdGljIFBPU1RfRVJST1IgPSBgW0h0dHBdIFBPU1QgRXJyb3JgO1xyXG4gICAgc3RhdGljIFBPU1RfRk9STV9VUkxfRU5DT0RFRCA9IGBbSHR0cF0gUE9TVCBGb3JtIFVSTCBFbmNvZGVkYDtcclxuICAgIHN0YXRpYyBQVVQgPSBgW0h0dHBdIFBVVGA7XHJcbiAgICBzdGF0aWMgUFVUX1NVQ0NFU1MgPSBgW0h0dHBdIFBVVCBTdWNjZXNzYDtcclxuICAgIHN0YXRpYyBQVVRfRVJST1IgPSBgW0h0dHBdIFBVVCBFcnJvcmA7XHJcbiAgICBzdGF0aWMgU0VBUkNIID0gYFtIdHRwXSBTRUFSQ0hgO1xyXG4gICAgc3RhdGljIFNFQVJDSF9TVUNDRVNTID0gYFtIdHRwXSBTRUFSQ0ggU3VjY2Vzc2A7XHJcbiAgICBzdGF0aWMgU0VBUkNIX0VSUk9SID0gYFtIdHRwXSBTRUFSQ0ggRXJyb3JgO1xyXG5cclxuICAgIHN0YXRpYyBhZGRQYXRoKHBhdGgsIHRhcmdldCkge1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nTWF0Y2hlcyA9IHRhcmdldFsnbWF0Y2hlcyddIHx8IFtdO1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBpbkFycmF5KGV4aXN0aW5nTWF0Y2hlcywgcGF0aCkgPyBleGlzdGluZ01hdGNoZXMgOiBbLi4uZXhpc3RpbmdNYXRjaGVzLCBwYXRoXTtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih0YXJnZXQsIHsgbWF0Y2hlczogbWF0Y2hlcyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgbWF0Y2hQYXRoKHBhdGgsIHBheWxvYWQpIHtcclxuICAgICAgICBpZiAocGF5bG9hZCAmJiBwYXlsb2FkWydyZXN1bHRzJ10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocGF5bG9hZCwgeyByZXN1bHRzOiBIdHRwQWN0aW9ucy5tYXRjaFBhdGgocGF0aCwgcGF5bG9hZFsncmVzdWx0cyddKSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQubWFwKHggPT4gSHR0cEFjdGlvbnMuYWRkUGF0aChwYXRoLCB4KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5hZGRQYXRoKHBhdGgsIHBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBidWlsZEVycm9yKHBheWxvYWQ6IEVycm9yUGF5bG9hZCk6IEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIEVycm9yQWN0aW9ucy5hZGQocGF5bG9hZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGJ1aWxkRXJyb3JQYXlsb2FkKGtleTogc3RyaW5nLCBlOiBFcnJvcik6IEVycm9yUGF5bG9hZCB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAga2V5OiBrZXksXHJcbiAgICAgICAgICAgIGVycm9yOiBlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaGFuZGxlRXJyb3IoZTogRXJyb3IsIG9uRXJyb3I6IHN0cmluZyk6IEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogb25FcnJvcixcclxuICAgICAgICAgICAgcGF5bG9hZDogZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhbmRsZUVycm9yT3V0bGV0KGU6IEVycm9yLCBvdXRsZXQ6IEVycm9yT3V0bGV0KTogQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4gRXJyb3JBY3Rpb25zLmFkZEF0T3V0bGV0KGUsIG91dGxldCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhbmRsZUVycm9yRGVmYXVsdChlOiBFcnJvcik6IEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogSHR0cEFjdGlvbnMuREVMRVRFX0VSUk9SLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBIdHRwQWN0aW9ucy5idWlsZEVycm9yUGF5bG9hZCgnbGFzdEVycm9yJywgZSlcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWxldGUocGF0aDogc3RyaW5nLCBvblN1Y2Nlc3NQYXlsb2FkOiBhbnksIG9uU3VjY2Vzcz86IHN0cmluZywgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24obmV3IEh0dHBEZWxldGVQYXlsb2FkPGFueT4oKSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aCxcclxuICAgICAgICAgICAgICAgIG9uU3VjY2Vzczogb25TdWNjZXNzIHx8IEh0dHBBY3Rpb25zLkRFTEVURV9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzUGF5bG9hZCxcclxuICAgICAgICAgICAgICAgIG9uRXJyb3I6IG9uRXJyb3IgfHwgSHR0cEFjdGlvbnMuREVMRVRFX0VSUk9SXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5odHRwRGVsZXRlKHBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBodHRwRGVsZXRlKHBheWxvYWQ6IEh0dHBEZWxldGVQYXlsb2FkPGFueT4pOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBIdHRwQWN0aW9ucy5ERUxFVEUsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWxldGVTdWNjZXNzKG1vZGVsOiBhbnksIGFjdGlvblR5cGU/OiBzdHJpbmcpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBhY3Rpb25UeXBlIHx8IEh0dHBBY3Rpb25zLkRFTEVURV9TVUNDRVNTLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBtb2RlbFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGRlbGV0ZUVycm9yKGU6IEVycm9yLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBBY3Rpb24ge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygb25FcnJvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yKGUsIG9uRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBlbHNlIGlmICh0eXBlb2Ygb25FcnJvciA9PT0gJ0Vycm9yT3V0bGV0Jykge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3JPdXRsZXQoZSwgb25FcnJvcik7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvckRlZmF1bHQoZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldChwYXRoOiBzdHJpbmcsIG9uU3VjY2Vzcz86IHN0cmluZywgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24obmV3IEh0dHBHZXRQYXlsb2FkPGFueT4oKSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aCxcclxuICAgICAgICAgICAgICAgIG9uU3VjY2Vzczogb25TdWNjZXNzIHx8IEh0dHBBY3Rpb25zLkdFVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgb25FcnJvcjogb25FcnJvciB8fCBIdHRwQWN0aW9ucy5HRVRfRVJST1JcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmh0dHBHZXQocGF5bG9hZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGh0dHBHZXQocGF5bG9hZDogSHR0cEdldFBheWxvYWQ8YW55Pik6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEh0dHBBY3Rpb25zLkdFVCxcclxuICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFN1Y2Nlc3MocmVzcG9uc2U6IGFueSwgYWN0aW9uVHlwZT86IHN0cmluZyk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGFjdGlvblR5cGUgfHwgSHR0cEFjdGlvbnMuR0VUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHJlc3BvbnNlXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0RXJyb3IoZTogRXJyb3IsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEFjdGlvbiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3IoZSwgb25FcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGVsc2UgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnRXJyb3JPdXRsZXQnKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvck91dGxldChlLCBvbkVycm9yKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yRGVmYXVsdChlKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcG9zdChwYXRoOiBzdHJpbmcsIG1vZGVsOiBhbnksIG9uU3VjY2Vzcz86IHN0cmluZywgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24obmV3IEh0dHBQb3N0UGF5bG9hZDxhbnk+KCksXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsXHJcbiAgICAgICAgICAgICAgICBtb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IG9uU3VjY2VzcyB8fCBIdHRwQWN0aW9ucy5QT1NUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBvbkVycm9yIHx8IEh0dHBBY3Rpb25zLlBPU1RfRVJST1JcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmh0dHBQb3N0KHBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBodHRwUG9zdChwYXlsb2FkOiBIdHRwUG9zdFBheWxvYWQ8YW55Pik6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEh0dHBBY3Rpb25zLlBPU1QsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBwb3N0Rm9ybVVybEVuY29kZWQocGF0aDogc3RyaW5nLCBtb2RlbDogYW55LCBvblN1Y2Nlc3M/OiBzdHJpbmcsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKG5ldyBIdHRwUG9zdFBheWxvYWQ8YW55PigpLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MgfHwgSHR0cEFjdGlvbnMuR0VUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBvbkVycm9yIHx8IEh0dHBBY3Rpb25zLkdFVF9FUlJPUlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBIdHRwQWN0aW9ucy5QT1NUX0ZPUk1fVVJMX0VOQ09ERUQsXHJcbiAgICAgICAgICAgIHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBwb3N0U3VjY2Vzcyhtb2RlbDogYW55LCBhY3Rpb25UeXBlPzogc3RyaW5nKTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogYWN0aW9uVHlwZSB8fCBIdHRwQWN0aW9ucy5QT1NUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IG1vZGVsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcG9zdEVycm9yKGU6IEVycm9yLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBBY3Rpb24ge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygb25FcnJvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yKGUsIG9uRXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvck91dGxldChlLCBvbkVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yRGVmYXVsdChlKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcHV0KHBhdGg6IHN0cmluZywgbW9kZWw6IGFueSwgb25TdWNjZXNzPzogc3RyaW5nLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbihuZXcgSHR0cFB1dFBheWxvYWQ8YW55PigpLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MgfHwgSHR0cEFjdGlvbnMuUFVUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBvbkVycm9yIHx8IEh0dHBBY3Rpb25zLlBVVF9FUlJPUlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaHR0cFB1dChwYXlsb2FkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaHR0cFB1dChwYXlsb2FkOiBIdHRwUHV0UGF5bG9hZDxhbnk+KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogSHR0cEFjdGlvbnMuUFVULFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcHV0U3VjY2Vzcyhtb2RlbDogYW55LCBhY3Rpb25UeXBlPzogc3RyaW5nKTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogYWN0aW9uVHlwZSB8fCBIdHRwQWN0aW9ucy5QVVRfU1VDQ0VTUyxcclxuICAgICAgICAgICAgcGF5bG9hZDogbW9kZWxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBwdXRFcnJvcihlOiBFcnJvciwgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogQWN0aW9uIHtcclxuICAgICAgICBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvcihlLCBvbkVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZWxzZSBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdFcnJvck91dGxldCcpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yT3V0bGV0KGUsIG9uRXJyb3IpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3JEZWZhdWx0KGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzZWFyY2gocGF0aDogc3RyaW5nLCBvblN1Y2Nlc3M/OiBzdHJpbmcsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKG5ldyBIdHRwR2V0UGF5bG9hZDxhbnk+KCksXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsXHJcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IG9uU3VjY2VzcyB8fCBIdHRwQWN0aW9ucy5TRUFSQ0hfU1VDQ0VTUyxcclxuICAgICAgICAgICAgICAgIG9uRXJyb3I6IG9uRXJyb3IgfHwgSHR0cEFjdGlvbnMuU0VBUkNIX0VSUk9SXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEh0dHBBY3Rpb25zLlNFQVJDSCxcclxuICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHNlYXJjaFN1Y2Nlc3MocmVzcG9uc2U6IGFueSwgYWN0aW9uVHlwZT86IHN0cmluZywgcGF0aD86IHN0cmluZyk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBwYXRoID8gSHR0cEFjdGlvbnMubWF0Y2hQYXRoKHBhdGgsIHJlc3BvbnNlKSA6IHJlc3BvbnNlO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGFjdGlvblR5cGUgfHwgSHR0cEFjdGlvbnMuU0VBUkNIX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=