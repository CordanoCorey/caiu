/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Actions, Effect, ofType } from '@ngrx/effects';
import { of } from 'rxjs';
import { map, mergeMap, catchError } from 'rxjs/operators';
import { HttpActions } from './http.actions';
import { HttpCommands } from './http.commands';
/**
 * @template T
 */
export class HttpEffects {
    /**
     * @param {?} actions$
     * @param {?} commands
     */
    constructor(actions$, commands) {
        this.actions$ = actions$;
        this.commands = commands;
        this.onDelete$ = this.actions$.pipe(ofType(HttpActions.DELETE), mergeMap((action) => this.delete$(action.payload)));
        this.onGet$ = this.actions$.pipe(ofType(HttpActions.GET), mergeMap((action) => this.get$(action.payload)));
        this.onPost$ = this.actions$.pipe(ofType(HttpActions.POST), mergeMap((action) => this.post$(action.payload)));
        this.onPostFormUrlEncoded$ = this.actions$.pipe(ofType(HttpActions.POST_FORM_URL_ENCODED), mergeMap((action) => this.postFormUrlEncoded$(action.payload)));
        this.onPut$ = this.actions$.pipe(ofType(HttpActions.PUT), mergeMap((action) => this.put$(action.payload)));
        this.onSearch$ = this.actions$.pipe(ofType(HttpActions.SEARCH), mergeMap((action) => this.search$(action.payload)));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    delete$(payload) {
        // console.log('DELETE:\t', payload.onSuccess);
        return this.commands.delete$(payload).pipe(map((model) => HttpActions.deleteSuccess(payload.onSuccessPayload || model, payload.onSuccess)), catchError((e) => of(HttpActions.deleteError(e, payload.onError))));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    get$(payload) {
        // console.log('GET:\t', payload.onSuccess);
        return this.commands.get$(payload).pipe(map((model) => HttpActions.getSuccess(model, payload.onSuccess)), catchError((e) => of(HttpActions.getError(e, payload.onError))));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    post$(payload) {
        // console.log('POST:\t', payload.onSuccess);
        return this.commands.post$(payload).pipe(map((model) => HttpActions.postSuccess(model, payload.onSuccess)), catchError((e) => of(HttpActions.postError(e, payload.onError))));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    postFormUrlEncoded$(payload) {
        // console.log('POST:\t', payload.onSuccess);
        return this.commands.postFormUrlEncoded$(payload).pipe(map((model) => HttpActions.postSuccess(model, payload.onSuccess)), catchError((e) => of(HttpActions.postError(e, payload.onError))));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    put$(payload) {
        // console.log('PUT:\t', payload.onSuccess);
        return this.commands.put$(payload).pipe(map((model) => HttpActions.putSuccess(model, payload.onSuccess)), catchError((e) => of(HttpActions.putError(e, payload.onError))));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    search$(payload) {
        // console.log('SEARCH:\t', payload.onSuccess);
        return this.commands.get$(payload).pipe(map((model) => HttpActions.searchSuccess(model, payload.onSuccess, payload.path)), catchError((e) => of(HttpActions.getError(e, payload.onError))));
    }
}
HttpEffects.decorators = [
    { type: Injectable },
];
/** @nocollapse */
HttpEffects.ctorParameters = () => [
    { type: Actions },
    { type: HttpCommands }
];
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onDelete$", void 0);
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onGet$", void 0);
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onPost$", void 0);
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onPostFormUrlEncoded$", void 0);
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onPut$", void 0);
tslib_1.__decorate([
    Effect(),
    tslib_1.__metadata("design:type", Object)
], HttpEffects.prototype, "onSearch$", void 0);
function HttpEffects_tsickle_Closure_declarations() {
    /** @type {?} */
    HttpEffects.prototype.onDelete$;
    /** @type {?} */
    HttpEffects.prototype.onGet$;
    /** @type {?} */
    HttpEffects.prototype.onPost$;
    /** @type {?} */
    HttpEffects.prototype.onPostFormUrlEncoded$;
    /** @type {?} */
    HttpEffects.prototype.onPut$;
    /** @type {?} */
    HttpEffects.prototype.onSearch$;
    /** @type {?} */
    HttpEffects.prototype.actions$;
    /** @type {?} */
    HttpEffects.prototype.commands;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5lZmZlY3RzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9odHRwL2h0dHAuZWZmZWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7OztBQUsvQyxNQUFNOzs7OztJQWdDRixZQUNZLFVBQ0E7UUFEQSxhQUFRLEdBQVIsUUFBUTtRQUNSLGFBQVEsR0FBUixRQUFRO3lCQWhDRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDcEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFDMUIsUUFBUSxDQUFDLENBQUMsTUFBYyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUM3RDtzQkFFa0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2pDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQ3ZCLFFBQVEsQ0FBQyxDQUFDLE1BQWMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FDMUQ7dUJBRW1CLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNsQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUN4QixR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ICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWN0aW9ucywgRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwLCBtZXJnZU1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IEh0dHBBY3Rpb25zIH0gZnJvbSAnLi9odHRwLmFjdGlvbnMnO1xyXG5pbXBvcnQgeyBIdHRwQ29tbWFuZHMgfSBmcm9tICcuL2h0dHAuY29tbWFuZHMnO1xyXG5pbXBvcnQgeyBIdHRwR2V0UGF5bG9hZCwgSHR0cFBvc3RQYXlsb2FkLCBIdHRwUHV0UGF5bG9hZCwgSHR0cERlbGV0ZVBheWxvYWQgfSBmcm9tICcuL2h0dHAubW9kZWxzJztcclxuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vc3RvcmUvbW9kZWxzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEh0dHBFZmZlY3RzPFQ+IHtcclxuXHJcbiAgICBARWZmZWN0KCkgb25EZWxldGUkID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgICAgIG9mVHlwZShIdHRwQWN0aW9ucy5ERUxFVEUpLFxyXG4gICAgICAgIG1lcmdlTWFwKChhY3Rpb246IEFjdGlvbikgPT4gdGhpcy5kZWxldGUkKGFjdGlvbi5wYXlsb2FkKSlcclxuICAgICk7XHJcblxyXG4gICAgQEVmZmVjdCgpIG9uR2V0JCA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgICAgICBvZlR5cGUoSHR0cEFjdGlvbnMuR0VUKSxcclxuICAgICAgICBtZXJnZU1hcCgoYWN0aW9uOiBBY3Rpb24pID0+IHRoaXMuZ2V0JChhY3Rpb24ucGF5bG9hZCkpXHJcbiAgICApO1xyXG5cclxuICAgIEBFZmZlY3QoKSBvblBvc3QkID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgICAgIG9mVHlwZShIdHRwQWN0aW9ucy5QT1NUKSxcclxuICAgICAgICBtZXJnZU1hcCgoYWN0aW9uOiBBY3Rpb24pID0+IHRoaXMucG9zdCQoYWN0aW9uLnBheWxvYWQpKVxyXG4gICAgKTtcclxuXHJcbiAgICBARWZmZWN0KCkgb25Qb3N0Rm9ybVVybEVuY29kZWQkID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgICAgIG9mVHlwZShIdHRwQWN0aW9ucy5QT1NUX0ZPUk1fVVJMX0VOQ09ERUQpLFxyXG4gICAgICAgIG1lcmdlTWFwKChhY3Rpb246IEFjdGlvbikgPT4gdGhpcy5wb3N0Rm9ybVVybEVuY29kZWQkKGFjdGlvbi5wYXlsb2FkKSlcclxuICAgICk7XHJcblxyXG4gICAgQEVmZmVjdCgpIG9uUHV0JCA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgICAgICBvZlR5cGUoSHR0cEFjdGlvbnMuUFVUKSxcclxuICAgICAgICBtZXJnZU1hcCgoYWN0aW9uOiBBY3Rpb24pID0+IHRoaXMucHV0JChhY3Rpb24ucGF5bG9hZCkpXHJcbiAgICApO1xyXG5cclxuICAgIEBFZmZlY3QoKSBvblNlYXJjaCQgPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICAgICAgb2ZUeXBlKEh0dHBBY3Rpb25zLlNFQVJDSCksXHJcbiAgICAgICAgbWVyZ2VNYXAoKGFjdGlvbjogQWN0aW9uKSA9PiB0aGlzLnNlYXJjaCQoYWN0aW9uLnBheWxvYWQpKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGFjdGlvbnMkOiBBY3Rpb25zLFxyXG4gICAgICAgIHByaXZhdGUgY29tbWFuZHM6IEh0dHBDb21tYW5kczxUPlxyXG4gICAgKSB7IH1cclxuXHJcbiAgICBkZWxldGUkKHBheWxvYWQ6IEh0dHBEZWxldGVQYXlsb2FkPFQ+KTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnREVMRVRFOlxcdCcsIHBheWxvYWQub25TdWNjZXNzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kcy5kZWxldGUkKHBheWxvYWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgobW9kZWw6IFQpID0+IEh0dHBBY3Rpb25zLmRlbGV0ZVN1Y2Nlc3MocGF5bG9hZC5vblN1Y2Nlc3NQYXlsb2FkIHx8IG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcykpLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlOiBFcnJvcikgPT4gb2YoSHR0cEFjdGlvbnMuZGVsZXRlRXJyb3IoZSwgcGF5bG9hZC5vbkVycm9yKSkpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQkKHBheWxvYWQ6IEh0dHBHZXRQYXlsb2FkPFQ+KTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnR0VUOlxcdCcsIHBheWxvYWQub25TdWNjZXNzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kcy5nZXQkKHBheWxvYWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgobW9kZWw6IFQpID0+IEh0dHBBY3Rpb25zLmdldFN1Y2Nlc3MobW9kZWwsIHBheWxvYWQub25TdWNjZXNzKSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGU6IEVycm9yKSA9PiBvZihIdHRwQWN0aW9ucy5nZXRFcnJvcihlLCBwYXlsb2FkLm9uRXJyb3IpKSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHBvc3QkKHBheWxvYWQ6IEh0dHBQb3N0UGF5bG9hZDxUPik6IE9ic2VydmFibGU8QWN0aW9uPiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1BPU1Q6XFx0JywgcGF5bG9hZC5vblN1Y2Nlc3MpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmRzLnBvc3QkKHBheWxvYWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgobW9kZWw6IFQpID0+IEh0dHBBY3Rpb25zLnBvc3RTdWNjZXNzKG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcykpLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlOiBFcnJvcikgPT4gb2YoSHR0cEFjdGlvbnMucG9zdEVycm9yKGUsIHBheWxvYWQub25FcnJvcikpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcG9zdEZvcm1VcmxFbmNvZGVkJChwYXlsb2FkOiBIdHRwUG9zdFBheWxvYWQ8VD4pOiBPYnNlcnZhYmxlPEFjdGlvbj4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdQT1NUOlxcdCcsIHBheWxvYWQub25TdWNjZXNzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kcy5wb3N0Rm9ybVVybEVuY29kZWQkKHBheWxvYWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgobW9kZWw6IFQpID0+IEh0dHBBY3Rpb25zLnBvc3RTdWNjZXNzKG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcykpLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlOiBFcnJvcikgPT4gb2YoSHR0cEFjdGlvbnMucG9zdEVycm9yKGUsIHBheWxvYWQub25FcnJvcikpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHV0JChwYXlsb2FkOiBIdHRwUHV0UGF5bG9hZDxUPik6IE9ic2VydmFibGU8QWN0aW9uPiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1BVVDpcXHQnLCBwYXlsb2FkLm9uU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZHMucHV0JChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5wdXRTdWNjZXNzKG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcykpLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlOiBFcnJvcikgPT4gb2YoSHR0cEFjdGlvbnMucHV0RXJyb3IoZSwgcGF5bG9hZC5vbkVycm9yKSkpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWFyY2gkKHBheWxvYWQ6IEh0dHBHZXRQYXlsb2FkPFQ+KTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnU0VBUkNIOlxcdCcsIHBheWxvYWQub25TdWNjZXNzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kcy5nZXQkKHBheWxvYWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgobW9kZWw6IFQpID0+IEh0dHBBY3Rpb25zLnNlYXJjaFN1Y2Nlc3MobW9kZWwsIHBheWxvYWQub25TdWNjZXNzLCBwYXlsb2FkLnBhdGgpKSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZTogRXJyb3IpID0+IG9mKEh0dHBBY3Rpb25zLmdldEVycm9yKGUsIHBheWxvYWQub25FcnJvcikpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuIl19