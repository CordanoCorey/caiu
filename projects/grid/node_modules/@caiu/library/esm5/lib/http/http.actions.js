/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpGetPayload, HttpPutPayload, HttpPostPayload, HttpDeletePayload } from './http.models';
import { ErrorActions } from '../errors/errors.actions';
import { inArray } from '../shared/utils';
var HttpActions = /** @class */ (function () {
    function HttpActions() {
    }
    /**
     * @param {?} path
     * @param {?} target
     * @return {?}
     */
    HttpActions.addPath = /**
     * @param {?} path
     * @param {?} target
     * @return {?}
     */
    function (path, target) {
        var /** @type {?} */ existingMatches = target['matches'] || [];
        var /** @type {?} */ matches = inArray(existingMatches, path) ? existingMatches : tslib_1.__spread(existingMatches, [path]);
        return Object.assign(target, { matches: matches });
    };
    /**
     * @param {?} path
     * @param {?} payload
     * @return {?}
     */
    HttpActions.matchPath = /**
     * @param {?} path
     * @param {?} payload
     * @return {?}
     */
    function (path, payload) {
        if (payload && payload['results']) {
            return Object.assign(payload, { results: HttpActions.matchPath(path, payload['results']) });
        }
        if (Array.isArray(payload)) {
            return payload.map(function (x) { return HttpActions.addPath(path, x); });
        }
        return HttpActions.addPath(path, payload);
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpActions.buildError = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        return ErrorActions.add(payload);
    };
    /**
     * @param {?} key
     * @param {?} e
     * @return {?}
     */
    HttpActions.buildErrorPayload = /**
     * @param {?} key
     * @param {?} e
     * @return {?}
     */
    function (key, e) {
        return {
            key: key,
            error: e
        };
    };
    /**
     * @param {?} e
     * @param {?} onError
     * @return {?}
     */
    HttpActions.handleError = /**
     * @param {?} e
     * @param {?} onError
     * @return {?}
     */
    function (e, onError) {
        return {
            type: onError,
            payload: e
        };
    };
    /**
     * @param {?} e
     * @param {?} outlet
     * @return {?}
     */
    HttpActions.handleErrorOutlet = /**
     * @param {?} e
     * @param {?} outlet
     * @return {?}
     */
    function (e, outlet) {
        return ErrorActions.addAtOutlet(e, outlet);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    HttpActions.handleErrorDefault = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        return {
            type: HttpActions.DELETE_ERROR,
            payload: HttpActions.buildErrorPayload('lastError', e)
        };
    };
    /**
     * @param {?} path
     * @param {?} onSuccessPayload
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.delete = /**
     * @param {?} path
     * @param {?} onSuccessPayload
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, onSuccessPayload, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpDeletePayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.DELETE_SUCCESS,
            onSuccessPayload: onSuccessPayload,
            onError: onError || HttpActions.DELETE_ERROR
        });
        return HttpActions.httpDelete(payload);
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpActions.httpDelete = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        return {
            type: HttpActions.DELETE,
            payload: payload
        };
    };
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    HttpActions.deleteSuccess = /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    function (model, actionType) {
        return {
            type: actionType || HttpActions.DELETE_SUCCESS,
            payload: model
        };
    };
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.deleteError = /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    function (e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    };
    /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.get = /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpGetPayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.GET_SUCCESS,
            onError: onError || HttpActions.GET_ERROR
        });
        return HttpActions.httpGet(payload);
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpActions.httpGet = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        return {
            type: HttpActions.GET,
            payload: payload
        };
    };
    /**
     * @param {?} response
     * @param {?=} actionType
     * @return {?}
     */
    HttpActions.getSuccess = /**
     * @param {?} response
     * @param {?=} actionType
     * @return {?}
     */
    function (response, actionType) {
        return {
            type: actionType || HttpActions.GET_SUCCESS,
            payload: response
        };
    };
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.getError = /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    function (e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    };
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.post = /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, model, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpPostPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.POST_SUCCESS,
            onError: onError || HttpActions.POST_ERROR
        });
        return HttpActions.httpPost(payload);
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpActions.httpPost = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        return {
            type: HttpActions.POST,
            payload: payload
        };
    };
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.postFormUrlEncoded = /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, model, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpPostPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.GET_SUCCESS,
            onError: onError || HttpActions.GET_ERROR
        });
        return {
            type: HttpActions.POST_FORM_URL_ENCODED,
            payload: payload
        };
    };
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    HttpActions.postSuccess = /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    function (model, actionType) {
        return {
            type: actionType || HttpActions.POST_SUCCESS,
            payload: model
        };
    };
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.postError = /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    function (e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        else if (typeof onError === 'object') {
            return HttpActions.handleErrorOutlet(e, onError);
        }
        return HttpActions.handleErrorDefault(e);
    };
    /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.put = /**
     * @param {?} path
     * @param {?} model
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, model, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpPutPayload(), {
            path: path,
            model: model,
            onSuccess: onSuccess || HttpActions.PUT_SUCCESS,
            onError: onError || HttpActions.PUT_ERROR
        });
        return HttpActions.httpPut(payload);
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpActions.httpPut = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        return {
            type: HttpActions.PUT,
            payload: payload
        };
    };
    /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    HttpActions.putSuccess = /**
     * @param {?} model
     * @param {?=} actionType
     * @return {?}
     */
    function (model, actionType) {
        return {
            type: actionType || HttpActions.PUT_SUCCESS,
            payload: model
        };
    };
    /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.putError = /**
     * @param {?} e
     * @param {?=} onError
     * @return {?}
     */
    function (e, onError) {
        if (typeof onError === 'string') {
            return HttpActions.handleError(e, onError);
        }
        // else if (typeof onError === 'ErrorOutlet') {
        //     return HttpActions.handleErrorOutlet(e, onError);
        // }
        return HttpActions.handleErrorDefault(e);
    };
    /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    HttpActions.search = /**
     * @param {?} path
     * @param {?=} onSuccess
     * @param {?=} onError
     * @return {?}
     */
    function (path, onSuccess, onError) {
        var /** @type {?} */ payload = Object.assign(new HttpGetPayload(), {
            path: path,
            onSuccess: onSuccess || HttpActions.SEARCH_SUCCESS,
            onError: onError || HttpActions.SEARCH_ERROR
        });
        return {
            type: HttpActions.SEARCH,
            payload: payload
        };
    };
    /**
     * @param {?} response
     * @param {?=} actionType
     * @param {?=} path
     * @return {?}
     */
    HttpActions.searchSuccess = /**
     * @param {?} response
     * @param {?=} actionType
     * @param {?=} path
     * @return {?}
     */
    function (response, actionType, path) {
        var /** @type {?} */ payload = path ? HttpActions.matchPath(path, response) : response;
        return {
            type: actionType || HttpActions.SEARCH_SUCCESS,
            payload: payload
        };
    };
    HttpActions.DELETE = "[Http] DELETE";
    HttpActions.DELETE_SUCCESS = "[Http] DELETE Success";
    HttpActions.DELETE_ERROR = "[Http] DELETE Error";
    HttpActions.GET = "[Http] GET";
    HttpActions.GET_SUCCESS = "[Http] GET Success";
    HttpActions.GET_ERROR = "[Http] GET Error";
    HttpActions.POST = "[Http] POST";
    HttpActions.POST_SUCCESS = "[Http] POST Success";
    HttpActions.POST_ERROR = "[Http] POST Error";
    HttpActions.POST_FORM_URL_ENCODED = "[Http] POST Form URL Encoded";
    HttpActions.PUT = "[Http] PUT";
    HttpActions.PUT_SUCCESS = "[Http] PUT Success";
    HttpActions.PUT_ERROR = "[Http] PUT Error";
    HttpActions.SEARCH = "[Http] SEARCH";
    HttpActions.SEARCH_SUCCESS = "[Http] SEARCH Success";
    HttpActions.SEARCH_ERROR = "[Http] SEARCH Error";
    return HttpActions;
}());
export { HttpActions };
function HttpActions_tsickle_Closure_declarations() {
    /** @type {?} */
    HttpActions.DELETE;
    /** @type {?} */
    HttpActions.DELETE_SUCCESS;
    /** @type {?} */
    HttpActions.DELETE_ERROR;
    /** @type {?} */
    HttpActions.GET;
    /** @type {?} */
    HttpActions.GET_SUCCESS;
    /** @type {?} */
    HttpActions.GET_ERROR;
    /** @type {?} */
    HttpActions.POST;
    /** @type {?} */
    HttpActions.POST_SUCCESS;
    /** @type {?} */
    HttpActions.POST_ERROR;
    /** @type {?} */
    HttpActions.POST_FORM_URL_ENCODED;
    /** @type {?} */
    HttpActions.PUT;
    /** @type {?} */
    HttpActions.PUT_SUCCESS;
    /** @type {?} */
    HttpActions.PUT_ERROR;
    /** @type {?} */
    HttpActions.SEARCH;
    /** @type {?} */
    HttpActions.SEARCH_SUCCESS;
    /** @type {?} */
    HttpActions.SEARCH_ERROR;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5hY3Rpb25zLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9odHRwL2h0dHAuYWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFFSCxjQUFjLEVBQ2QsY0FBYyxFQUNkLGVBQWUsRUFFZixpQkFBaUIsRUFDcEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBR3hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7Ozs7O0lBcUIvQixtQkFBTzs7Ozs7SUFBZCxVQUFlLElBQUksRUFBRSxNQUFNO1FBQ3ZCLHFCQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hELHFCQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxrQkFBSyxlQUFlLEdBQUUsSUFBSSxFQUFDLENBQUM7UUFDOUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7S0FDdEQ7Ozs7OztJQUVNLHFCQUFTOzs7OztJQUFoQixVQUFpQixJQUFJLEVBQUUsT0FBTztRQUMxQixFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsRUFBRSxPQUFPLEVBQUUsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQy9GO1FBQ0QsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFP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cEdldFBheWxvYWQsXHJcbiAgICBIdHRwUHV0UGF5bG9hZCxcclxuICAgIEh0dHBQb3N0UGF5bG9hZCxcclxuICAgIEh0dHBBY3Rpb25QYXlsb2FkLFxyXG4gICAgSHR0cERlbGV0ZVBheWxvYWRcclxufSBmcm9tICcuL2h0dHAubW9kZWxzJztcclxuaW1wb3J0IHsgRXJyb3JBY3Rpb25zIH0gZnJvbSAnLi4vZXJyb3JzL2Vycm9ycy5hY3Rpb25zJztcclxuaW1wb3J0IHsgRXJyb3JPdXRsZXQsIEVycm9yUGF5bG9hZCB9IGZyb20gJy4uL2Vycm9ycy9lcnJvcnMubW9kZWxzJztcclxuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi4vc3RvcmUvbW9kZWxzJztcclxuaW1wb3J0IHsgaW5BcnJheSB9IGZyb20gJy4uL3NoYXJlZC91dGlscyc7XHJcblxyXG5leHBvcnQgY2xhc3MgSHR0cEFjdGlvbnMge1xyXG5cclxuICAgIHN0YXRpYyBERUxFVEUgPSBgW0h0dHBdIERFTEVURWA7XHJcbiAgICBzdGF0aWMgREVMRVRFX1NVQ0NFU1MgPSBgW0h0dHBdIERFTEVURSBTdWNjZXNzYDtcclxuICAgIHN0YXRpYyBERUxFVEVfRVJST1IgPSBgW0h0dHBdIERFTEVURSBFcnJvcmA7XHJcbiAgICBzdGF0aWMgR0VUID0gYFtIdHRwXSBHRVRgO1xyXG4gICAgc3RhdGljIEdFVF9TVUNDRVNTID0gYFtIdHRwXSBHRVQgU3VjY2Vzc2A7XHJcbiAgICBzdGF0aWMgR0VUX0VSUk9SID0gYFtIdHRwXSBHRVQgRXJyb3JgO1xyXG4gICAgc3RhdGljIFBPU1QgPSBgW0h0dHBdIFBPU1RgO1xyXG4gICAgc3RhdGljIFBPU1RfU1VDQ0VTUyA9IGBbSHR0cF0gUE9TVCBTdWNjZXNzYDtcclxuICAgIHN0YXRpYyBQT1NUX0VSUk9SID0gYFtIdHRwXSBQT1NUIEVycm9yYDtcclxuICAgIHN0YXRpYyBQT1NUX0ZPUk1fVVJMX0VOQ09ERUQgPSBgW0h0dHBdIFBPU1QgRm9ybSBVUkwgRW5jb2RlZGA7XHJcbiAgICBzdGF0aWMgUFVUID0gYFtIdHRwXSBQVVRgO1xyXG4gICAgc3RhdGljIFBVVF9TVUNDRVNTID0gYFtIdHRwXSBQVVQgU3VjY2Vzc2A7XHJcbiAgICBzdGF0aWMgUFVUX0VSUk9SID0gYFtIdHRwXSBQVVQgRXJyb3JgO1xyXG4gICAgc3RhdGljIFNFQVJDSCA9IGBbSHR0cF0gU0VBUkNIYDtcclxuICAgIHN0YXRpYyBTRUFSQ0hfU1VDQ0VTUyA9IGBbSHR0cF0gU0VBUkNIIFN1Y2Nlc3NgO1xyXG4gICAgc3RhdGljIFNFQVJDSF9FUlJPUiA9IGBbSHR0cF0gU0VBUkNIIEVycm9yYDtcclxuXHJcbiAgICBzdGF0aWMgYWRkUGF0aChwYXRoLCB0YXJnZXQpIHtcclxuICAgICAgICBjb25zdCBleGlzdGluZ01hdGNoZXMgPSB0YXJnZXRbJ21hdGNoZXMnXSB8fCBbXTtcclxuICAgICAgICBjb25zdCBtYXRjaGVzID0gaW5BcnJheShleGlzdGluZ01hdGNoZXMsIHBhdGgpID8gZXhpc3RpbmdNYXRjaGVzIDogWy4uLmV4aXN0aW5nTWF0Y2hlcywgcGF0aF07XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB7IG1hdGNoZXM6IG1hdGNoZXMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIG1hdGNoUGF0aChwYXRoLCBwYXlsb2FkKSB7XHJcbiAgICAgICAgaWYgKHBheWxvYWQgJiYgcGF5bG9hZFsncmVzdWx0cyddKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHBheWxvYWQsIHsgcmVzdWx0czogSHR0cEFjdGlvbnMubWF0Y2hQYXRoKHBhdGgsIHBheWxvYWRbJ3Jlc3VsdHMnXSkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBheWxvYWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXlsb2FkLm1hcCh4ID0+IEh0dHBBY3Rpb25zLmFkZFBhdGgocGF0aCwgeCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuYWRkUGF0aChwYXRoLCBwYXlsb2FkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYnVpbGRFcnJvcihwYXlsb2FkOiBFcnJvclBheWxvYWQpOiBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiBFcnJvckFjdGlvbnMuYWRkKHBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBidWlsZEVycm9yUGF5bG9hZChrZXk6IHN0cmluZywgZTogRXJyb3IpOiBFcnJvclBheWxvYWQge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGtleToga2V5LFxyXG4gICAgICAgICAgICBlcnJvcjogZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGhhbmRsZUVycm9yKGU6IEVycm9yLCBvbkVycm9yOiBzdHJpbmcpOiBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG9uRXJyb3IsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IGVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBoYW5kbGVFcnJvck91dGxldChlOiBFcnJvciwgb3V0bGV0OiBFcnJvck91dGxldCk6IEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIEVycm9yQWN0aW9ucy5hZGRBdE91dGxldChlLCBvdXRsZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBoYW5kbGVFcnJvckRlZmF1bHQoZTogRXJyb3IpOiBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEh0dHBBY3Rpb25zLkRFTEVURV9FUlJPUixcclxuICAgICAgICAgICAgcGF5bG9hZDogSHR0cEFjdGlvbnMuYnVpbGRFcnJvclBheWxvYWQoJ2xhc3RFcnJvcicsIGUpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZGVsZXRlKHBhdGg6IHN0cmluZywgb25TdWNjZXNzUGF5bG9hZDogYW55LCBvblN1Y2Nlc3M/OiBzdHJpbmcsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKG5ldyBIdHRwRGVsZXRlUGF5bG9hZDxhbnk+KCksXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsXHJcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IG9uU3VjY2VzcyB8fCBIdHRwQWN0aW9ucy5ERUxFVEVfU1VDQ0VTUyxcclxuICAgICAgICAgICAgICAgIG9uU3VjY2Vzc1BheWxvYWQsXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBvbkVycm9yIHx8IEh0dHBBY3Rpb25zLkRFTEVURV9FUlJPUlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaHR0cERlbGV0ZShwYXlsb2FkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaHR0cERlbGV0ZShwYXlsb2FkOiBIdHRwRGVsZXRlUGF5bG9hZDxhbnk+KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogSHR0cEFjdGlvbnMuREVMRVRFLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZGVsZXRlU3VjY2Vzcyhtb2RlbDogYW55LCBhY3Rpb25UeXBlPzogc3RyaW5nKTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogYWN0aW9uVHlwZSB8fCBIdHRwQWN0aW9ucy5ERUxFVEVfU1VDQ0VTUyxcclxuICAgICAgICAgICAgcGF5bG9hZDogbW9kZWxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBkZWxldGVFcnJvcihlOiBFcnJvciwgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogQWN0aW9uIHtcclxuICAgICAgICBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvcihlLCBvbkVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZWxzZSBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdFcnJvck91dGxldCcpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yT3V0bGV0KGUsIG9uRXJyb3IpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3JEZWZhdWx0KGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXQocGF0aDogc3RyaW5nLCBvblN1Y2Nlc3M/OiBzdHJpbmcsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKG5ldyBIdHRwR2V0UGF5bG9hZDxhbnk+KCksXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsXHJcbiAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IG9uU3VjY2VzcyB8fCBIdHRwQWN0aW9ucy5HRVRfU1VDQ0VTUyxcclxuICAgICAgICAgICAgICAgIG9uRXJyb3I6IG9uRXJyb3IgfHwgSHR0cEFjdGlvbnMuR0VUX0VSUk9SXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5odHRwR2V0KHBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBodHRwR2V0KHBheWxvYWQ6IEh0dHBHZXRQYXlsb2FkPGFueT4pOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBIdHRwQWN0aW9ucy5HRVQsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRTdWNjZXNzKHJlc3BvbnNlOiBhbnksIGFjdGlvblR5cGU/OiBzdHJpbmcpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBhY3Rpb25UeXBlIHx8IEh0dHBBY3Rpb25zLkdFVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiByZXNwb25zZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEVycm9yKGU6IEVycm9yLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBBY3Rpb24ge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygb25FcnJvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yKGUsIG9uRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBlbHNlIGlmICh0eXBlb2Ygb25FcnJvciA9PT0gJ0Vycm9yT3V0bGV0Jykge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3JPdXRsZXQoZSwgb25FcnJvcik7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvckRlZmF1bHQoZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHBvc3QocGF0aDogc3RyaW5nLCBtb2RlbDogYW55LCBvblN1Y2Nlc3M/OiBzdHJpbmcsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKG5ldyBIdHRwUG9zdFBheWxvYWQ8YW55PigpLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLFxyXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MgfHwgSHR0cEFjdGlvbnMuUE9TVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgb25FcnJvcjogb25FcnJvciB8fCBIdHRwQWN0aW9ucy5QT1NUX0VSUk9SXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5odHRwUG9zdChwYXlsb2FkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgaHR0cFBvc3QocGF5bG9hZDogSHR0cFBvc3RQYXlsb2FkPGFueT4pOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBIdHRwQWN0aW9ucy5QT1NULFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcG9zdEZvcm1VcmxFbmNvZGVkKHBhdGg6IHN0cmluZywgbW9kZWw6IGFueSwgb25TdWNjZXNzPzogc3RyaW5nLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbihuZXcgSHR0cFBvc3RQYXlsb2FkPGFueT4oKSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aCxcclxuICAgICAgICAgICAgICAgIG1vZGVsOiBtb2RlbCxcclxuICAgICAgICAgICAgICAgIG9uU3VjY2Vzczogb25TdWNjZXNzIHx8IEh0dHBBY3Rpb25zLkdFVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgb25FcnJvcjogb25FcnJvciB8fCBIdHRwQWN0aW9ucy5HRVRfRVJST1JcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZTogSHR0cEFjdGlvbnMuUE9TVF9GT1JNX1VSTF9FTkNPREVELFxyXG4gICAgICAgICAgICBwYXlsb2FkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcG9zdFN1Y2Nlc3MobW9kZWw6IGFueSwgYWN0aW9uVHlwZT86IHN0cmluZyk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGFjdGlvblR5cGUgfHwgSHR0cEFjdGlvbnMuUE9TVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBtb2RlbFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHBvc3RFcnJvcihlOiBFcnJvciwgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogQWN0aW9uIHtcclxuICAgICAgICBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvcihlLCBvbkVycm9yKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3JPdXRsZXQoZSwgb25FcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvckRlZmF1bHQoZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHB1dChwYXRoOiBzdHJpbmcsIG1vZGVsOiBhbnksIG9uU3VjY2Vzcz86IHN0cmluZywgb25FcnJvcj86IHN0cmluZyB8IEVycm9yT3V0bGV0KTogSHR0cEFjdGlvbiB7XHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IE9iamVjdC5hc3NpZ24obmV3IEh0dHBQdXRQYXlsb2FkPGFueT4oKSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aCxcclxuICAgICAgICAgICAgICAgIG1vZGVsOiBtb2RlbCxcclxuICAgICAgICAgICAgICAgIG9uU3VjY2Vzczogb25TdWNjZXNzIHx8IEh0dHBBY3Rpb25zLlBVVF9TVUNDRVNTLFxyXG4gICAgICAgICAgICAgICAgb25FcnJvcjogb25FcnJvciB8fCBIdHRwQWN0aW9ucy5QVVRfRVJST1JcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmh0dHBQdXQocGF5bG9hZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGh0dHBQdXQocGF5bG9hZDogSHR0cFB1dFBheWxvYWQ8YW55Pik6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEh0dHBBY3Rpb25zLlBVVCxcclxuICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHB1dFN1Y2Nlc3MobW9kZWw6IGFueSwgYWN0aW9uVHlwZT86IHN0cmluZyk6IEh0dHBBY3Rpb24ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGFjdGlvblR5cGUgfHwgSHR0cEFjdGlvbnMuUFVUX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IG1vZGVsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcHV0RXJyb3IoZTogRXJyb3IsIG9uRXJyb3I/OiBzdHJpbmcgfCBFcnJvck91dGxldCk6IEFjdGlvbiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gSHR0cEFjdGlvbnMuaGFuZGxlRXJyb3IoZSwgb25FcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGVsc2UgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnRXJyb3JPdXRsZXQnKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBIdHRwQWN0aW9ucy5oYW5kbGVFcnJvck91dGxldChlLCBvbkVycm9yKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIEh0dHBBY3Rpb25zLmhhbmRsZUVycm9yRGVmYXVsdChlKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgc2VhcmNoKHBhdGg6IHN0cmluZywgb25TdWNjZXNzPzogc3RyaW5nLCBvbkVycm9yPzogc3RyaW5nIHwgRXJyb3JPdXRsZXQpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbihuZXcgSHR0cEdldFBheWxvYWQ8YW55PigpLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzOiBvblN1Y2Nlc3MgfHwgSHR0cEFjdGlvbnMuU0VBUkNIX1NVQ0NFU1MsXHJcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBvbkVycm9yIHx8IEh0dHBBY3Rpb25zLlNFQVJDSF9FUlJPUlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBIdHRwQWN0aW9ucy5TRUFSQ0gsXHJcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzZWFyY2hTdWNjZXNzKHJlc3BvbnNlOiBhbnksIGFjdGlvblR5cGU/OiBzdHJpbmcsIHBhdGg/OiBzdHJpbmcpOiBIdHRwQWN0aW9uIHtcclxuICAgICAgICBjb25zdCBwYXlsb2FkID0gcGF0aCA/IEh0dHBBY3Rpb25zLm1hdGNoUGF0aChwYXRoLCByZXNwb25zZSkgOiByZXNwb25zZTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiBhY3Rpb25UeXBlIHx8IEh0dHBBY3Rpb25zLlNFQVJDSF9TVUNDRVNTLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn1cclxuIl19