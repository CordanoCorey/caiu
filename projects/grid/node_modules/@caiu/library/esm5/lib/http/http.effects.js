/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Actions, Effect, ofType } from '@ngrx/effects';
import { of } from 'rxjs';
import { map, mergeMap, catchError } from 'rxjs/operators';
import { HttpActions } from './http.actions';
import { HttpCommands } from './http.commands';
/**
 * @template T
 */
var HttpEffects = /** @class */ (function () {
    function HttpEffects(actions$, commands) {
        var _this = this;
        this.actions$ = actions$;
        this.commands = commands;
        this.onDelete$ = this.actions$.pipe(ofType(HttpActions.DELETE), mergeMap(function (action) { return _this.delete$(action.payload); }));
        this.onGet$ = this.actions$.pipe(ofType(HttpActions.GET), mergeMap(function (action) { return _this.get$(action.payload); }));
        this.onPost$ = this.actions$.pipe(ofType(HttpActions.POST), mergeMap(function (action) { return _this.post$(action.payload); }));
        this.onPostFormUrlEncoded$ = this.actions$.pipe(ofType(HttpActions.POST_FORM_URL_ENCODED), mergeMap(function (action) { return _this.postFormUrlEncoded$(action.payload); }));
        this.onPut$ = this.actions$.pipe(ofType(HttpActions.PUT), mergeMap(function (action) { return _this.put$(action.payload); }));
        this.onSearch$ = this.actions$.pipe(ofType(HttpActions.SEARCH), mergeMap(function (action) { return _this.search$(action.payload); }));
    }
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.delete$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('DELETE:\t', payload.onSuccess);
        return this.commands.delete$(payload).pipe(map(function (model) { return HttpActions.deleteSuccess(payload.onSuccessPayload || model, payload.onSuccess); }), catchError(function (e) { return of(HttpActions.deleteError(e, payload.onError)); }));
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.get$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('GET:\t', payload.onSuccess);
        return this.commands.get$(payload).pipe(map(function (model) { return HttpActions.getSuccess(model, payload.onSuccess); }), catchError(function (e) { return of(HttpActions.getError(e, payload.onError)); }));
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.post$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('POST:\t', payload.onSuccess);
        return this.commands.post$(payload).pipe(map(function (model) { return HttpActions.postSuccess(model, payload.onSuccess); }), catchError(function (e) { return of(HttpActions.postError(e, payload.onError)); }));
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.postFormUrlEncoded$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('POST:\t', payload.onSuccess);
        return this.commands.postFormUrlEncoded$(payload).pipe(map(function (model) { return HttpActions.postSuccess(model, payload.onSuccess); }), catchError(function (e) { return of(HttpActions.postError(e, payload.onError)); }));
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.put$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('PUT:\t', payload.onSuccess);
        return this.commands.put$(payload).pipe(map(function (model) { return HttpActions.putSuccess(model, payload.onSuccess); }), catchError(function (e) { return of(HttpActions.putError(e, payload.onError)); }));
    };
    /**
     * @param {?} payload
     * @return {?}
     */
    HttpEffects.prototype.search$ = /**
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        // console.log('SEARCH:\t', payload.onSuccess);
        return this.commands.get$(payload).pipe(map(function (model) { return HttpActions.searchSuccess(model, payload.onSuccess, payload.path); }), catchError(function (e) { return of(HttpActions.getError(e, payload.onError)); }));
    };
    HttpEffects.decorators = [
        { type: Injectable },
    ];
    /** @nocollapse */
    HttpEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: HttpCommands }
    ]; };
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onDelete$", void 0);
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onGet$", void 0);
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onPost$", void 0);
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onPostFormUrlEncoded$", void 0);
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onPut$", void 0);
    tslib_1.__decorate([
        Effect(),
        tslib_1.__metadata("design:type", Object)
    ], HttpEffects.prototype, "onSearch$", void 0);
    return HttpEffects;
}());
export { HttpEffects };
function HttpEffects_tsickle_Closure_declarations() {
    /** @type {?} */
    HttpEffects.prototype.onDelete$;
    /** @type {?} */
    HttpEffects.prototype.onGet$;
    /** @type {?} */
    HttpEffects.prototype.onPost$;
    /** @type {?} */
    HttpEffects.prototype.onPostFormUrlEncoded$;
    /** @type {?} */
    HttpEffects.prototype.onPut$;
    /** @type {?} */
    HttpEffects.prototype.onSearch$;
    /** @type {?} */
    HttpEffects.prototype.actions$;
    /** @type {?} */
    HttpEffects.prototype.commands;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5lZmZlY3RzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9odHRwL2h0dHAuZWZmZWN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hELE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7SUFxQzNDLHFCQUNZLFVBQ0E7UUFGWixpQkFHSztRQUZPLGFBQVEsR0FBUixRQUFRO1FBQ1IsYUFBUSxHQUFSLFFBQVE7eUJBaENFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNwQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUMxQixRQUFRLENBQUMsVUFBQyxNQUFjLElBQUssT0FBQSxLQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBNUIsQ0FBNEIsQ0FBQyxDQUM3RDtzQkFFa0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2pDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQ3ZCLFFBQVEsQ0FBQyxVQUFDLE1BQWMsSUFBSyxPQUFBLEtBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUF6QixDQUF5QixDQUFDLENBQzFEO3VCQUVtQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDbEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJ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QVU7Ozs7Z0JBVEYsT0FBTztnQkFLUCxZQUFZOzs7UUFPaEIsTUFBTSxFQUFFOzs7O1FBS1IsTUFBTSxFQUFFOzs7O1FBS1IsTUFBTSxFQUFFOzs7O1FBS1IsTUFBTSxFQUFFOzs7O1FBS1IsTUFBTSxFQUFFOzs7O1FBS1IsTUFBTSxFQUFFOzs7c0JBdENiOztTQVdhLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGlvbnMsIEVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCwgbWVyZ2VNYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBIdHRwQWN0aW9ucyB9IGZyb20gJy4vaHR0cC5hY3Rpb25zJztcclxuaW1wb3J0IHsgSHR0cENvbW1hbmRzIH0gZnJvbSAnLi9odHRwLmNvbW1hbmRzJztcclxuaW1wb3J0IHsgSHR0cEdldFBheWxvYWQsIEh0dHBQb3N0UGF5bG9hZCwgSHR0cFB1dFBheWxvYWQsIEh0dHBEZWxldGVQYXlsb2FkIH0gZnJvbSAnLi9odHRwLm1vZGVscyc7XHJcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uL3N0b3JlL21vZGVscyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBIdHRwRWZmZWN0czxUPiB7XHJcblxyXG4gICAgQEVmZmVjdCgpIG9uRGVsZXRlJCA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgICAgICBvZlR5cGUoSHR0cEFjdGlvbnMuREVMRVRFKSxcclxuICAgICAgICBtZXJnZU1hcCgoYWN0aW9uOiBBY3Rpb24pID0+IHRoaXMuZGVsZXRlJChhY3Rpb24ucGF5bG9hZCkpXHJcbiAgICApO1xyXG5cclxuICAgIEBFZmZlY3QoKSBvbkdldCQgPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICAgICAgb2ZUeXBlKEh0dHBBY3Rpb25zLkdFVCksXHJcbiAgICAgICAgbWVyZ2VNYXAoKGFjdGlvbjogQWN0aW9uKSA9PiB0aGlzLmdldCQoYWN0aW9uLnBheWxvYWQpKVxyXG4gICAgKTtcclxuXHJcbiAgICBARWZmZWN0KCkgb25Qb3N0JCA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgICAgICBvZlR5cGUoSHR0cEFjdGlvbnMuUE9TVCksXHJcbiAgICAgICAgbWVyZ2VNYXAoKGFjdGlvbjogQWN0aW9uKSA9PiB0aGlzLnBvc3QkKGFjdGlvbi5wYXlsb2FkKSlcclxuICAgICk7XHJcblxyXG4gICAgQEVmZmVjdCgpIG9uUG9zdEZvcm1VcmxFbmNvZGVkJCA9IHRoaXMuYWN0aW9ucyQucGlwZShcclxuICAgICAgICBvZlR5cGUoSHR0cEFjdGlvbnMuUE9TVF9GT1JNX1VSTF9FTkNPREVEKSxcclxuICAgICAgICBtZXJnZU1hcCgoYWN0aW9uOiBBY3Rpb24pID0+IHRoaXMucG9zdEZvcm1VcmxFbmNvZGVkJChhY3Rpb24ucGF5bG9hZCkpXHJcbiAgICApO1xyXG5cclxuICAgIEBFZmZlY3QoKSBvblB1dCQgPSB0aGlzLmFjdGlvbnMkLnBpcGUoXHJcbiAgICAgICAgb2ZUeXBlKEh0dHBBY3Rpb25zLlBVVCksXHJcbiAgICAgICAgbWVyZ2VNYXAoKGFjdGlvbjogQWN0aW9uKSA9PiB0aGlzLnB1dCQoYWN0aW9uLnBheWxvYWQpKVxyXG4gICAgKTtcclxuXHJcbiAgICBARWZmZWN0KCkgb25TZWFyY2gkID0gdGhpcy5hY3Rpb25zJC5waXBlKFxyXG4gICAgICAgIG9mVHlwZShIdHRwQWN0aW9ucy5TRUFSQ0gpLFxyXG4gICAgICAgIG1lcmdlTWFwKChhY3Rpb246IEFjdGlvbikgPT4gdGhpcy5zZWFyY2gkKGFjdGlvbi5wYXlsb2FkKSlcclxuICAgICk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcclxuICAgICAgICBwcml2YXRlIGNvbW1hbmRzOiBIdHRwQ29tbWFuZHM8VD5cclxuICAgICkgeyB9XHJcblxyXG4gICAgZGVsZXRlJChwYXlsb2FkOiBIdHRwRGVsZXRlUGF5bG9hZDxUPik6IE9ic2VydmFibGU8QWN0aW9uPiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0RFTEVURTpcXHQnLCBwYXlsb2FkLm9uU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZHMuZGVsZXRlJChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5kZWxldGVTdWNjZXNzKHBheWxvYWQub25TdWNjZXNzUGF5bG9hZCB8fCBtb2RlbCwgcGF5bG9hZC5vblN1Y2Nlc3MpKSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZTogRXJyb3IpID0+IG9mKEh0dHBBY3Rpb25zLmRlbGV0ZUVycm9yKGUsIHBheWxvYWQub25FcnJvcikpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0JChwYXlsb2FkOiBIdHRwR2V0UGF5bG9hZDxUPik6IE9ic2VydmFibGU8QWN0aW9uPiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0dFVDpcXHQnLCBwYXlsb2FkLm9uU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZHMuZ2V0JChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5nZXRTdWNjZXNzKG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcykpLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlOiBFcnJvcikgPT4gb2YoSHR0cEFjdGlvbnMuZ2V0RXJyb3IoZSwgcGF5bG9hZC5vbkVycm9yKSkpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwb3N0JChwYXlsb2FkOiBIdHRwUG9zdFBheWxvYWQ8VD4pOiBPYnNlcnZhYmxlPEFjdGlvbj4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdQT1NUOlxcdCcsIHBheWxvYWQub25TdWNjZXNzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21tYW5kcy5wb3N0JChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5wb3N0U3VjY2Vzcyhtb2RlbCwgcGF5bG9hZC5vblN1Y2Nlc3MpKSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZTogRXJyb3IpID0+IG9mKEh0dHBBY3Rpb25zLnBvc3RFcnJvcihlLCBwYXlsb2FkLm9uRXJyb3IpKSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHBvc3RGb3JtVXJsRW5jb2RlZCQocGF5bG9hZDogSHR0cFBvc3RQYXlsb2FkPFQ+KTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnUE9TVDpcXHQnLCBwYXlsb2FkLm9uU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZHMucG9zdEZvcm1VcmxFbmNvZGVkJChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5wb3N0U3VjY2Vzcyhtb2RlbCwgcGF5bG9hZC5vblN1Y2Nlc3MpKSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZTogRXJyb3IpID0+IG9mKEh0dHBBY3Rpb25zLnBvc3RFcnJvcihlLCBwYXlsb2FkLm9uRXJyb3IpKSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1dCQocGF5bG9hZDogSHR0cFB1dFBheWxvYWQ8VD4pOiBPYnNlcnZhYmxlPEFjdGlvbj4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdQVVQ6XFx0JywgcGF5bG9hZC5vblN1Y2Nlc3MpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbW1hbmRzLnB1dCQocGF5bG9hZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKChtb2RlbDogVCkgPT4gSHR0cEFjdGlvbnMucHV0U3VjY2Vzcyhtb2RlbCwgcGF5bG9hZC5vblN1Y2Nlc3MpKSxcclxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZTogRXJyb3IpID0+IG9mKEh0dHBBY3Rpb25zLnB1dEVycm9yKGUsIHBheWxvYWQub25FcnJvcikpKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VhcmNoJChwYXlsb2FkOiBIdHRwR2V0UGF5bG9hZDxUPik6IE9ic2VydmFibGU8QWN0aW9uPiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ1NFQVJDSDpcXHQnLCBwYXlsb2FkLm9uU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZHMuZ2V0JChwYXlsb2FkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vZGVsOiBUKSA9PiBIdHRwQWN0aW9ucy5zZWFyY2hTdWNjZXNzKG1vZGVsLCBwYXlsb2FkLm9uU3VjY2VzcywgcGF5bG9hZC5wYXRoKSksXHJcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGU6IEVycm9yKSA9PiBvZihIdHRwQWN0aW9ucy5nZXRFcnJvcihlLCBwYXlsb2FkLm9uRXJyb3IpKSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==