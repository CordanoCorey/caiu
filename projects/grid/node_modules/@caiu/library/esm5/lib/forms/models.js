/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { FormArray as Ng2FormArray } from '@angular/forms';
import { buildAbstractControl, buildControlsConfig } from './utils';
import { build, getValue, toArray } from '../shared/utils';
var FormArray = /** @class */ (function (_super) {
    tslib_1.__extends(FormArray, _super);
    function FormArray(fb, controls, validator, asyncValidator) {
        var _this = _super.call(this, controls, validator, asyncValidator) || this;
        _this.fb = fb;
        return _this;
    }
    /**
     * @template T
     * @param {?} fb
     * @param {?} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    FormArray.Build = /**
     * @template T
     * @param {?} fb
     * @param {?} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    function (fb, controls, validator, asyncValidator) {
        return new FormArray(fb, controls, validator, asyncValidator);
    };
    /**
     * @template T
     * @param {?} ctor
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    FormArray.BuildWithType = /**
     * @template T
     * @param {?} ctor
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    function (ctor, fb, controls, validator, asyncValidator) {
        if (controls === void 0) { controls = []; }
        var /** @type {?} */ fa = new FormArray(fb, controls, validator, asyncValidator);
        fa.ctor = ctor;
        return fa;
    };
    /**
     * @template T
     * @param {?} ctor
     * @param {?} value
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    FormArray.BuildWithTypeAndValue = /**
     * @template T
     * @param {?} ctor
     * @param {?} value
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    function (ctor, value, fb, controls, validator, asyncValidator) {
        if (controls === void 0) { controls = []; }
        var /** @type {?} */ fa = new FormArray(fb, controls, validator, asyncValidator);
        fa.ctor = ctor;
        fa.setValue(value);
        return fa;
    };
    /**
     * @template T
     * @param {?} value
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    FormArray.BuildWithValue = /**
     * @template T
     * @param {?} value
     * @param {?} fb
     * @param {?=} controls
     * @param {?=} validator
     * @param {?=} asyncValidator
     * @return {?}
     */
    function (value, fb, controls, validator, asyncValidator) {
        if (controls === void 0) { controls = []; }
        var /** @type {?} */ fa = new FormArray(fb, controls, validator, asyncValidator);
        fa.setValue(value);
        return fa;
    };
    /**
     * @param {?} value
     * @param {?} ctor
     * @return {?}
     */
    FormArray.GetValue = /**
     * @param {?} value
     * @param {?} ctor
     * @return {?}
     */
    function (value, ctor) {
        return toArray(value).map(function (x) { return getValue(build(ctor, x)); });
    };
    Object.defineProperty(FormArray.prototype, "maxIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this.length - 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FormArray.prototype, "values", {
        get: /**
         * @return {?}
         */
        function () {
            return tslib_1.__spread(this.value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} n
     * @return {?}
     */
    FormArray.prototype.buildControls = /**
     * @param {?} n
     * @return {?}
     */
    function (n) {
        var _this = this;
        return this.buildItems(n).map(function (x) { return buildAbstractControl(_this.fb, x); });
    };
    /**
     * @param {?} n
     * @return {?}
     */
    FormArray.prototype.buildItems = /**
     * @param {?} n
     * @return {?}
     */
    function (n) {
        var _this = this;
        return Array.from(Array(n).keys()).map(function (x) { return _this.ctor ? getValue(new _this.ctor()) : {}; });
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FormArray.prototype.getValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        return this.ctor ? toArray(value).map(function (x) { return getValue(build(_this.ctor, x)); }) : value;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FormArray.prototype.resetValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.removeAll();
        this.addControls(value);
        this.setValue(value);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FormArray.prototype.setLength = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (this.length < value) {
            this.add(value - this.length);
        }
        else if (this.length > value) {
            this.remove(this.length - value);
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FormArray.prototype.setValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.setLength(value.length);
        _super.prototype.setValue.call(this, this.getValue(value));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    FormArray.prototype.findControlById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.controls.find(function (control) { return control.value && control.value['id'] && control.value['id'] === id; });
    };
    /**
     * @return {?}
     */
    FormArray.prototype.removeAll = /**
     * @return {?}
     */
    function () {
        this.controls = [];
    };
    /**
     * @param {?} indexes
     * @return {?}
     */
    FormArray.prototype.removeIndexes = /**
     * @param {?} indexes
     * @return {?}
     */
    function (indexes) {
        var _this = this;
        indexes.forEach(function (index) {
            _this.removeAt(index);
        });
    };
    /**
     * @param {?} n
     * @return {?}
     */
    FormArray.prototype.add = /**
     * @param {?} n
     * @return {?}
     */
    function (n) {
        var _this = this;
        this.buildControls(n).forEach(function (x) {
            _this.push(x);
        });
    };
    /**
     * @param {?} n
     * @return {?}
     */
    FormArray.prototype.remove = /**
     * @param {?} n
     * @return {?}
     */
    function (n) {
        var _this = this;
        var /** @type {?} */ k = Math.min(n, this.length);
        Array.from(Array(k).keys()).forEach(function (x) {
            _this.removeAt(_this.maxIndex);
        });
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FormArray.prototype.addControls = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        var /** @type {?} */ controls = value.map(function (x) { return _this.fb.group(buildControlsConfig(x, _this.fb)); });
        controls.forEach(function (control) {
            _this.push(control);
        });
    };
    /**
     * Set value of each control.
     * @param ctor Class constructor
     * @param props Values to assign to props of each control
     */
    /**
     * Set value of each control.
     * @param {?} ctor Class constructor
     * @param {?} props Values to assign to props of each control
     * @return {?}
     */
    FormArray.prototype.setAll = /**
     * Set value of each control.
     * @param {?} ctor Class constructor
     * @param {?} props Values to assign to props of each control
     * @return {?}
     */
    function (ctor, props) {
        this.controls.forEach(function (control) {
            control.setValue(build(new ctor(), control.value, props));
        });
    };
    return FormArray;
}(Ng2FormArray));
export { FormArray };
function FormArray_tsickle_Closure_declarations() {
    /** @type {?} */
    FormArray.prototype.ctor;
    /** @type {?} */
    FormArray.prototype.fb;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9tb2RlbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWdDLFNBQVMsSUFBSSxZQUFZLEVBQWlDLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEgsT0FBTyxFQUFFLG9CQUFvQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRXBFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNELElBQUE7SUFBK0IscUNBQVk7SUErQnZDLG1CQUFtQixFQUFlLEVBQUUsUUFBMkIsRUFBRSxTQUF1QixFQUFFLGNBQWlDO1FBQTNILFlBQ0ksa0JBQU0sUUFBUSxFQUFFLFNBQVMsRUFBRSxjQUFjLENBQUMsU0FDN0M7UUFGa0IsUUFBRSxHQUFGLEVBQUUsQ0FBYTs7S0FFakM7Ozs7Ozs7OztJQTdCTSxlQUFLOzs7Ozs7OztJQUFaLFVBQWdCLEVBQWUsRUFBRSxRQUEyQixFQUFFLFNBQXVCLEVBQUUsY0FBaUM7UUFDcEgsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0tBQ2pFOzs7Ozs7Ozs7O0lBRU0sdUJBQWE7Ozs7Ozs7OztJQUFwQixVQUF3QixJQUF3QixFQUFFLEVBQWUsRUFBRSxRQUFnQyxFQUFFLFNBQXVCLEVBQUUsY0FBaUM7UUFBNUYseUJBQUEsRUFBQSxhQUFnQztRQUMvRixxQkFBTSxFQUFFLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDbEUsRUFBRSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDZixNQUFNLENBQUMsRUFBRSxDQUFDO0tBQ2I7Ozs7Ozs7Ozs7O0lBRU0sK0JBQXFC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QyxDQUFDLENBQUM7U0FDN0QsQ0FBQyxDQUFDO0tBQ047b0JBM0hMO0VBTStCLFlBQVksRUF1SDFDLENBQUE7QUF2SEQscUJBdUhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBGb3JtQnVpbGRlciwgRm9ybUFycmF5IGFzIE5nMkZvcm1BcnJheSwgVmFsaWRhdG9yRm4sIEFzeW5jVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5pbXBvcnQgeyBidWlsZEFic3RyYWN0Q29udHJvbCwgYnVpbGRDb250cm9sc0NvbmZpZyB9IGZyb20gJy4vdXRpbHMnO1xyXG5pbXBvcnQgeyBUeXBlQ29uc3RydWN0b3IgfSBmcm9tICcuLi9zaGFyZWQvbW9kZWxzJztcclxuaW1wb3J0IHsgYnVpbGQsIGdldFZhbHVlLCB0b0FycmF5IH0gZnJvbSAnLi4vc2hhcmVkL3V0aWxzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBGb3JtQXJyYXkgZXh0ZW5kcyBOZzJGb3JtQXJyYXkge1xyXG5cclxuICAgIGN0b3I6IFR5cGVDb25zdHJ1Y3Rvcjxhbnk+O1xyXG5cclxuICAgIHN0YXRpYyBCdWlsZDxUPihmYjogRm9ybUJ1aWxkZXIsIGNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSwgdmFsaWRhdG9yPzogVmFsaWRhdG9yRm4sIGFzeW5jVmFsaWRhdG9yPzogQXN5bmNWYWxpZGF0b3JGbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgRm9ybUFycmF5KGZiLCBjb250cm9scywgdmFsaWRhdG9yLCBhc3luY1ZhbGlkYXRvcik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEJ1aWxkV2l0aFR5cGU8VD4oY3RvcjogVHlwZUNvbnN0cnVjdG9yPFQ+LCBmYjogRm9ybUJ1aWxkZXIsIGNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSA9IFtdLCB2YWxpZGF0b3I/OiBWYWxpZGF0b3JGbiwgYXN5bmNWYWxpZGF0b3I/OiBBc3luY1ZhbGlkYXRvckZuKSB7XHJcbiAgICAgICAgY29uc3QgZmEgPSBuZXcgRm9ybUFycmF5KGZiLCBjb250cm9scywgdmFsaWRhdG9yLCBhc3luY1ZhbGlkYXRvcik7XHJcbiAgICAgICAgZmEuY3RvciA9IGN0b3I7XHJcbiAgICAgICAgcmV0dXJuIGZhO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBCdWlsZFdpdGhUeXBlQW5kVmFsdWU8VD4oY3RvcjogVHlwZUNvbnN0cnVjdG9yPFQ+LCB2YWx1ZTogVFtdLCBmYjogRm9ybUJ1aWxkZXIsIGNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSA9IFtdLCB2YWxpZGF0b3I/OiBWYWxpZGF0b3JGbiwgYXN5bmNWYWxpZGF0b3I/OiBBc3luY1ZhbGlkYXRvckZuKSB7XHJcbiAgICAgICAgY29uc3QgZmEgPSBuZXcgRm9ybUFycmF5KGZiLCBjb250cm9scywgdmFsaWRhdG9yLCBhc3luY1ZhbGlkYXRvcik7XHJcbiAgICAgICAgZmEuY3RvciA9IGN0b3I7XHJcbiAgICAgICAgZmEuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBmYTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgQnVpbGRXaXRoVmFsdWU8VD4odmFsdWU6IFRbXSwgZmI6IEZvcm1CdWlsZGVyLCBjb250cm9sczogQWJzdHJhY3RDb250cm9sW10gPSBbXSwgdmFsaWRhdG9yPzogVmFsaWRhdG9yRm4sIGFzeW5jVmFsaWRhdG9yPzogQXN5bmNWYWxpZGF0b3JGbikge1xyXG4gICAgICAgIGNvbnN0IGZhID0gbmV3IEZvcm1BcnJheShmYiwgY29udHJvbHMsIHZhbGlkYXRvciwgYXN5bmNWYWxpZGF0b3IpO1xyXG4gICAgICAgIGZhLnNldFZhbHVlKHZhbHVlKTtcclxuICAgICAgICByZXR1cm4gZmE7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEdldFZhbHVlKHZhbHVlOiBhbnlbXSwgY3RvcjogVHlwZUNvbnN0cnVjdG9yPGFueT4pOiBhbnlbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRvQXJyYXkodmFsdWUpLm1hcCh4ID0+IGdldFZhbHVlKGJ1aWxkKGN0b3IsIHgpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGZiOiBGb3JtQnVpbGRlciwgY29udHJvbHM6IEFic3RyYWN0Q29udHJvbFtdLCB2YWxpZGF0b3I/OiBWYWxpZGF0b3JGbiwgYXN5bmNWYWxpZGF0b3I/OiBBc3luY1ZhbGlkYXRvckZuKSB7XHJcbiAgICAgICAgc3VwZXIoY29udHJvbHMsIHZhbGlkYXRvciwgYXN5bmNWYWxpZGF0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBtYXhJbmRleCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCAtIDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZhbHVlcygpOiBhbnlbXSB7XHJcbiAgICAgICAgcmV0dXJuIFsuLi50aGlzLnZhbHVlXTtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZENvbnRyb2xzKG46IG51bWJlcik6IEFic3RyYWN0Q29udHJvbFtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5idWlsZEl0ZW1zKG4pLm1hcCh4ID0+IGJ1aWxkQWJzdHJhY3RDb250cm9sKHRoaXMuZmIsIHgpKTtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZEl0ZW1zKG46IG51bWJlcik6IGFueVtdIHtcclxuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShBcnJheShuKS5rZXlzKCkpLm1hcCh4ID0+IHRoaXMuY3RvciA/IGdldFZhbHVlKG5ldyB0aGlzLmN0b3IoKSkgOiB7fSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmFsdWUodmFsdWU6IGFueVtdKTogYW55W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN0b3IgPyB0b0FycmF5KHZhbHVlKS5tYXAoeCA9PiBnZXRWYWx1ZShidWlsZCh0aGlzLmN0b3IsIHgpKSkgOiB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldFZhbHVlKHZhbHVlOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQWxsKCk7XHJcbiAgICAgICAgdGhpcy5hZGRDb250cm9scyh2YWx1ZSk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TGVuZ3RoKHZhbHVlOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPCB2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFkZCh2YWx1ZSAtIHRoaXMubGVuZ3RoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubGVuZ3RoID4gdmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmUodGhpcy5sZW5ndGggLSB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFZhbHVlKHZhbHVlOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMuc2V0TGVuZ3RoKHZhbHVlLmxlbmd0aCk7XHJcbiAgICAgICAgc3VwZXIuc2V0VmFsdWUodGhpcy5nZXRWYWx1ZSh2YWx1ZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRDb250cm9sQnlJZChpZDogYW55KTogQWJzdHJhY3RDb250cm9sIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9scy5maW5kKGNvbnRyb2wgPT4gY29udHJvbC52YWx1ZSAmJiBjb250cm9sLnZhbHVlWydpZCddICYmIGNvbnRyb2wudmFsdWVbJ2lkJ10gPT09IGlkKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVBbGwoKSB7XHJcbiAgICAgICAgdGhpcy5jb250cm9scyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUluZGV4ZXMoaW5kZXhlczogYW55W10pIHtcclxuICAgICAgICBpbmRleGVzLmZvckVhY2goaW5kZXggPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUF0KGluZGV4KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhZGQobjogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5idWlsZENvbnRyb2xzKG4pLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHVzaCh4KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmUobjogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgayA9IE1hdGgubWluKG4sIHRoaXMubGVuZ3RoKTtcclxuICAgICAgICBBcnJheS5mcm9tKEFycmF5KGspLmtleXMoKSkuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVBdCh0aGlzLm1heEluZGV4KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRDb250cm9scyh2YWx1ZTogYW55W10pIHtcclxuICAgICAgICBjb25zdCBjb250cm9scyA9IHZhbHVlLm1hcCh4ID0+IHRoaXMuZmIuZ3JvdXAoYnVpbGRDb250cm9sc0NvbmZpZyh4LCB0aGlzLmZiKSkpO1xyXG4gICAgICAgIGNvbnRyb2xzLmZvckVhY2goY29udHJvbCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHVzaChjb250cm9sKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCB2YWx1ZSBvZiBlYWNoIGNvbnRyb2wuXHJcbiAgICAgKiBAcGFyYW0gY3RvciBDbGFzcyBjb25zdHJ1Y3RvclxyXG4gICAgICogQHBhcmFtIHByb3BzIFZhbHVlcyB0byBhc3NpZ24gdG8gcHJvcHMgb2YgZWFjaCBjb250cm9sXHJcbiAgICAgKi9cclxuICAgIHNldEFsbChjdG9yOiBUeXBlQ29uc3RydWN0b3I8YW55PiwgcHJvcHM6IGFueSkge1xyXG4gICAgICAgIHRoaXMuY29udHJvbHMuZm9yRWFjaChjb250cm9sID0+IHtcclxuICAgICAgICAgICAgY29udHJvbC5zZXRWYWx1ZShidWlsZChuZXcgY3RvcigpLCBjb250cm9sLnZhbHVlLCBwcm9wcykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=