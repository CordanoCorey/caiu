/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { compareNumbers } from './utils';
/**
 * @template T
 */
var /**
 * @template T
 */
TreeItem = /** @class */ (function () {
    function TreeItem(item, parent) {
        this.item = item;
        this.parent = parent;
        this.id = 0;
        this.order = 0;
        this.parentId = 0;
        this.treeId = 0;
        this.index = 0;
    }
    /**
     * @template T
     * @param {?} item
     * @return {?}
     */
    TreeItem.Build = /**
     * @template T
     * @param {?} item
     * @return {?}
     */
    function (item) {
        return /** @type {?} */ ({
            item: item,
            id: item['id'],
            order: item['order'],
            parentId: item['parentId']
        });
    };
    Object.defineProperty(TreeItem.prototype, "hasParent", {
        get: /**
         * @return {?}
         */
        function () {
            return this.parentId ? true : false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeItem.prototype, "sortOrder", {
        get: /**
         * @return {?}
         */
        function () {
            return this.parentId ? this.treeId + (.1 * this.order) : this.treeId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeItem.prototype, "treeOrder", {
        get: /**
         * @return {?}
         */
        function () {
            return this.parentId ? this.order : 0;
        },
        enumerable: true,
        configurable: true
    });
    return TreeItem;
}());
/**
 * @template T
 */
export { TreeItem };
function TreeItem_tsickle_Closure_declarations() {
    /** @type {?} */
    TreeItem.prototype.id;
    /** @type {?} */
    TreeItem.prototype.order;
    /** @type {?} */
    TreeItem.prototype.parentId;
    /** @type {?} */
    TreeItem.prototype.treeId;
    /** @type {?} */
    TreeItem.prototype.index;
    /** @type {?} */
    TreeItem.prototype.item;
    /** @type {?} */
    TreeItem.prototype.parent;
}
/**
 * @template T
 */
var /**
 * @template T
 */
Tree = /** @class */ (function () {
    function Tree(_treeItems, ctor) {
        this._treeItems = _treeItems;
        this.ctor = ctor;
        this._activeId = 0;
        this._activeIndex = -1;
    }
    /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    Tree.FindParent = /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    function (items, item) {
        return items.find(function (x) { return x.id === item.parentId; }) || new TreeItem(/** @type {?} */ ({}));
    };
    /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    Tree.FindParentOrder = /**
     * @template T
     * @param {?} items
     * @param {?} item
     * @return {?}
     */
    function (items, item) {
        var /** @type {?} */ parent = Tree.FindParent(items, item);
        return parent.order;
    };
    /**
     * @template T
     * @param {?} items
     * @param {?} ctor
     * @return {?}
     */
    Tree.Build = /**
     * @template T
     * @param {?} items
     * @param {?} ctor
     * @return {?}
     */
    function (items, ctor) {
        var /** @type {?} */ treeItems = items.reduce(function (acc, item) {
            item.treeId = item.parentId ? Tree.FindParentOrder(items, item) : item.order;
            var /** @type {?} */ treeItem = Object.assign(new TreeItem(/** @type {?} */ ({})), item);
            return tslib_1.__spread(acc, [treeItem]);
        }, []);
        var /** @type {?} */ orderedItems = items.sort(function (a, b) { return compareNumbers(a.sortOrder, b.sortOrder); })
            .reduce(function (acc, treeItem, index) {
            var /** @type {?} */ item = treeItem.item;
            var /** @type {?} */ parent = treeItem.parent;
            return tslib_1.__spread(acc, [/** @type {?} */ (Object.assign(new TreeItem(item, parent), treeItem, { index: index + 1 }))]);
        }, []);
        return new Tree(orderedItems, ctor);
    };
    Object.defineProperty(Tree.prototype, "activeId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._activeId;
        },
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this._activeId = id;
            this._activeIndex = this.getIndexById(id);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "activeIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this._activeIndex;
        },
        set: /**
         * @param {?} index
         * @return {?}
         */
        function (index) {
            this._activeIndex = index;
            this._activeId = this.getIdByIndex(index);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "copy", {
        get: /**
         * @return {?}
         */
        function () {
            return Object.assign(new Tree(this._treeItems, this.ctor), this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "instance", {
        get: /**
         * @return {?}
         */
        function () {
            return new this.ctor() || /** @type {?} */ ({});
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "next", {
        get: /**
         * @return {?}
         */
        function () {
            return this.getNext(this.activeIndex);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "nextId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.next.id;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "nextIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this.activeIndex + 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "previous", {
        get: /**
         * @return {?}
         */
        function () {
            return this.getPrevious(this.activeIndex);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "previousId", {
        get: /**
         * @return {?}
         */
        function () {
            return this.previous.id;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "previousIndex", {
        get: /**
         * @return {?}
         */
        function () {
            return this.activeIndex - 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "items", {
        get: /**
         * @return {?}
         */
        function () {
            return this._treeItems.map(function (x) { return x.item; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "treeItems", {
        get: /**
         * @return {?}
         */
        function () {
            return this._treeItems;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "orderedItems", {
        get: /**
         * @return {?}
         */
        function () {
            return this.treeItems.sort(function (a, b) { return compareNumbers(a.index, b.index); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "subtrees", {
        get: /**
         * @return {?}
         */
        function () {
            var _this = this;
            var /** @type {?} */ trees = this.treeItems.reduce(function (acc, item) {
                var /** @type {?} */ treeId = item.treeId;
                var /** @type {?} */ subitems = acc[treeId] || [];
                acc[treeId] = tslib_1.__spread(subitems, [item]);
                return acc;
            }, {});
            return Object.keys(trees).map(function (key) { return Tree.Build(trees[key], _this.ctor); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Tree.prototype, "subtreeItems", {
        get: /**
         * @return {?}
         */
        function () {
            return this.subtrees.map(function (tree) { return tree.treeItems.sort(function (a, b) { return compareNumbers(a.index, b.index); }); });
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getIdByIndex = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        var /** @type {?} */ item = this.getItemByIndex(index);
        return item.id;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    Tree.prototype.getIndexById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.getItemById(id).index;
    };
    /**
     * @param {?} id
     * @return {?}
     */
    Tree.prototype.getItemById = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.treeItems.find(function (item) { return item.id === id; }) || new TreeItem(this.instance);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getItemByIndex = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.treeItems.find(function (item) { return item.index === index; }) || new TreeItem(this.instance);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getNext = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.getItemByIndex(index + 1);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getNextId = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.getNext(index).id;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getPrevious = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.getItemByIndex(index - 1);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    Tree.prototype.getPreviousId = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.getPrevious(index).id;
    };
    return Tree;
}());
/**
 * @template T
 */
export { Tree };
function Tree_tsickle_Closure_declarations() {
    /** @type {?} */
    Tree.prototype._activeId;
    /** @type {?} */
    Tree.prototype._activeIndex;
    /** @type {?} */
    Tree.prototype._treeItems;
    /** @type {?} */
    Tree.prototype.ctor;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjYWl1L2xpYnJhcnkvIiwic291cmNlcyI6WyJsaWIvc2hhcmVkL3RyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sU0FBUyxDQUFDOzs7O0FBRXpDOzs7QUFBQTtJQWlCSSxrQkFBbUIsSUFBTyxFQUFTLE1BQVU7UUFBMUIsU0FBSSxHQUFKLElBQUksQ0FBRztRQUFTLFdBQU0sR0FBTixNQUFNLENBQUk7a0JBZnhDLENBQUM7cUJBQ0UsQ0FBQzt3QkFDRSxDQUFDO3NCQUNILENBQUM7cUJBQ0YsQ0FBQztLQWFSOzs7Ozs7SUFYTSxjQUFLOzs7OztJQUFaLFVBQWdCLElBQU87UUFDbkIsTUFBTSxtQkFBYztZQUNoQixJQUFJLEVBQUUsSUFBSTtZQUNWLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2QsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUM7U0FDN0IsRUFBQztLQUNMO0lBTUQsc0JBQUksK0JBQVM7Ozs7UUFBYjtZQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUN2Qzs7O09BQUE7SUFFRCxzQkFBSSwrQkFBUzs7OztRQUFiO1lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1NBQ3hFOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFTOzs7O1FBQWI7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENB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d0JBQVM7Ozs7SUFBVCxVQUFVLEtBQWE7UUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO0tBQ2pDOzs7OztJQUVELDBCQUFXOzs7O0lBQVgsVUFBWSxLQUFhO1FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztLQUN6Qzs7Ozs7SUFFRCw0QkFBYTs7OztJQUFiLFVBQWMsS0FBYTtRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUM7S0FDckM7ZUEvS0w7SUFnTEMsQ0FBQTs7OztBQTNJRCxnQkEySUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUeXBlQ29uc3RydWN0b3IgfSBmcm9tICcuL21vZGVscyc7XHJcbmltcG9ydCB7IGNvbXBhcmVOdW1iZXJzIH0gZnJvbSAnLi91dGlscyc7XHJcblxyXG5leHBvcnQgY2xhc3MgVHJlZUl0ZW08VD4ge1xyXG5cclxuICAgIGlkID0gMDtcclxuICAgIG9yZGVyID0gMDtcclxuICAgIHBhcmVudElkID0gMDtcclxuICAgIHRyZWVJZCA9IDA7XHJcbiAgICBpbmRleCA9IDA7XHJcblxyXG4gICAgc3RhdGljIEJ1aWxkPFQ+KGl0ZW06IFQpOiBUcmVlSXRlbTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIDxUcmVlSXRlbTxUPj57XHJcbiAgICAgICAgICAgIGl0ZW06IGl0ZW0sXHJcbiAgICAgICAgICAgIGlkOiBpdGVtWydpZCddLFxyXG4gICAgICAgICAgICBvcmRlcjogaXRlbVsnb3JkZXInXSxcclxuICAgICAgICAgICAgcGFyZW50SWQ6IGl0ZW1bJ3BhcmVudElkJ11cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBpdGVtOiBULCBwdWJsaWMgcGFyZW50PzogVCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBnZXQgaGFzUGFyZW50KCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudElkID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzb3J0T3JkZXIoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnRJZCA/IHRoaXMudHJlZUlkICsgKC4xICogdGhpcy5vcmRlcikgOiB0aGlzLnRyZWVJZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdHJlZU9yZGVyKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50SWQgPyB0aGlzLm9yZGVyIDogMDtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFRyZWU8VD4ge1xyXG4gICAgX2FjdGl2ZUlkID0gMDtcclxuICAgIF9hY3RpdmVJbmRleCA9IC0xO1xyXG5cclxuICAgIHN0YXRpYyBGaW5kUGFyZW50PFQ+KGl0ZW1zOiBUcmVlSXRlbTxUPltdLCBpdGVtOiBUcmVlSXRlbTxUPik6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gaXRlbXMuZmluZCh4ID0+IHguaWQgPT09IGl0ZW0ucGFyZW50SWQpIHx8IG5ldyBUcmVlSXRlbTxUPig8VD57fSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEZpbmRQYXJlbnRPcmRlcjxUPihpdGVtczogVHJlZUl0ZW08VD5bXSwgaXRlbTogVHJlZUl0ZW08VD4pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IFRyZWUuRmluZFBhcmVudChpdGVtcywgaXRlbSk7XHJcbiAgICAgICAgcmV0dXJuIHBhcmVudC5vcmRlcjtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgQnVpbGQ8VD4oaXRlbXM6IFRyZWVJdGVtPFQ+W10sIGN0b3I6IFR5cGVDb25zdHJ1Y3RvcjxUPik6IFRyZWU8VD4ge1xyXG4gICAgICAgIGNvbnN0IHRyZWVJdGVtcyA9IGl0ZW1zLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0udHJlZUlkID0gaXRlbS5wYXJlbnRJZCA/IFRyZWUuRmluZFBhcmVudE9yZGVyKGl0ZW1zLCBpdGVtKSA6IGl0ZW0ub3JkZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVJdGVtID0gT2JqZWN0LmFzc2lnbihuZXcgVHJlZUl0ZW08VD4oPFQ+e30pLCBpdGVtKTtcclxuICAgICAgICAgICAgcmV0dXJuIFsuLi5hY2MsIHRyZWVJdGVtXTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJlZEl0ZW1zID0gaXRlbXMuc29ydCgoYSwgYikgPT4gY29tcGFyZU51bWJlcnMoYS5zb3J0T3JkZXIsIGIuc29ydE9yZGVyKSlcclxuICAgICAgICAgICAgLnJlZHVjZSgoYWNjOiBUcmVlSXRlbTxUPltdLCB0cmVlSXRlbTogVHJlZUl0ZW08VD4sIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0cmVlSXRlbS5pdGVtO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdHJlZUl0ZW0ucGFyZW50O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFsuLi5hY2MsIDxUcmVlSXRlbTxUPj5PYmplY3QuYXNzaWduKG5ldyBUcmVlSXRlbTxUPihpdGVtLCBwYXJlbnQpLCB0cmVlSXRlbSwgeyBpbmRleDogaW5kZXggKyAxIH0pXTtcclxuICAgICAgICAgICAgfSwgW10pO1xyXG4gICAgICAgIHJldHVybiBuZXcgVHJlZTxUPihvcmRlcmVkSXRlbXMsIGN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3RyZWVJdGVtczogVHJlZUl0ZW08VD5bXSwgcHVibGljIGN0b3I6IFR5cGVDb25zdHJ1Y3RvcjxUPikge1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBhY3RpdmVJZCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVJZDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgYWN0aXZlSWQoaWQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX2FjdGl2ZUlkID0gaWQ7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGFjdGl2ZUluZGV4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBhY3RpdmVJbmRleChpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSBpbmRleDtcclxuICAgICAgICB0aGlzLl9hY3RpdmVJZCA9IHRoaXMuZ2V0SWRCeUluZGV4KGluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY29weSgpOiBUcmVlPFQ+IHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgVHJlZTxUPih0aGlzLl90cmVlSXRlbXMsIHRoaXMuY3RvciksIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbnN0YW5jZSgpOiBUIHtcclxuICAgICAgICByZXR1cm4gbmV3IHRoaXMuY3RvcigpIHx8IDxUPnt9O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBuZXh0KCk6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXROZXh0KHRoaXMuYWN0aXZlSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBuZXh0SWQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uZXh0LmlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBuZXh0SW5kZXgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVJbmRleCArIDE7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHByZXZpb3VzKCk6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRQcmV2aW91cyh0aGlzLmFjdGl2ZUluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcHJldmlvdXNJZCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByZXZpb3VzLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwcmV2aW91c0luZGV4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlSW5kZXggLSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpdGVtcygpOiBUW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90cmVlSXRlbXMubWFwKHggPT4geC5pdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdHJlZUl0ZW1zKCk6IFRyZWVJdGVtPFQ+W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90cmVlSXRlbXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IG9yZGVyZWRJdGVtcygpOiBUcmVlSXRlbTxUPltdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmVlSXRlbXMuc29ydCgoYSwgYikgPT4gY29tcGFyZU51bWJlcnMoYS5pbmRleCwgYi5pbmRleCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBzdWJ0cmVlcygpOiBUcmVlPFQ+W10ge1xyXG4gICAgICAgIGNvbnN0IHRyZWVzID0gdGhpcy50cmVlSXRlbXMucmVkdWNlKChhY2MsIGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdHJlZUlkID0gaXRlbS50cmVlSWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHN1Yml0ZW1zID0gYWNjW3RyZWVJZF0gfHwgW107XHJcbiAgICAgICAgICAgIGFjY1t0cmVlSWRdID0gWy4uLnN1Yml0ZW1zLCBpdGVtXTtcclxuICAgICAgICAgICAgcmV0dXJuIGFjYztcclxuICAgICAgICB9LCB7fSk7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRyZWVzKS5tYXAoa2V5ID0+IFRyZWUuQnVpbGQodHJlZXNba2V5XSwgdGhpcy5jdG9yKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHN1YnRyZWVJdGVtcygpOiBUcmVlSXRlbTxUPltdW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN1YnRyZWVzLm1hcCh0cmVlID0+IHRyZWUudHJlZUl0ZW1zLnNvcnQoKGEsIGIpID0+IGNvbXBhcmVOdW1iZXJzKGEuaW5kZXgsIGIuaW5kZXgpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SWRCeUluZGV4KGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldEl0ZW1CeUluZGV4KGluZGV4KTtcclxuICAgICAgICByZXR1cm4gaXRlbS5pZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRJbmRleEJ5SWQoaWQ6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUJ5SWQoaWQpLmluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEl0ZW1CeUlkKGlkOiBudW1iZXIpOiBUcmVlSXRlbTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZUl0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBpZCkgfHwgbmV3IFRyZWVJdGVtPFQ+KHRoaXMuaW5zdGFuY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEl0ZW1CeUluZGV4KGluZGV4OiBudW1iZXIpOiBUcmVlSXRlbTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZUl0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmluZGV4ID09PSBpbmRleCkgfHwgbmV3IFRyZWVJdGVtPFQ+KHRoaXMuaW5zdGFuY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE5leHQoaW5kZXg6IG51bWJlcik6IFRyZWVJdGVtPFQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJdGVtQnlJbmRleChpbmRleCArIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE5leHRJZChpbmRleDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXROZXh0KGluZGV4KS5pZDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQcmV2aW91cyhpbmRleDogbnVtYmVyKTogVHJlZUl0ZW08VD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZW1CeUluZGV4KGluZGV4IC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UHJldmlvdXNJZChpbmRleDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRQcmV2aW91cyhpbmRleCkuaWQ7XHJcbiAgICB9XHJcbn1cclxuIl19