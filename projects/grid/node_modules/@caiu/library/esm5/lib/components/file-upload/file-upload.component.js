/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, Output, EventEmitter, forwardRef, Input, ViewEncapsulation, ChangeDetectorRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { BehaviorSubject } from 'rxjs';
import { FileUpload } from './file-upload.model';
import { Ordering } from '../../shared/ordering';
import { build, guid, equals } from '../../shared/utils';
export var /** @type {?} */ FILE_UPLOAD_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(function () { return FileUploadComponent; }),
    multi: true
};
var FileUploadComponent = /** @class */ (function () {
    function FileUploadComponent(ref) {
        this.ref = ref;
        this.id = "files-" + guid();
        this.multiple = false;
        this.ordered = true;
        this.preview = true;
        this.upload = new EventEmitter();
        this.changes$ = new BehaviorSubject(new FileUpload());
        this.ordering = new Ordering([], FileUpload, 'order', 'name');
    }
    Object.defineProperty(FileUploadComponent.prototype, "activeFile", {
        get: /**
         * @return {?}
         */
        function () {
            return this.hasUploads ? this.uploads[0] : new FileUpload();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileUploadComponent.prototype, "hasUploads", {
        get: /**
         * @return {?}
         */
        function () {
            return this.uploads.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileUploadComponent.prototype, "showMultiple", {
        get: /**
         * @return {?}
         */
        function () {
            return this.preview && this.multiple;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileUploadComponent.prototype, "uploads", {
        get: /**
         * @return {?}
         */
        function () {
            return this.ordering.items.filter(function (upload) { return upload.name !== ''; });
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.ordering.updateItems(value.filter(function (upload) { return upload.name !== ''; }));
            this.onChange(this.uploads);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileUploadComponent.prototype, "orderedUploads", {
        get: /**
         * @return {?}
         */
        function () {
            return this.uploads;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FileUploadComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.changes$.subscribe(function (upload) {
            _this.onUpload(upload);
        });
    };
    /**
     * @param {?} f
     * @return {?}
     */
    FileUploadComponent.prototype.add = /**
     * @param {?} f
     * @return {?}
     */
    function (f) {
        if (!this.multiple && this.hasUploads) {
            this.remove();
        }
        this.uploads = this.ordering.addItem(f);
    };
    /**
     * @return {?}
     */
    FileUploadComponent.prototype.emit = /**
     * @return {?}
     */
    function () {
        if (this.value.length > 0) {
            if (this.multiple) {
                this.upload.emit(this.value);
            }
            else {
                this.upload.emit(this.value[0]);
            }
        }
    };
    /**
     * @param {?} f
     * @return {?}
     */
    FileUploadComponent.prototype.moveUp = /**
     * @param {?} f
     * @return {?}
     */
    function (f) {
        this.uploads = this.ordering.moveUp(f);
    };
    /**
     * @param {?} f
     * @return {?}
     */
    FileUploadComponent.prototype.moveDown = /**
     * @param {?} f
     * @return {?}
     */
    function (f) {
        this.uploads = this.ordering.moveDown(f);
    };
    /**
     * @param {?=} f
     * @return {?}
     */
    FileUploadComponent.prototype.remove = /**
     * @param {?=} f
     * @return {?}
     */
    function (f) {
        var /** @type {?} */ removeFile = f || this.activeFile;
        this.uploads = this.ordering.removeItem(removeFile);
    };
    /**
     * @param {?} f
     * @return {?}
     */
    FileUploadComponent.prototype.update = /**
     * @param {?} f
     * @return {?}
     */
    function (f) {
        var /** @type {?} */ index = this.uploads.findIndex(function (item) { return item['name'] === f.name; });
        if (index === -1) {
            this.add(f);
        }
        else {
            this.uploads = this.uploads.map(function (x, i) { return i === index ? build(FileUpload, f, { order: x.order }) : x; });
            this.ref.detectChanges();
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    FileUploadComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onModelChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    FileUploadComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouch = fn;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FileUploadComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.value = value;
        this.uploadAll(value);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FileUploadComponent.prototype.onChange = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!equals(this.value, value)) {
            this.value = value;
            if (value.every(function (x) { return x.readyState === 'DONE'; })) {
                this.emit();
            }
            if (this.onModelChange) {
                this.onModelChange(value);
            }
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    FileUploadComponent.prototype.onInputChange = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var /** @type {?} */ input = event.target;
        var /** @type {?} */ files = input['files'];
        if (files && files.length > 0) {
            for (var /** @type {?} */ i = 0; i < files.length; i++) {
                this.setupReader(files[i]);
            }
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FileUploadComponent.prototype.onBlur = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.focused = [];
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FileUploadComponent.prototype.onFocus = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.focused = value;
        this.onTouch();
    };
    /**
     * @param {?} upload
     * @return {?}
     */
    FileUploadComponent.prototype.onUpload = /**
     * @param {?} upload
     * @return {?}
     */
    function (upload) {
        var /** @type {?} */ f = build(FileUpload, upload);
        this.update(f);
    };
    /**
     * @param {?} file
     * @return {?}
     */
    FileUploadComponent.prototype.setupReader = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        var /** @type {?} */ reader = new FileReader();
        var /** @type {?} */ changes$ = this.changes$;
        var /** @type {?} */ upload = build(FileUpload, {
            lastModified: file['lastModified'],
            lastModifiedDate: file['lastModifiedDate'],
            name: file['name'],
            size: file['size'],
            type: file['type'],
            webkitRelativePath: file['webkitRelativePath']
        });
        reader.onload = function (e) {
            var /** @type {?} */ src = reader.result;
            var /** @type {?} */ readyState = FileUpload.GetReadyState(reader);
            changes$.next(Object.assign(upload, { src: src, readyState: readyState }));
        };
        reader.readAsDataURL(file);
        this.onUpload(build(FileUpload, upload, { readyState: FileUpload.GetReadyState(reader) }));
    };
    /**
     * @param {?} uploads
     * @return {?}
     */
    FileUploadComponent.prototype.uploadAll = /**
     * @param {?} uploads
     * @return {?}
     */
    function (uploads) {
        var _this = this;
        uploads.forEach(function (upload) {
            _this.onUpload(upload);
        });
    };
    FileUploadComponent.decorators = [
        { type: Component, args: [{
                    selector: 'iu-file-upload',
                    template: "<div class=\"file-upload\">\n  <div class=\"box\" fxLayout=\"row\" fxLayoutAlign=\"center end\">\n    <p id=\"dragdrop-message\" *ngIf=\"showMultiple\">\n      <strong>Choose files</strong>\n      <span class=\"dragndrop\"> or drag them here</span>.\n    </p>\n    <input id=\"file-upload\" *ngIf=\"showMultiple\" type=\"file\" (change)=\"onInputChange($event)\" [id]=\"id\" multiple/>\n    <p id=\"dragdrop-message\" *ngIf=\"!multiple\">\n      <strong>Choose a file</strong>\n      <span class=\"dragndrop\"> or drag it here</span>.\n    </p>\n    <input id=\"file-upload\" *ngIf=\"!multiple\" type=\"file\" (change)=\"onInputChange($event)\" [id]=\"id\" />\n    <label [for]=\"id\" class=\"custom-file-upload\">\n      <figure>\n        <mat-icon>cloud_upload</mat-icon>\n      </figure>\n    </label>\n  </div>\n  <iu-uploads *ngIf=\"multiple\" [uploads]=\"uploads\" [ordered]=\"ordered\" (moveUp)=\"moveUp($event)\" (moveDown)=\"moveDown($event)\"\n    (remove)=\"remove($event)\"></iu-uploads>\n  <iu-upload *ngIf=\"preview && !multiple && hasUploads\" [upload]=\"activeFile\" [height]=\"200\" (remove)=\"remove()\"></iu-upload>\n</div>\n",
                    styles: [".file-upload{margin:10px;padding:10px}.file-upload input[type=file]{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.file-upload .box{padding:100px 20px;margin:10px;display:flex;outline:-webkit-focus-ring-color auto 5px;outline-offset:-10px;position:relative}.file-upload .box #dragdrop-message{position:absolute;top:60px;max-width:80%;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;font-size:24px}.file-upload .box #dragdrop-message span{display:inline}.file-upload .custom-file-upload{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12);max-width:80%;font-size:20px;font-weight:700;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;display:inline-block;overflow:hidden;padding:10px 20px;margin-top:50px}.file-upload .custom-file-upload figure{width:50px;height:70px;display:flex;position:relative;padding:30px;margin:0 auto 10px}.file-upload .custom-file-upload figure mat-icon{font-size:50px;height:50px;width:50px}.file-upload .custom-file-upload figure::after,.file-upload .custom-file-upload figure::before{width:0;height:0;content:'';position:absolute;top:0;right:0}.file-upload .custom-file-upload figure::before{border-left:20px solid transparent}.file-upload .custom-file-upload figure::after{border-right:20px solid transparent}"],
                    providers: [FILE_UPLOAD_ACCESSOR],
                    encapsulation: ViewEncapsulation.None
                },] },
    ];
    /** @nocollapse */
    FileUploadComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    FileUploadComponent.propDecorators = {
        id: [{ type: Input }],
        multiple: [{ type: Input }],
        ordered: [{ type: Input }],
        preview: [{ type: Input }],
        upload: [{ type: Output }]
    };
    return FileUploadComponent;
}());
export { FileUploadComponent };
function FileUploadComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    FileUploadComponent.prototype.id;
    /** @type {?} */
    FileUploadComponent.prototype.multiple;
    /** @type {?} */
    FileUploadComponent.prototype.ordered;
    /** @type {?} */
    FileUploadComponent.prototype.preview;
    /** @type {?} */
    FileUploadComponent.prototype.upload;
    /** @type {?} */
    FileUploadComponent.prototype.onModelChange;
    /** @type {?} */
    FileUploadComponent.prototype.onTouch;
    /** @type {?} */
    FileUploadComponent.prototype.changes$;
    /** @type {?} */
    FileUploadComponent.prototype.value;
    /** @type {?} */
    FileUploadComponent.prototype.focused;
    /** @type {?} */
    FileUploadComponent.prototype.ordering;
    /** @type {?} */
    FileUploadComponent.prototype.ref;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNhaXUvbGlicmFyeS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbGUtdXBsb2FkL2ZpbGUtdXBsb2FkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDVixLQUFLLEVBRUwsaUJBQWlCLEVBQ2pCLGlCQUFpQixFQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV2QyxPQUFPLEVBQUUsVUFBVSxFQUFpQixNQUFNLHFCQUFxQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUV6RCxNQUFNLENBQUMscUJBQU0sb0JBQW9CLEdBQVE7SUFDdkMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSxtQkFBbUIsRUFBbkIsQ0FBbUIsQ0FBQztJQUNsRCxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7O0lBNENBLDZCQUFvQixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtrQkFaNUIsV0FBUyxJQUFJLEVBQUk7d0JBQ1gsS0FBSzt1QkFDTixJQUFJO3VCQUNKLElBQUk7c0JBQ0osSUFBSSxZQUFZLEVBQTZCO3dCQUd4QixJQUFJLGVBQWUsQ0FBYSxJQUFJLFVBQVUsRUFBRSxDQUFDO3dCQUd4RCxJQUFJLFFBQVEsQ0FBYSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUM7S0FFM0M7SUFFL0Msc0JBQUksMkNBQVU7Ozs7UUFBZDtZQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFVBQVUsRUFBRSxDQUFDO1NBQzdEOzs7T0FBQTtJQUVELHNCQUFJLDJDQUFVOzs7O1FBQWQ7WUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ2hDOzs7T0FBQTtJQUVELHNCQUFJLDZDQUFZOzs7O1FBQWhCO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQTtTQUNyQzs7O09BQUE7SUFFRCxzQkFBSSx3Q0FBTzs7OztRQUFYO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sQ0FBQyxJQUFJLEtBQUssRUFBRSxFQUFsQixDQUFrQixDQUFDLENBQUM7U0FDakU7Ozs7O1FBRUQsVUFBWSxLQUFtQjtZQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLElBQUksS0FBSyxFQUFFLEVBQWxCLENBQWtCLENBQUMsQ0FBQyxDQUFDO1lBQ3RFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzdCOzs7T0FMQTtJQU9ELHNCQUFJLCtDQUFjOzs7O1FBQWxCO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDckI7OztPQUFBOzs7O0lBRUQsc0NBQVE7OztJQUFSO1FBQUEsaUJBSUM7UUFIQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFBLE1BQU07WUFDNUIsS0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN2QixDQUFDLENBQUM7S0FDSjs7Ozs7SUFFRCxpQ0FBRzs7OztJQUFILFVBQUksQ0FBYTtRQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDZjtRQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDekM7Ozs7SUFFRCxrQ0FBSTs7O0lBQUo7UUFDRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDOUI7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDakM7U0FDRjtLQUNGOzs7OztJQUVELG9DQUFNOzs7O0lBQU4sVUFBTyxDQUFhO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDeEM7Ozs7O0lBRUQsc0NBQVE7Ozs7SUFBUixVQUFTLENBQWE7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUMxQzs7Ozs7SUFFRCxvQ0FBTTs7OztJQUFOLFVBQU8sQ0FBYztRQUNuQixxQkFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDeEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztLQUNyRDs7Ozs7SUFFRCxvQ0FBTTs7OztJQUFOLFVBQU8sQ0FBYTtRQUNsQixxQkFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBdkIsQ0FBdUIsQ0FBQyxDQUFDO1FBQ3RFLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNiO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQTFELENBQTBELENBQUMsQ0FBQztZQUN0RyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQzFCO0tBQ0Y7Ozs7O0lBRUQsOENBQWdCOzs7O0lBQWhCLFVBQWlCLEVBQVk7UUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7S0FDekI7Ozs7O0lBRUQsK0NBQWlCOzs7O0lBQWpCLFVBQWtCLEVBQVk7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7S0FDbkI7Ozs7O0lBRUQsd0NBQVU7Ozs7SUFBVixVQUFXLEtBQW1CO1FBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDdkI7Ozs7O0lBRUQsc0NBQVE7Ozs7SUFBUixVQUFTLEtBQW1CO1FBQzFCLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ25CLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsVUFBVSxLQUFLLE1BQU0sRUFBdkIsQ0FBdUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2FBQ2I7WUFDRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMzQjtTQUNGO0tBQ0Y7Ozs7O0lBRUQsMkNBQWE7Ozs7SUFBYixVQUFjLENBQU07UUFDbEIscUJBQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDM0IscUJBQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3QixFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLEdBQUcsQ0FBQyxDQUFDLHFCQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUM1QjtTQUNGO0tBQ0Y7Ozs7O0lBRUQsb0NBQU07Ozs7SUFBTixVQUFPLEtBQW1CO1FBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO0tBQ25COzs7OztJQUVELHFDQUFPOzs7O0lBQVAsVUFBUSxLQUFtQjtRQUN6QixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUNyQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDaEI7Ozs7O0lBRUQsc0NBQVE7Ozs7SUFBUixVQUFTLE1BQWtCO1FBQ3pCLHFCQUFNLENBQUMsR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDaEI7Ozs7O0lBRUQseUNBQVc7Ozs7SUFBWCxVQUFZLElBQVU7UUFDcEIscUJBQU0sTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7UUFDaEMscUJBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDL0IscUJBQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUU7WUFDL0IsWUFBWSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUM7WUFDbEMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDO1lBQzFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2xCLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2xCLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2xCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztTQUMvQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBTTtZQUM5QixxQkFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUMxQixxQkFBTSxVQUFVLEdBQUcsVUFBVSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwRCxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsR0FBRyxLQUFBLEVBQUUsVUFBVSxZQUFBLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDM0QsQ0FBQztRQUNGLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzVGOzs7OztJQUVELHVDQUFTOzs7O0lBQVQsVUFBVSxPQUFxQjtRQUEvQixpQkFJQztRQUhDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxNQUFNO1lBQ3BCLEtBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDdkIsQ0FBQyxDQUFDO0tBQ0o7O2dCQTdMRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLDBuQ0FzQlg7b0JBQ0MsTUFBTSxFQUFFLENBQUMsMDFDQUEwMUMsQ0FBQztvQkFDcDJDLFNBQVMsRUFBRSxDQUFDLG9CQUFvQixDQUFDO29CQUNqQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtpQkFDdEM7Ozs7Z0JBMUNDLGlCQUFpQjs7O3FCQTZDaEIsS0FBSzsyQkFDTCxLQUFLOzBCQUNMLEtBQUs7MEJBQ0wsS0FBSzt5QkFDTCxNQUFNOzs4QkF6RFQ7O1NBbURhLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIE91dHB1dCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgZm9yd2FyZFJlZixcclxuICBJbnB1dCxcclxuICBPbkluaXQsXHJcbiAgVmlld0VuY2Fwc3VsYXRpb24sXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWZcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IEZpbGVVcGxvYWQsIGdldFJlYWR5U3RhdGUgfSBmcm9tICcuL2ZpbGUtdXBsb2FkLm1vZGVsJztcclxuaW1wb3J0IHsgT3JkZXJpbmcgfSBmcm9tICcuLi8uLi9zaGFyZWQvb3JkZXJpbmcnO1xyXG5pbXBvcnQgeyBidWlsZCwgZ3VpZCwgZXF1YWxzIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3V0aWxzJztcclxuXHJcbmV4cG9ydCBjb25zdCBGSUxFX1VQTE9BRF9BQ0NFU1NPUjogYW55ID0ge1xyXG4gIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZpbGVVcGxvYWRDb21wb25lbnQpLFxyXG4gIG11bHRpOiB0cnVlXHJcbn07XHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnaXUtZmlsZS11cGxvYWQnLFxyXG4gIHRlbXBsYXRlOiBgPGRpdiBjbGFzcz1cImZpbGUtdXBsb2FkXCI+XHJcbiAgPGRpdiBjbGFzcz1cImJveFwiIGZ4TGF5b3V0PVwicm93XCIgZnhMYXlvdXRBbGlnbj1cImNlbnRlciBlbmRcIj5cclxuICAgIDxwIGlkPVwiZHJhZ2Ryb3AtbWVzc2FnZVwiICpuZ0lmPVwic2hvd011bHRpcGxlXCI+XHJcbiAgICAgIDxzdHJvbmc+Q2hvb3NlIGZpbGVzPC9zdHJvbmc+XHJcbiAgICAgIDxzcGFuIGNsYXNzPVwiZHJhZ25kcm9wXCI+IG9yIGRyYWcgdGhlbSBoZXJlPC9zcGFuPi5cclxuICAgIDwvcD5cclxuICAgIDxpbnB1dCBpZD1cImZpbGUtdXBsb2FkXCIgKm5nSWY9XCJzaG93TXVsdGlwbGVcIiB0eXBlPVwiZmlsZVwiIChjaGFuZ2UpPVwib25JbnB1dENoYW5nZSgkZXZlbnQpXCIgW2lkXT1cImlkXCIgbXVsdGlwbGUvPlxyXG4gICAgPHAgaWQ9XCJkcmFnZHJvcC1tZXNzYWdlXCIgKm5nSWY9XCIhbXVsdGlwbGVcIj5cclxuICAgICAgPHN0cm9uZz5DaG9vc2UgYSBmaWxlPC9zdHJvbmc+XHJcbiAgICAgIDxzcGFuIGNsYXNzPVwiZHJhZ25kcm9wXCI+IG9yIGRyYWcgaXQgaGVyZTwvc3Bhbj4uXHJcbiAgICA8L3A+XHJcbiAgICA8aW5wdXQgaWQ9XCJmaWxlLXVwbG9hZFwiICpuZ0lmPVwiIW11bHRpcGxlXCIgdHlwZT1cImZpbGVcIiAoY2hhbmdlKT1cIm9uSW5wdXRDaGFuZ2UoJGV2ZW50KVwiIFtpZF09XCJpZFwiIC8+XHJcbiAgICA8bGFiZWwgW2Zvcl09XCJpZFwiIGNsYXNzPVwiY3VzdG9tLWZpbGUtdXBsb2FkXCI+XHJcbiAgICAgIDxmaWd1cmU+XHJcbiAgICAgICAgPG1hdC1pY29uPmNsb3VkX3VwbG9hZDwvbWF0LWljb24+XHJcbiAgICAgIDwvZmlndXJlPlxyXG4gICAgPC9sYWJlbD5cclxuICA8L2Rpdj5cclxuICA8aXUtdXBsb2FkcyAqbmdJZj1cIm11bHRpcGxlXCIgW3VwbG9hZHNdPVwidXBsb2Fkc1wiIFtvcmRlcmVkXT1cIm9yZGVyZWRcIiAobW92ZVVwKT1cIm1vdmVVcCgkZXZlbnQpXCIgKG1vdmVEb3duKT1cIm1vdmVEb3duKCRldmVudClcIlxyXG4gICAgKHJlbW92ZSk9XCJyZW1vdmUoJGV2ZW50KVwiPjwvaXUtdXBsb2Fkcz5cclxuICA8aXUtdXBsb2FkICpuZ0lmPVwicHJldmlldyAmJiAhbXVsdGlwbGUgJiYgaGFzVXBsb2Fkc1wiIFt1cGxvYWRdPVwiYWN0aXZlRmlsZVwiIFtoZWlnaHRdPVwiMjAwXCIgKHJlbW92ZSk9XCJyZW1vdmUoKVwiPjwvaXUtdXBsb2FkPlxyXG48L2Rpdj5cclxuYCxcclxuICBzdHlsZXM6IFtgLmZpbGUtdXBsb2Fke21hcmdpbjoxMHB4O3BhZGRpbmc6MTBweH0uZmlsZS11cGxvYWQgaW5wdXRbdHlwZT1maWxlXXt3aWR0aDouMXB4O2hlaWdodDouMXB4O29wYWNpdHk6MDtvdmVyZmxvdzpoaWRkZW47cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDotMX0uZmlsZS11cGxvYWQgLmJveHtwYWRkaW5nOjEwMHB4IDIwcHg7bWFyZ2luOjEwcHg7ZGlzcGxheTpmbGV4O291dGxpbmU6LXdlYmtpdC1mb2N1cy1yaW5nLWNvbG9yIGF1dG8gNXB4O291dGxpbmUtb2Zmc2V0Oi0xMHB4O3Bvc2l0aW9uOnJlbGF0aXZlfS5maWxlLXVwbG9hZCAuYm94ICNkcmFnZHJvcC1tZXNzYWdle3Bvc2l0aW9uOmFic29sdXRlO3RvcDo2MHB4O21heC13aWR0aDo4MCU7dGV4dC1vdmVyZmxvdzplbGxpcHNpczt3aGl0ZS1zcGFjZTpub3dyYXA7Y3Vyc29yOnBvaW50ZXI7ZGlzcGxheTppbmxpbmUtYmxvY2s7b3ZlcmZsb3c6aGlkZGVuO2ZvbnQtc2l6ZToyNHB4fS5maWxlLXVwbG9hZCAuYm94ICNkcmFnZHJvcC1tZXNzYWdlIHNwYW57ZGlzcGxheTppbmxpbmV9LmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWR7Ym94LXNoYWRvdzowIDJweCAxcHggLTFweCByZ2JhKDAsMCwwLC4yKSwwIDFweCAxcHggMCByZ2JhKDAsMCwwLC4xNCksMCAxcHggM3B4IDAgcmdiYSgwLDAsMCwuMTIpO21heC13aWR0aDo4MCU7Zm9udC1zaXplOjIwcHg7Zm9udC13ZWlnaHQ6NzAwO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7d2hpdGUtc3BhY2U6bm93cmFwO2N1cnNvcjpwb2ludGVyO2Rpc3BsYXk6aW5saW5lLWJsb2NrO292ZXJmbG93OmhpZGRlbjtwYWRkaW5nOjEwcHggMjBweDttYXJnaW4tdG9wOjUwcHh9LmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWQgZmlndXJle3dpZHRoOjUwcHg7aGVpZ2h0OjcwcHg7ZGlzcGxheTpmbGV4O3Bvc2l0aW9uOnJlbGF0aXZlO3BhZGRpbmc6MzBweDttYXJnaW46MCBhdXRvIDEwcHh9LmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWQgZmlndXJlIG1hdC1pY29ue2ZvbnQtc2l6ZTo1MHB4O2hlaWdodDo1MHB4O3dpZHRoOjUwcHh9LmZpbGUtdXBsb2FkIC5jdXN0b20tZmlsZS11cGxvYWQgZmlndXJlOjphZnRlciwuZmlsZS11cGxvYWQgLmN1c3RvbS1maWxlLXVwbG9hZCBmaWd1cmU6OmJlZm9yZXt3aWR0aDowO2hlaWdodDowO2NvbnRlbnQ6Jyc7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7cmlnaHQ6MH0uZmlsZS11cGxvYWQgLmN1c3RvbS1maWxlLXVwbG9hZCBmaWd1cmU6OmJlZm9yZXtib3JkZXItbGVmdDoyMHB4IHNvbGlkIHRyYW5zcGFyZW50fS5maWxlLXVwbG9hZCAuY3VzdG9tLWZpbGUtdXBsb2FkIGZpZ3VyZTo6YWZ0ZXJ7Ym9yZGVyLXJpZ2h0OjIwcHggc29saWQgdHJhbnNwYXJlbnR9YF0sXHJcbiAgcHJvdmlkZXJzOiBbRklMRV9VUExPQURfQUNDRVNTT1JdLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbGVVcGxvYWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcclxuXHJcbiAgQElucHV0KCkgaWQgPSBgZmlsZXMtJHtndWlkKCl9YDtcclxuICBASW5wdXQoKSBtdWx0aXBsZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIG9yZGVyZWQgPSB0cnVlO1xyXG4gIEBJbnB1dCgpIHByZXZpZXcgPSB0cnVlO1xyXG4gIEBPdXRwdXQoKSB1cGxvYWQgPSBuZXcgRXZlbnRFbWl0dGVyPEZpbGVVcGxvYWQgfCBGaWxlVXBsb2FkW10+KCk7XHJcbiAgcHJpdmF0ZSBvbk1vZGVsQ2hhbmdlOiBGdW5jdGlvbjtcclxuICBwcml2YXRlIG9uVG91Y2g6IEZ1bmN0aW9uO1xyXG4gIGNoYW5nZXMkOiBCZWhhdmlvclN1YmplY3Q8RmlsZVVwbG9hZD4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEZpbGVVcGxvYWQ+KG5ldyBGaWxlVXBsb2FkKCkpO1xyXG4gIHZhbHVlOiBGaWxlVXBsb2FkW107XHJcbiAgZm9jdXNlZDogRmlsZVVwbG9hZFtdO1xyXG4gIG9yZGVyaW5nOiBPcmRlcmluZzxGaWxlVXBsb2FkPiA9IG5ldyBPcmRlcmluZzxGaWxlVXBsb2FkPihbXSwgRmlsZVVwbG9hZCwgJ29yZGVyJywgJ25hbWUnKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWY6IENoYW5nZURldGVjdG9yUmVmKSB7IH1cclxuXHJcbiAgZ2V0IGFjdGl2ZUZpbGUoKTogRmlsZVVwbG9hZCB7XHJcbiAgICByZXR1cm4gdGhpcy5oYXNVcGxvYWRzID8gdGhpcy51cGxvYWRzWzBdIDogbmV3IEZpbGVVcGxvYWQoKTtcclxuICB9XHJcblxyXG4gIGdldCBoYXNVcGxvYWRzKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMudXBsb2Fkcy5sZW5ndGggPiAwO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3dNdWx0aXBsZSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnByZXZpZXcgJiYgdGhpcy5tdWx0aXBsZVxyXG4gIH1cclxuXHJcbiAgZ2V0IHVwbG9hZHMoKTogRmlsZVVwbG9hZFtdIHtcclxuICAgIHJldHVybiB0aGlzLm9yZGVyaW5nLml0ZW1zLmZpbHRlcih1cGxvYWQgPT4gdXBsb2FkLm5hbWUgIT09ICcnKTtcclxuICB9XHJcblxyXG4gIHNldCB1cGxvYWRzKHZhbHVlOiBGaWxlVXBsb2FkW10pIHtcclxuICAgIHRoaXMub3JkZXJpbmcudXBkYXRlSXRlbXModmFsdWUuZmlsdGVyKHVwbG9hZCA9PiB1cGxvYWQubmFtZSAhPT0gJycpKTtcclxuICAgIHRoaXMub25DaGFuZ2UodGhpcy51cGxvYWRzKTtcclxuICB9XHJcblxyXG4gIGdldCBvcmRlcmVkVXBsb2FkcygpOiBGaWxlVXBsb2FkW10ge1xyXG4gICAgcmV0dXJuIHRoaXMudXBsb2FkcztcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jaGFuZ2VzJC5zdWJzY3JpYmUodXBsb2FkID0+IHtcclxuICAgICAgdGhpcy5vblVwbG9hZCh1cGxvYWQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGQoZjogRmlsZVVwbG9hZCkge1xyXG4gICAgaWYgKCF0aGlzLm11bHRpcGxlICYmIHRoaXMuaGFzVXBsb2Fkcykge1xyXG4gICAgICB0aGlzLnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy51cGxvYWRzID0gdGhpcy5vcmRlcmluZy5hZGRJdGVtKGYpO1xyXG4gIH1cclxuXHJcbiAgZW1pdCgpIHtcclxuICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA+IDApIHtcclxuICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcclxuICAgICAgICB0aGlzLnVwbG9hZC5lbWl0KHRoaXMudmFsdWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudXBsb2FkLmVtaXQodGhpcy52YWx1ZVswXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVVcChmOiBGaWxlVXBsb2FkKSB7XHJcbiAgICB0aGlzLnVwbG9hZHMgPSB0aGlzLm9yZGVyaW5nLm1vdmVVcChmKTtcclxuICB9XHJcblxyXG4gIG1vdmVEb3duKGY6IEZpbGVVcGxvYWQpIHtcclxuICAgIHRoaXMudXBsb2FkcyA9IHRoaXMub3JkZXJpbmcubW92ZURvd24oZik7XHJcbiAgfVxyXG5cclxuICByZW1vdmUoZj86IEZpbGVVcGxvYWQpIHtcclxuICAgIGNvbnN0IHJlbW92ZUZpbGUgPSBmIHx8IHRoaXMuYWN0aXZlRmlsZTtcclxuICAgIHRoaXMudXBsb2FkcyA9IHRoaXMub3JkZXJpbmcucmVtb3ZlSXRlbShyZW1vdmVGaWxlKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZShmOiBGaWxlVXBsb2FkKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMudXBsb2Fkcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtWyduYW1lJ10gPT09IGYubmFtZSk7XHJcbiAgICBpZiAoaW5kZXggPT09IC0xKSB7XHJcbiAgICAgIHRoaXMuYWRkKGYpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy51cGxvYWRzID0gdGhpcy51cGxvYWRzLm1hcCgoeCwgaSkgPT4gaSA9PT0gaW5kZXggPyBidWlsZChGaWxlVXBsb2FkLCBmLCB7IG9yZGVyOiB4Lm9yZGVyIH0pIDogeCk7XHJcbiAgICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IEZ1bmN0aW9uKSB7XHJcbiAgICB0aGlzLm9uTW9kZWxDaGFuZ2UgPSBmbjtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBGdW5jdGlvbikge1xyXG4gICAgdGhpcy5vblRvdWNoID0gZm47XHJcbiAgfVxyXG5cclxuICB3cml0ZVZhbHVlKHZhbHVlOiBGaWxlVXBsb2FkW10pIHtcclxuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIHRoaXMudXBsb2FkQWxsKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIG9uQ2hhbmdlKHZhbHVlOiBGaWxlVXBsb2FkW10pIHtcclxuICAgIGlmICghZXF1YWxzKHRoaXMudmFsdWUsIHZhbHVlKSkge1xyXG4gICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgIGlmICh2YWx1ZS5ldmVyeSh4ID0+IHgucmVhZHlTdGF0ZSA9PT0gJ0RPTkUnKSkge1xyXG4gICAgICAgIHRoaXMuZW1pdCgpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLm9uTW9kZWxDaGFuZ2UpIHtcclxuICAgICAgICB0aGlzLm9uTW9kZWxDaGFuZ2UodmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbklucHV0Q2hhbmdlKGU6IGFueSkge1xyXG4gICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQ7XHJcbiAgICBjb25zdCBmaWxlcyA9IGlucHV0WydmaWxlcyddO1xyXG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHRoaXMuc2V0dXBSZWFkZXIoZmlsZXNbaV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkJsdXIodmFsdWU6IEZpbGVVcGxvYWRbXSkge1xyXG4gICAgdGhpcy5mb2N1c2VkID0gW107XHJcbiAgfVxyXG5cclxuICBvbkZvY3VzKHZhbHVlOiBGaWxlVXBsb2FkW10pIHtcclxuICAgIHRoaXMuZm9jdXNlZCA9IHZhbHVlO1xyXG4gICAgdGhpcy5vblRvdWNoKCk7XHJcbiAgfVxyXG5cclxuICBvblVwbG9hZCh1cGxvYWQ6IEZpbGVVcGxvYWQpIHtcclxuICAgIGNvbnN0IGYgPSBidWlsZChGaWxlVXBsb2FkLCB1cGxvYWQpO1xyXG4gICAgdGhpcy51cGRhdGUoZik7XHJcbiAgfVxyXG5cclxuICBzZXR1cFJlYWRlcihmaWxlOiBGaWxlKSB7XHJcbiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgY29uc3QgY2hhbmdlcyQgPSB0aGlzLmNoYW5nZXMkO1xyXG4gICAgY29uc3QgdXBsb2FkID0gYnVpbGQoRmlsZVVwbG9hZCwge1xyXG4gICAgICBsYXN0TW9kaWZpZWQ6IGZpbGVbJ2xhc3RNb2RpZmllZCddLFxyXG4gICAgICBsYXN0TW9kaWZpZWREYXRlOiBmaWxlWydsYXN0TW9kaWZpZWREYXRlJ10sXHJcbiAgICAgIG5hbWU6IGZpbGVbJ25hbWUnXSxcclxuICAgICAgc2l6ZTogZmlsZVsnc2l6ZSddLFxyXG4gICAgICB0eXBlOiBmaWxlWyd0eXBlJ10sXHJcbiAgICAgIHdlYmtpdFJlbGF0aXZlUGF0aDogZmlsZVsnd2Via2l0UmVsYXRpdmVQYXRoJ11cclxuICAgIH0pO1xyXG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlOiBhbnkpIHtcclxuICAgICAgY29uc3Qgc3JjID0gcmVhZGVyLnJlc3VsdDtcclxuICAgICAgY29uc3QgcmVhZHlTdGF0ZSA9IEZpbGVVcGxvYWQuR2V0UmVhZHlTdGF0ZShyZWFkZXIpO1xyXG4gICAgICBjaGFuZ2VzJC5uZXh0KE9iamVjdC5hc3NpZ24odXBsb2FkLCB7IHNyYywgcmVhZHlTdGF0ZSB9KSk7XHJcbiAgICB9O1xyXG4gICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICB0aGlzLm9uVXBsb2FkKGJ1aWxkKEZpbGVVcGxvYWQsIHVwbG9hZCwgeyByZWFkeVN0YXRlOiBGaWxlVXBsb2FkLkdldFJlYWR5U3RhdGUocmVhZGVyKSB9KSk7XHJcbiAgfVxyXG5cclxuICB1cGxvYWRBbGwodXBsb2FkczogRmlsZVVwbG9hZFtdKSB7XHJcbiAgICB1cGxvYWRzLmZvckVhY2godXBsb2FkID0+IHtcclxuICAgICAgdGhpcy5vblVwbG9hZCh1cGxvYWQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=