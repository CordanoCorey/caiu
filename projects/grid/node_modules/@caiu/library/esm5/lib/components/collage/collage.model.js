/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Tile } from '../tile/tile.model';
import { Dimensions } from '../../shared/models';
import { integerArray, positiveIntegerArray } from '../../shared/utils';
var Collage = /** @class */ (function () {
    function Collage() {
        this.canvasHeight = 0;
        this.canvasWidth = 0;
        this.maxColumns = 4;
        this.maxRows = 4;
        this.totalColumns = 0;
        this.totalRows = 0;
        this._images = [];
        this._tiles = [];
    }
    /**
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxColumns
     * @param {?} cells
     * @return {?}
     */
    Collage.AvailableColumns = /**
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxColumns
     * @param {?} cells
     * @return {?}
     */
    function (startRow, startColumn, maxColumns, cells) {
        var /** @type {?} */ totalColumns = cells[0].length;
        return Math.max.apply(Math, tslib_1.__spread(positiveIntegerArray(maxColumns)
            .map(function (k) { return k <= maxColumns && startColumn + k <= totalColumns && cells[startRow] && cells[startRow][startColumn + k] ? k : 1; })));
    };
    /**
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxRows
     * @param {?} cells
     * @return {?}
     */
    Collage.AvailableRows = /**
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxRows
     * @param {?} cells
     * @return {?}
     */
    function (startRow, startColumn, maxRows, cells) {
        var /** @type {?} */ totalRows = cells[0].length;
        return Math.max.apply(Math, tslib_1.__spread(positiveIntegerArray(maxRows)
            .map(function (k) { return k <= maxRows && startRow + k <= totalRows && cells[startRow + k] && cells[startRow + k][startColumn] ? k : 1; })));
    };
    /**
     * @param {?} dimensions
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxRows
     * @param {?} maxColumns
     * @param {?} cells
     * @return {?}
     */
    Collage.AvailableDimensions = /**
     * @param {?} dimensions
     * @param {?} startRow
     * @param {?} startColumn
     * @param {?} maxRows
     * @param {?} maxColumns
     * @param {?} cells
     * @return {?}
     */
    function (dimensions, startRow, startColumn, maxRows, maxColumns, cells) {
        var /** @type {?} */ availableRows = Collage.AvailableRows(startRow, startColumn, maxRows, cells);
        var /** @type {?} */ availableColumns = Collage.AvailableColumns(startRow, startColumn, maxColumns, cells);
        return dimensions.filter(function (x) { return x.rows <= availableRows && x.columns <= availableColumns; });
    };
    /**
     * @param {?} images
     * @param {?} canvasHeight
     * @param {?} canvasWidth
     * @param {?=} totalRows
     * @param {?=} totalColumns
     * @param {?=} maxRows
     * @param {?=} maxColumns
     * @return {?}
     */
    Collage.Build = /**
     * @param {?} images
     * @param {?} canvasHeight
     * @param {?} canvasWidth
     * @param {?=} totalRows
     * @param {?=} totalColumns
     * @param {?=} maxRows
     * @param {?=} maxColumns
     * @return {?}
     */
    function (images, canvasHeight, canvasWidth, totalRows, totalColumns, maxRows, maxColumns) {
        if (totalRows === void 0) { totalRows = 0; }
        if (totalColumns === void 0) { totalColumns = 0; }
        if (maxRows === void 0) { maxRows = 0; }
        if (maxColumns === void 0) { maxColumns = 0; }
        var /** @type {?} */ collage = Object.assign(new Collage(), {
            canvasHeight: canvasHeight,
            canvasWidth: canvasWidth,
            totalRows: totalRows,
            totalColumns: totalColumns,
            maxRows: maxRows,
            maxColumns: maxColumns
        });
        collage.images = images;
        return collage;
    };
    /**
     * @param {?} rows
     * @param {?} cols
     * @return {?}
     */
    Collage.BuildEmptyCells = /**
     * @param {?} rows
     * @param {?} cols
     * @return {?}
     */
    function (rows, cols) {
        return integerArray(rows).map(function (x) { return integerArray(cols).map(function (y) { return true; }); });
    };
    /**
     * @param {?} collage
     * @return {?}
     */
    Collage.BuildTiles = /**
     * @param {?} collage
     * @return {?}
     */
    function (collage) {
        return collage.images.map(function (image, index) {
            var /** @type {?} */ dimensions = Collage.FindDimensions(image.height, image.width, collage.tileDimensions, collage.cellHeight, collage.cellWidth);
            return Object.assign(new Tile(), {
                image: image,
                dimensions: dimensions,
                id: index + 1,
                cellHeight: collage.cellHeight,
                cellWidth: collage.cellWidth
            });
        });
    };
    /**
     * @param {?} id
     * @param {?} tileIds
     * @return {?}
     */
    Collage.ChooseTileId = /**
     * @param {?} id
     * @param {?} tileIds
     * @return {?}
     */
    function (id, tileIds) {
        return tslib_1.__spread(tileIds.filter(function (x) { return x !== id; }), [id]);
    };
    /**
     * @param {?} index
     * @param {?} totalRows
     * @param {?} totalColumns
     * @return {?}
     */
    Collage.FindCoordinates = /**
     * @param {?} index
     * @param {?} totalRows
     * @param {?} totalColumns
     * @return {?}
     */
    function (index, totalRows, totalColumns) {
        var /** @type {?} */ remainder = (index + totalColumns) % totalColumns;
        return {
            row: (index - remainder) / totalColumns,
            column: remainder
        };
    };
    /**
     * @param {?} index
     * @param {?} totalRows
     * @param {?} totalColumns
     * @param {?} startRow
     * @param {?} startColumn
     * @return {?}
     */
    Collage.FindCoordinatesNested = /**
     * @param {?} index
     * @param {?} totalRows
     * @param {?} totalColumns
     * @param {?} startRow
     * @param {?} startColumn
     * @return {?}
     */
    function (index, totalRows, totalColumns, startRow, startColumn) {
        var /** @type {?} */ coordinates = Collage.FindCoordinates(index, totalRows, totalColumns);
        coordinates.column += startColumn;
        coordinates.row += startRow;
        return coordinates;
    };
    /**
     * @param {?} height
     * @param {?} width
     * @param {?} dimensions
     * @param {?} cellHeight
     * @param {?} cellWidth
     * @return {?}
     */
    Collage.FindDimensions = /**
     * @param {?} height
     * @param {?} width
     * @param {?} dimensions
     * @param {?} cellHeight
     * @param {?} cellWidth
     * @return {?}
     */
    function (height, width, dimensions, cellHeight, cellWidth) {
        var /** @type {?} */ filtered = dimensions.filter(function (x) { return x.rows * cellHeight <= height && x.columns * cellWidth <= width; });
        var /** @type {?} */ ordered = filtered.sort(function (a, b) { return Math.abs(height / width - a.ratio) - Math.abs(height / width - b.ratio); });
        var /** @type {?} */ closestMatch = ordered[0];
        var /** @type {?} */ rows = closestMatch && closestMatch.rows ? closestMatch.rows : [];
        var /** @type {?} */ columns = closestMatch && closestMatch.columns ? closestMatch.columns : [];
        return Object.assign(new Dimensions(), {
            rows: rows,
            columns: columns,
            height: height,
            width: width
        });
    };
    /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    Collage.FindNextTileId = /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    function (tiles, tileIds, dimensions) {
        var /** @type {?} */ nextMatch = Collage.FindNextMatchId(tiles, tileIds, dimensions);
        return nextMatch || Collage.FindBestMatchId(tiles, tileIds, dimensions);
    };
    /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    Collage.FindBestMatchId = /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    function (tiles, tileIds, dimensions) {
        var /** @type {?} */ diff = 999;
        return tileIds.reduce(function (acc, id) {
            var /** @type {?} */ tile = tiles.find(function (x) { return x.id === id; });
            diff = Math.abs(tile.ratio - dimensions.ratio);
            return acc === 0 || diff < acc ? id : acc;
        }, 0);
    };
    /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    Collage.FindNextMatchId = /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    function (tiles, tileIds, dimensions) {
        return tileIds.reduce(function (acc, id) {
            if (acc !== 0) {
                return acc;
            }
            var /** @type {?} */ tile = tiles.find(function (x) { return x.id === id; });
            return tile && tile.rows === dimensions.rows && tile.columns === dimensions.columns ? tile.id : 0;
        }, 0);
    };
    /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    Collage.FindBestMatch = /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    function (tiles, tileIds, dimensions) {
        var /** @type {?} */ id = Collage.FindBestMatchId(tiles, tileIds, dimensions);
        return tiles.find(function (x) { return x.id === id; });
    };
    /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    Collage.FindNextTile = /**
     * @param {?} tiles
     * @param {?} tileIds
     * @param {?} dimensions
     * @return {?}
     */
    function (tiles, tileIds, dimensions) {
        return tileIds.reduce(function (acc, id) {
            if (acc === null || acc.id === 0) {
                var /** @type {?} */ tile_1 = tiles.find(function (x) { return x.id === id; });
                var /** @type {?} */ dim = dimensions.find(function (x) { return tile_1.rows === x.rows && tile_1.columns === x.columns; });
                return dim ? Object.assign(new Tile(), tile_1, {
                    dimensions: Object.assign(new Dimensions(), tile_1.dimensions, {
                        rows: dim.rows,
                        columns: dim.columns
                    })
                }) : null;
            }
            return acc;
        }, new Tile()) || Collage.FindBestMatch(tiles, tileIds, dimensions[0]);
    };
    /**
     * @param {?} cellHeight
     * @param {?} cellWidth
     * @param {?} maxRows
     * @param {?} maxColumns
     * @return {?}
     */
    Collage.GetTileDimensions = /**
     * @param {?} cellHeight
     * @param {?} cellWidth
     * @param {?} maxRows
     * @param {?} maxColumns
     * @return {?}
     */
    function (cellHeight, cellWidth, maxRows, maxColumns) {
        return positiveIntegerArray(maxRows).reduce(function (acc, x) {
            var /** @type {?} */ dimensions = positiveIntegerArray(maxColumns)
                .map(function (y) { return Object.assign(new Dimensions(), {
                rows: x,
                columns: y,
                height: x * cellHeight,
                width: y * cellWidth
            }); });
            return tslib_1.__spread(acc, dimensions);
        }, []);
    };
    /**
     * @param {?} cells
     * @param {?} startIndex
     * @param {?} dimensions
     * @param {?} totalRows
     * @param {?} totalColumns
     * @return {?}
     */
    Collage.MarkCellsAsFilled = /**
     * @param {?} cells
     * @param {?} startIndex
     * @param {?} dimensions
     * @param {?} totalRows
     * @param {?} totalColumns
     * @return {?}
     */
    function (cells, startIndex, dimensions, totalRows, totalColumns) {
        var /** @type {?} */ start = Collage.FindCoordinates(startIndex, totalRows, totalColumns);
        return integerArray(dimensions.rows * dimensions.columns).reduce(function (acc, i) {
            var /** @type {?} */ coordinates = Collage.FindCoordinatesNested(i, dimensions.rows, dimensions.columns, start.row, start.column);
            cells[coordinates.row][coordinates.column] = false;
            return cells;
        }, cells);
    };
    /**
     * @param {?} tiles
     * @param {?} collage
     * @return {?}
     */
    Collage.PositionTiles = /**
     * @param {?} tiles
     * @param {?} collage
     * @return {?}
     */
    function (tiles, collage) {
        var /** @type {?} */ cells = Collage.BuildEmptyCells(collage.totalRows, collage.totalColumns);
        var /** @type {?} */ tileIds = tiles.map(function (x) { return x.id; });
        return integerArray(collage.totalCells).reduce(function (acc, i) {
            var /** @type {?} */ coordinates = Collage.FindCoordinates(i, collage.totalRows, collage.totalColumns);
            if (!cells[coordinates.row][coordinates.column]) {
                return acc;
            }
            var /** @type {?} */ availableDimensions = Collage.AvailableDimensions(collage.tileDimensions, coordinates.row, coordinates.column, collage.maxRows, collage.maxColumns, cells);
            var /** @type {?} */ tile = Collage.FindNextTile(tiles, tileIds, availableDimensions);
            tile.coordinates = coordinates;
            cells = Collage.MarkCellsAsFilled(cells, i, tile.dimensions, collage.totalRows, collage.totalColumns);
            tileIds = Collage.ChooseTileId(tile.id, tileIds);
            return tslib_1.__spread(acc, [tile]);
        }, []);
    };
    Object.defineProperty(Collage.prototype, "cellHeight", {
        get: /**
         * @return {?}
         */
        function () {
            return this.canvasHeight / this.totalRows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "cellWidth", {
        get: /**
         * @return {?}
         */
        function () {
            return this.canvasWidth / this.totalColumns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "emptyCells", {
        get: /**
         * @return {?}
         */
        function () {
            return Collage.BuildEmptyCells(this.totalRows, this.totalColumns);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "images", {
        get: /**
         * @return {?}
         */
        function () {
            return this._images;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._images = value;
            this.tiles = Collage.BuildTiles(this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "tileDimensions", {
        get: /**
         * @return {?}
         */
        function () {
            return Collage.GetTileDimensions(this.cellHeight, this.cellWidth, this.maxRows, this.maxColumns);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "tiles", {
        get: /**
         * @return {?}
         */
        function () {
            return this._tiles;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._tiles = Collage.PositionTiles(value, this);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Collage.prototype, "totalCells", {
        get: /**
         * @return {?}
         */
        function () {
            return this.totalRows * this.totalColumns;
        },
        enumerable: true,
        configurable: true
    });
    return Collage;
}());
export { Collage };
function Collage_tsickle_Closure_declarations() {
    /** @type {?} */
    Collage.prototype.canvasHeight;
    /** @type {?} */
    Collage.prototype.canvasWidth;
    /** @type {?} */
    Collage.prototype.maxColumns;
    /** @type {?} */
    Collage.prototype.maxRows;
    /** @type {?} */
    Collage.prototype.totalColumns;
    /** @type {?} */
    Collage.prototype.totalRows;
    /** @type {?} */
    Collage.prototype._images;
    /** @type {?} */
    Collage.prototype._tiles;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFnZS5tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjYWl1L2xpYnJhcnkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9jb2xsYWdlL2NvbGxhZ2UubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDMUMsT0FBTyxFQUFTLFVBQVUsRUFBZSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxZQUFZLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUV4RSxJQUFBOzs0QkFDbUIsQ0FBQzsyQkFDRixDQUFDOzBCQUNGLENBQUM7dUJBQ0osQ0FBQzs0QkFDSSxDQUFDO3lCQUNKLENBQUM7dUJBQ00sRUFBRTtzQkFDSixFQUFFOzs7Ozs7Ozs7SUFFWix3QkFBZ0I7Ozs7Ozs7SUFBdkIsVUFBd0IsUUFBZ0IsRUFBRSxXQUFtQixFQUFFLFVBQWtCLEVBQUUsS0FBa0I7UUFDakcscUJBQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQVIsSUFBSSxtQkFBUSxvQkFBb0IsQ0FBQyxVQUFVLENBQUM7YUFDOUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxJQUFJLFVBQVUsSUFBSSxXQUFXLEdBQUcsQ0FBQyxJQUFJLFlBQVksSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQWpILENBQWlILENBQUMsR0FBRTtLQUNySTs7Ozs7Ozs7SUFFTSxxQkFBYTs7Ozs7OztJQUFwQixVQUFxQixRQUFnQixFQUFFLFdBQW1CLEVBQUUsT0FBZSxFQUFFLEtBQWtCO1FBQzNGLHFCQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFSLElBQUksbUJBQVEsb0JBQW9CLENBQUMsT0FBTyxDQUFDO2FBQzNDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsSUFBSSxPQUFPLElBQUksUUFBUSxHQUFHLENBQUMsSUFBSSxTQUFTLElBQUksS0FBSyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBNUcsQ0FBNEcsQ0FBQyxHQUFFO0tBQ2hJOzs7Ozs7Ozs7O0lBRU0sMkJBQW1COzs7Ozs7Ozs7SUFBMUIsVUFDSSxVQUF3QixFQUN4QixRQUFnQixFQUNoQixXQUFtQixFQUNuQixPQUFlLEVBQ2YsVUFBa0IsRUFDbEIsS0FBa0I7UUFDbEIscUJBQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkYscUJBQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzVGLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksSUFBSSxhQUFhLElBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxnQkFBZ0IsRUFBeEQsQ0FBd0QsQ0FBQyxDQUFDO0tBQzNGOzs7Ozs7Ozs7OztJQUVNLGFBQUs7Ozs7Ozs7Ozs7SUFBWixVQUFhLE1BQWUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFNBQWEsRUFBRSxZQUFnQixFQUFFLE9BQVcsRUFBRSxVQUFjO1FBQTVELDBCQUFBLEVBQUEsYUFBYTtRQUFFLDZCQUFBLEVBQUEsZ0JBQWdCO1FBQUUsd0JBQUEsRUFBQSxXQUFXO1FBQUUsMkJBQUEsRUFBQSxjQUFjO1FBQ2pILHFCQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksT0FBTyxFQUFFLEVBQUU7WUFDekMsWUFBWSxjQUFBO1lBQ1osV0FBVyxhQUFBO1lBQ1gsU0FBUyxXQUFBO1lBQ1QsWUFBWSxjQUFBO1lBQ1osT0FBTyxTQUFBO1lBQ1AsVUFBVSxZQUFBO1NBQ2IsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDeEIsTUFBTSxDQUFDLE9BQU8sQ0FBQztLQUNsQjs7Ozs7O0lBRU0sdUJBQWU7Ozs7O0lBQXRCLFVBQXVCLElBQVksRUFBRSxJQUFZO1FBQzdDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLElBQUksRUFBSixDQUFJLENBQUMsRUFBakMsQ0FBaUMsQ0FBQyxDQUFDO0tBQ3pFOzs7OztJQUVNLGtCQUFVOzs7O0lBQWpCLFVBQWtCLE9BQWdCO1FBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssRUFBRSxLQUFLO1lBQ25DLHFCQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3BJLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUU7Z0JBQzdCLEtBQUssT0FBQTtnQkFDTCxVQUFVLFlBQUE7Z0JBQ1YsRUFBRSxFQUFFLEtBQUssR0FBRyxDQUFDO2dCQUNiLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtnQkFDOUIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO2FBQy9CLENBQUMsQ0FBQztTQUNOLENBQ0EsQ0FBQztLQUNMOzs7Ozs7SUFFTSxvQkFBWTs7Ozs7SUFBbkIsVUFBb0IsRUFBVSxFQUFFLE9BQWlCO1FBQzdDLE1BQU0sa0JBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsS0FBSyxFQUFFLEVBQVIsQ0FBUSxDQUFDLEdBQUUsRUFBRSxHQUFFO0tBQ2pEOzs7Ozs7O0lBRU0sdUJBQWU7Ozs7OztJQUF0QixVQUF1QixLQUFhLEVBQUUsU0FBaUIsRUFBRSxZQUFvQjtRQUN6RSxxQkFBTSxTQUFTLEdBQUcsQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLEdBQUcsWUFBWSxDQUFDO1FBQ3hELE1BQU0sQ0FBQztZQUNILEdBQUcsRUFBRSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsR0FBRyxZQUFZO1lBQ3ZDLE1BQU0sRUFBRSxTQUFTO1NBQ3BCLENBQUM7S0FDTDs7Ozs7Ozs7O0lBRU0sNkJBQXFCOzs7Ozs7OztJQUE1QixVQUNJLEtBQWEsRUFBRSxTQUFpQixFQUFFLFlBQW9CLEVBQUUsUUFBZ0IsRUFBRSxXQUFtQjtRQUM3RixxQkFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQzVFLFdBQVcsQ0FBQyxNQUFNLElBQUksV0FBVyxDQUFDO1FBQ2xDLFdBQVcsQ0FBQyxHQUFHLElBQUksUUFBUSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxXQUFXLENBQUM7S0FDdEI7Ozs7Ozs7OztJQUVNLHNCQUFjOzs7Ozs7OztJQUFyQixVQUFzQixNQUFjLEVBQUUsS0FBYSxFQUFFLFVBQXdCLEVBQUUsVUFBa0IsRUFBRSxTQUFpQjtRQUNoSCxxQkFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEdBQUcsVUFBVSxJQUFJLE1BQU0sSUFBSSxDQUFDLENBQUMsT0FBTyxHQUFHLFNBQVMsSUFBSSxLQUFLLEVBQS9ELENBQStELENBQUMsQ0FBQztRQUN6RyxxQkFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQXZFLENBQXVFLENBQUMsQ0FBQztRQUNqSCxxQkFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLHFCQUFNLElBQUksR0FBRyxZQUFZLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ3hFLHFCQUFNLE9BQU8sR0FBRyxZQUFZLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2pGLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksVUFBVSxFQUFFLEVBQUU7WUFDbkMsSUFBSSxNQUFBO1lBQ0osT0FBTyxTQUFBO1lBQ1AsTUFBTSxRQUFBO1lBQ04sS0FBSyxPQUFBO1NBQ1IsQ0FBQyxDQUFDO0tBQ047Ozs7Ozs7SUFFTSxzQkFBYzs7Ozs7O0lBQXJCLFVBQXNCLEtBQWEsRUFBRSxPQUFpQixFQUFFLFVBQXNCO1FBQzFFLHFCQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDdEUsTUFBTSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDM0U7Ozs7Ozs7SUFFTSx1QkFBZTs7Ozs7O0lBQXRCLFVBQXVCLEtBQWEsRUFBRSxPQUFpQixFQUFFLFVBQXNCO1FBQzNFLHFCQUFJLElBQUksR0FBRyxHQUFHLENBQUM7UUFDZixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzFCLHFCQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQVgsQ0FBVyxDQUFDLENBQUM7WUFDMUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7U0FDN0MsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNUOzs7Ozs7O0lBRU0sdUJBQWU7Ozs7OztJQUF0QixVQUF1QixLQUFhLEVBQUUsT0FBaUIsRUFBRSxVQUFzQjtRQUMzRSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzFCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNaLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDZDtZQUNELHFCQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQVgsQ0FBVyxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDckcsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNUOzs7Ozs7O0lBRU0scUJBQWE7Ozs7OztJQUFwQixVQUFxQixLQUFhLEVBQUUsT0FBaUIsRUFBRSxVQUFzQjtRQUN6RSxxQkFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQVgsQ0FBVyxDQUFDLENBQUM7S0FDdkM7Ozs7Ozs7SUFFTSxvQkFBWTs7Ozs7O0lBQW5CLFVBQW9CLEtBQWEsRUFBRSxPQUFpQixFQUFFLFVBQXdCO1FBQzFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLEVBQUU7WUFDMUIsRUFBRSxDQUFDLENBQUMsR0FBRyxLQUFLLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLHFCQUFNLE1BQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQVgsQ0FBVyxDQUFDLENBQUM7Z0JBQzFDLHFCQUFNLEdBQUcsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsTUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsSUFBSSxJQUFJLE1BQUksQ0FBQyxPQUFPLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBbEQsQ0FBa0QsQ0FBQyxDQUFDO2dCQUNyRixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsTUFBSSxFQUFFO29CQUN6QyxVQUFVLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLFVBQVUsRUFBRSxFQUFFLE1BQUksQ0FBQyxVQUFVLEVBQUU7d0JBQ3pELElBQUksRUFBRSxHQUFHLENBQUMsSUFBSTt3QkFDZCxPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU87cUJBQ3ZCLENBQUM7aUJBQ0wsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7YUFDYjtZQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7U0FDZCxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsSUFBSSxPQUFPLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDMUU7Ozs7Ozs7O0lBRU0seUJBQWlCOzs7Ozs7O0lBQXhCLFVBQXlCLFVBQWtCLEVBQUUsU0FBaUIsRUFBRSxPQUFlLEVBQUUsVUFBa0I7UUFDL0YsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxDQUFDO1lBQy9DLHFCQUFNLFVBQVUsR0FBRyxvQkFBb0IsQ0FBQyxVQUFVLENBQUM7aUJBQzlDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxVQUFVLEVBQUUsRUFBRTtnQkFDdEMsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsTUFBTSxFQUFFLENBQUMsR0FBRyxVQUFVO2dCQUN0QixLQUFLLEVBQUUsQ0FBQyxHQUFHLFNBQVM7YUFDdkIsQ0FBQyxFQUxRLENBS1IsQ0FBQyxDQUFDO1lBQ1IsTUFBTSxrQkFBSyxHQUFHLEVBQUssVUFBVSxFQUFFO1NBQ2xDLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDVjs7Ozs7Ozs7O0lBRU0seUJBQWlCOzs7Ozs7OztJQUF4QixVQUF5QixLQUFrQixFQUFFLFVBQWtCLEVBQUUsVUFBc0IsRUFBRSxTQUFpQixFQUFFLFlBQW9CO1FBQzVILHFCQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDM0UsTUFBTSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHLEVBQUUsQ0FBQztZQUNwRSxxQkFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkgsS0FBSyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQ25ELE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDaEIsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNiOzs7Ozs7SUFFTSxxQkFBYTs7Ozs7SUFBcEIsVUFBcUIsS0FBYSxFQUFFLE9BQWdCO1FBQ2hELHFCQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzdFLHFCQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEVBQUUsRUFBSixDQUFJLENBQUMsQ0FBQztRQUVuQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHLEVBQUUsQ0FBQztZQUNsRCxxQkFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDeEYsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDZDtZQUNELHFCQUFNLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaksscUJBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1lBQy9CLEtBQUssR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3RHLE9BQU8sR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDakQsTUFBTSxrQkFBSyxHQUFHLEdBQUUsSUFBSSxHQUFFO1NBQ3pCLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDVjtJQUVELHNCQUFJLCtCQUFVOzs7O1FBQWQ7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQzdDOzs7T0FBQTtJQUVELHNCQUFJLDhCQUFTOzs7O1FBQWI7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1NBQy9DOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFVOzs7O1FBQWQ7WUFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUNyRTs7O09BQUE7SUFFRCxzQkFBSSwyQkFBTTs7OztRQUFWO1lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDdkI7Ozs7O1FBRUQsVUFBVyxLQUFjO1lBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6Qzs7O09BTEE7SUFPRCxzQkFBSSxtQ0FBYzs7OztRQUFsQjtZQUNJLE1BQU0sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3BHOzs7T0FBQTtJQUVELHNCQUFJLDBCQUFLOzs7O1FBQVQ7WUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUN0Qjs7Ozs7UUFFRCxVQUFVLEtBQWE7WUFDbkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNwRDs7O09BSkE7SUFNRCxzQkFBSSwrQkFBVTs7OztRQUFkO1lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztTQUM3Qzs7O09BQUE7a0JBL05MO0lBaU9DLENBQUE7QUE3TkQsbUJBNk5DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGlsZSB9IGZyb20gJy4uL3RpbGUvdGlsZS5tb2RlbCc7XHJcbmltcG9ydCB7IEltYWdlLCBEaW1lbnNpb25zLCBDb29yZGluYXRlcyB9IGZyb20gJy4uLy4uL3NoYXJlZC9tb2RlbHMnO1xyXG5pbXBvcnQgeyBpbnRlZ2VyQXJyYXksIHBvc2l0aXZlSW50ZWdlckFycmF5IH0gZnJvbSAnLi4vLi4vc2hhcmVkL3V0aWxzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2xsYWdlIHtcclxuICAgIGNhbnZhc0hlaWdodCA9IDA7XHJcbiAgICBjYW52YXNXaWR0aCA9IDA7XHJcbiAgICBtYXhDb2x1bW5zID0gNDtcclxuICAgIG1heFJvd3MgPSA0O1xyXG4gICAgdG90YWxDb2x1bW5zID0gMDtcclxuICAgIHRvdGFsUm93cyA9IDA7XHJcbiAgICBfaW1hZ2VzOiBJbWFnZVtdID0gW107XHJcbiAgICBfdGlsZXM6IFRpbGVbXSA9IFtdO1xyXG5cclxuICAgIHN0YXRpYyBBdmFpbGFibGVDb2x1bW5zKHN0YXJ0Um93OiBudW1iZXIsIHN0YXJ0Q29sdW1uOiBudW1iZXIsIG1heENvbHVtbnM6IG51bWJlciwgY2VsbHM6IGJvb2xlYW5bXVtdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCB0b3RhbENvbHVtbnMgPSBjZWxsc1swXS5sZW5ndGg7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnBvc2l0aXZlSW50ZWdlckFycmF5KG1heENvbHVtbnMpXHJcbiAgICAgICAgICAgIC5tYXAoayA9PiBrIDw9IG1heENvbHVtbnMgJiYgc3RhcnRDb2x1bW4gKyBrIDw9IHRvdGFsQ29sdW1ucyAmJiBjZWxsc1tzdGFydFJvd10gJiYgY2VsbHNbc3RhcnRSb3ddW3N0YXJ0Q29sdW1uICsga10gPyBrIDogMSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBBdmFpbGFibGVSb3dzKHN0YXJ0Um93OiBudW1iZXIsIHN0YXJ0Q29sdW1uOiBudW1iZXIsIG1heFJvd3M6IG51bWJlciwgY2VsbHM6IGJvb2xlYW5bXVtdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCB0b3RhbFJvd3MgPSBjZWxsc1swXS5sZW5ndGg7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KC4uLnBvc2l0aXZlSW50ZWdlckFycmF5KG1heFJvd3MpXHJcbiAgICAgICAgICAgIC5tYXAoayA9PiBrIDw9IG1heFJvd3MgJiYgc3RhcnRSb3cgKyBrIDw9IHRvdGFsUm93cyAmJiBjZWxsc1tzdGFydFJvdyArIGtdICYmIGNlbGxzW3N0YXJ0Um93ICsga11bc3RhcnRDb2x1bW5dID8gayA6IDEpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgQXZhaWxhYmxlRGltZW5zaW9ucyhcclxuICAgICAgICBkaW1lbnNpb25zOiBEaW1lbnNpb25zW10sXHJcbiAgICAgICAgc3RhcnRSb3c6IG51bWJlcixcclxuICAgICAgICBzdGFydENvbHVtbjogbnVtYmVyLFxyXG4gICAgICAgIG1heFJvd3M6IG51bWJlcixcclxuICAgICAgICBtYXhDb2x1bW5zOiBudW1iZXIsXHJcbiAgICAgICAgY2VsbHM6IGJvb2xlYW5bXVtdKTogRGltZW5zaW9uc1tdIHtcclxuICAgICAgICBjb25zdCBhdmFpbGFibGVSb3dzID0gQ29sbGFnZS5BdmFpbGFibGVSb3dzKHN0YXJ0Um93LCBzdGFydENvbHVtbiwgbWF4Um93cywgY2VsbHMpO1xyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZUNvbHVtbnMgPSBDb2xsYWdlLkF2YWlsYWJsZUNvbHVtbnMoc3RhcnRSb3csIHN0YXJ0Q29sdW1uLCBtYXhDb2x1bW5zLCBjZWxscyk7XHJcbiAgICAgICAgcmV0dXJuIGRpbWVuc2lvbnMuZmlsdGVyKHggPT4geC5yb3dzIDw9IGF2YWlsYWJsZVJvd3MgJiYgeC5jb2x1bW5zIDw9IGF2YWlsYWJsZUNvbHVtbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBCdWlsZChpbWFnZXM6IEltYWdlW10sIGNhbnZhc0hlaWdodCwgY2FudmFzV2lkdGgsIHRvdGFsUm93cyA9IDAsIHRvdGFsQ29sdW1ucyA9IDAsIG1heFJvd3MgPSAwLCBtYXhDb2x1bW5zID0gMCk6IENvbGxhZ2Uge1xyXG4gICAgICAgIGNvbnN0IGNvbGxhZ2UgPSBPYmplY3QuYXNzaWduKG5ldyBDb2xsYWdlKCksIHtcclxuICAgICAgICAgICAgY2FudmFzSGVpZ2h0LFxyXG4gICAgICAgICAgICBjYW52YXNXaWR0aCxcclxuICAgICAgICAgICAgdG90YWxSb3dzLFxyXG4gICAgICAgICAgICB0b3RhbENvbHVtbnMsXHJcbiAgICAgICAgICAgIG1heFJvd3MsXHJcbiAgICAgICAgICAgIG1heENvbHVtbnNcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb2xsYWdlLmltYWdlcyA9IGltYWdlcztcclxuICAgICAgICByZXR1cm4gY29sbGFnZTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgQnVpbGRFbXB0eUNlbGxzKHJvd3M6IG51bWJlciwgY29sczogbnVtYmVyKTogYm9vbGVhbltdW10ge1xyXG4gICAgICAgIHJldHVybiBpbnRlZ2VyQXJyYXkocm93cykubWFwKHggPT4gaW50ZWdlckFycmF5KGNvbHMpLm1hcCh5ID0+IHRydWUpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgQnVpbGRUaWxlcyhjb2xsYWdlOiBDb2xsYWdlKTogVGlsZVtdIHtcclxuICAgICAgICByZXR1cm4gY29sbGFnZS5pbWFnZXMubWFwKChpbWFnZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGltZW5zaW9ucyA9IENvbGxhZ2UuRmluZERpbWVuc2lvbnMoaW1hZ2UuaGVpZ2h0LCBpbWFnZS53aWR0aCwgY29sbGFnZS50aWxlRGltZW5zaW9ucywgY29sbGFnZS5jZWxsSGVpZ2h0LCBjb2xsYWdlLmNlbGxXaWR0aCk7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBUaWxlKCksIHtcclxuICAgICAgICAgICAgICAgIGltYWdlLFxyXG4gICAgICAgICAgICAgICAgZGltZW5zaW9ucyxcclxuICAgICAgICAgICAgICAgIGlkOiBpbmRleCArIDEsXHJcbiAgICAgICAgICAgICAgICBjZWxsSGVpZ2h0OiBjb2xsYWdlLmNlbGxIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBjZWxsV2lkdGg6IGNvbGxhZ2UuY2VsbFdpZHRoXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBDaG9vc2VUaWxlSWQoaWQ6IG51bWJlciwgdGlsZUlkczogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIFsuLi50aWxlSWRzLmZpbHRlcih4ID0+IHggIT09IGlkKSwgaWRdO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBGaW5kQ29vcmRpbmF0ZXMoaW5kZXg6IG51bWJlciwgdG90YWxSb3dzOiBudW1iZXIsIHRvdGFsQ29sdW1uczogbnVtYmVyKTogQ29vcmRpbmF0ZXMge1xyXG4gICAgICAgIGNvbnN0IHJlbWFpbmRlciA9IChpbmRleCArIHRvdGFsQ29sdW1ucykgJSB0b3RhbENvbHVtbnM7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcm93OiAoaW5kZXggLSByZW1haW5kZXIpIC8gdG90YWxDb2x1bW5zLFxyXG4gICAgICAgICAgICBjb2x1bW46IHJlbWFpbmRlclxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEZpbmRDb29yZGluYXRlc05lc3RlZChcclxuICAgICAgICBpbmRleDogbnVtYmVyLCB0b3RhbFJvd3M6IG51bWJlciwgdG90YWxDb2x1bW5zOiBudW1iZXIsIHN0YXJ0Um93OiBudW1iZXIsIHN0YXJ0Q29sdW1uOiBudW1iZXIpOiBDb29yZGluYXRlcyB7XHJcbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSBDb2xsYWdlLkZpbmRDb29yZGluYXRlcyhpbmRleCwgdG90YWxSb3dzLCB0b3RhbENvbHVtbnMpO1xyXG4gICAgICAgIGNvb3JkaW5hdGVzLmNvbHVtbiArPSBzdGFydENvbHVtbjtcclxuICAgICAgICBjb29yZGluYXRlcy5yb3cgKz0gc3RhcnRSb3c7XHJcbiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBGaW5kRGltZW5zaW9ucyhoZWlnaHQ6IG51bWJlciwgd2lkdGg6IG51bWJlciwgZGltZW5zaW9uczogRGltZW5zaW9uc1tdLCBjZWxsSGVpZ2h0OiBudW1iZXIsIGNlbGxXaWR0aDogbnVtYmVyKTogRGltZW5zaW9ucyB7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBkaW1lbnNpb25zLmZpbHRlcih4ID0+IHgucm93cyAqIGNlbGxIZWlnaHQgPD0gaGVpZ2h0ICYmIHguY29sdW1ucyAqIGNlbGxXaWR0aCA8PSB3aWR0aCk7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJlZCA9IGZpbHRlcmVkLnNvcnQoKGEsIGIpID0+IE1hdGguYWJzKGhlaWdodCAvIHdpZHRoIC0gYS5yYXRpbykgLSBNYXRoLmFicyhoZWlnaHQgLyB3aWR0aCAtIGIucmF0aW8pKTtcclxuICAgICAgICBjb25zdCBjbG9zZXN0TWF0Y2ggPSBvcmRlcmVkWzBdO1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSBjbG9zZXN0TWF0Y2ggJiYgY2xvc2VzdE1hdGNoLnJvd3MgPyBjbG9zZXN0TWF0Y2gucm93cyA6IFtdO1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSBjbG9zZXN0TWF0Y2ggJiYgY2xvc2VzdE1hdGNoLmNvbHVtbnMgPyBjbG9zZXN0TWF0Y2guY29sdW1ucyA6IFtdO1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBEaW1lbnNpb25zKCksIHtcclxuICAgICAgICAgICAgcm93cyxcclxuICAgICAgICAgICAgY29sdW1ucyxcclxuICAgICAgICAgICAgaGVpZ2h0LFxyXG4gICAgICAgICAgICB3aWR0aFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBGaW5kTmV4dFRpbGVJZCh0aWxlczogVGlsZVtdLCB0aWxlSWRzOiBudW1iZXJbXSwgZGltZW5zaW9uczogRGltZW5zaW9ucyk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgbmV4dE1hdGNoID0gQ29sbGFnZS5GaW5kTmV4dE1hdGNoSWQodGlsZXMsIHRpbGVJZHMsIGRpbWVuc2lvbnMpO1xyXG4gICAgICAgIHJldHVybiBuZXh0TWF0Y2ggfHwgQ29sbGFnZS5GaW5kQmVzdE1hdGNoSWQodGlsZXMsIHRpbGVJZHMsIGRpbWVuc2lvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBGaW5kQmVzdE1hdGNoSWQodGlsZXM6IFRpbGVbXSwgdGlsZUlkczogbnVtYmVyW10sIGRpbWVuc2lvbnM6IERpbWVuc2lvbnMpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBkaWZmID0gOTk5O1xyXG4gICAgICAgIHJldHVybiB0aWxlSWRzLnJlZHVjZSgoYWNjLCBpZCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0aWxlID0gdGlsZXMuZmluZCh4ID0+IHguaWQgPT09IGlkKTtcclxuICAgICAgICAgICAgZGlmZiA9IE1hdGguYWJzKHRpbGUucmF0aW8gLSBkaW1lbnNpb25zLnJhdGlvKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFjYyA9PT0gMCB8fCBkaWZmIDwgYWNjID8gaWQgOiBhY2M7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEZpbmROZXh0TWF0Y2hJZCh0aWxlczogVGlsZVtdLCB0aWxlSWRzOiBudW1iZXJbXSwgZGltZW5zaW9uczogRGltZW5zaW9ucyk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRpbGVJZHMucmVkdWNlKChhY2MsIGlkKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhY2MgIT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdGlsZSA9IHRpbGVzLmZpbmQoeCA9PiB4LmlkID09PSBpZCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aWxlICYmIHRpbGUucm93cyA9PT0gZGltZW5zaW9ucy5yb3dzICYmIHRpbGUuY29sdW1ucyA9PT0gZGltZW5zaW9ucy5jb2x1bW5zID8gdGlsZS5pZCA6IDA7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIEZpbmRCZXN0TWF0Y2godGlsZXM6IFRpbGVbXSwgdGlsZUlkczogbnVtYmVyW10sIGRpbWVuc2lvbnM6IERpbWVuc2lvbnMpOiBUaWxlIHtcclxuICAgICAgICBjb25zdCBpZCA9IENvbGxhZ2UuRmluZEJlc3RNYXRjaElkKHRpbGVzLCB0aWxlSWRzLCBkaW1lbnNpb25zKTtcclxuICAgICAgICByZXR1cm4gdGlsZXMuZmluZCh4ID0+IHguaWQgPT09IGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgRmluZE5leHRUaWxlKHRpbGVzOiBUaWxlW10sIHRpbGVJZHM6IG51bWJlcltdLCBkaW1lbnNpb25zOiBEaW1lbnNpb25zW10pOiBUaWxlIHtcclxuICAgICAgICByZXR1cm4gdGlsZUlkcy5yZWR1Y2UoKGFjYywgaWQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGFjYyA9PT0gbnVsbCB8fCBhY2MuaWQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRpbGUgPSB0aWxlcy5maW5kKHggPT4geC5pZCA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGltID0gZGltZW5zaW9ucy5maW5kKHggPT4gdGlsZS5yb3dzID09PSB4LnJvd3MgJiYgdGlsZS5jb2x1bW5zID09PSB4LmNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRpbSA/IE9iamVjdC5hc3NpZ24obmV3IFRpbGUoKSwgdGlsZSwge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbnM6IE9iamVjdC5hc3NpZ24obmV3IERpbWVuc2lvbnMoKSwgdGlsZS5kaW1lbnNpb25zLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3M6IGRpbS5yb3dzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBkaW0uY29sdW1uc1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9KSA6IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGFjYztcclxuICAgICAgICB9LCBuZXcgVGlsZSgpKSB8fCBDb2xsYWdlLkZpbmRCZXN0TWF0Y2godGlsZXMsIHRpbGVJZHMsIGRpbWVuc2lvbnNbMF0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBHZXRUaWxlRGltZW5zaW9ucyhjZWxsSGVpZ2h0OiBudW1iZXIsIGNlbGxXaWR0aDogbnVtYmVyLCBtYXhSb3dzOiBudW1iZXIsIG1heENvbHVtbnM6IG51bWJlcik6IERpbWVuc2lvbnNbXSB7XHJcbiAgICAgICAgcmV0dXJuIHBvc2l0aXZlSW50ZWdlckFycmF5KG1heFJvd3MpLnJlZHVjZSgoYWNjLCB4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpbWVuc2lvbnMgPSBwb3NpdGl2ZUludGVnZXJBcnJheShtYXhDb2x1bW5zKVxyXG4gICAgICAgICAgICAgICAgLm1hcCh5ID0+IE9iamVjdC5hc3NpZ24obmV3IERpbWVuc2lvbnMoKSwge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd3M6IHgsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogeSxcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHggKiBjZWxsSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB5ICogY2VsbFdpZHRoXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHJldHVybiBbLi4uYWNjLCAuLi5kaW1lbnNpb25zXTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIE1hcmtDZWxsc0FzRmlsbGVkKGNlbGxzOiBib29sZWFuW11bXSwgc3RhcnRJbmRleDogbnVtYmVyLCBkaW1lbnNpb25zOiBEaW1lbnNpb25zLCB0b3RhbFJvd3M6IG51bWJlciwgdG90YWxDb2x1bW5zOiBudW1iZXIpOiBib29sZWFuW11bXSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBDb2xsYWdlLkZpbmRDb29yZGluYXRlcyhzdGFydEluZGV4LCB0b3RhbFJvd3MsIHRvdGFsQ29sdW1ucyk7XHJcbiAgICAgICAgcmV0dXJuIGludGVnZXJBcnJheShkaW1lbnNpb25zLnJvd3MgKiBkaW1lbnNpb25zLmNvbHVtbnMpLnJlZHVjZSgoYWNjLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gQ29sbGFnZS5GaW5kQ29vcmRpbmF0ZXNOZXN0ZWQoaSwgZGltZW5zaW9ucy5yb3dzLCBkaW1lbnNpb25zLmNvbHVtbnMsIHN0YXJ0LnJvdywgc3RhcnQuY29sdW1uKTtcclxuICAgICAgICAgICAgY2VsbHNbY29vcmRpbmF0ZXMucm93XVtjb29yZGluYXRlcy5jb2x1bW5dID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybiBjZWxscztcclxuICAgICAgICB9LCBjZWxscyk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIFBvc2l0aW9uVGlsZXModGlsZXM6IFRpbGVbXSwgY29sbGFnZTogQ29sbGFnZSk6IFRpbGVbXSB7XHJcbiAgICAgICAgbGV0IGNlbGxzID0gQ29sbGFnZS5CdWlsZEVtcHR5Q2VsbHMoY29sbGFnZS50b3RhbFJvd3MsIGNvbGxhZ2UudG90YWxDb2x1bW5zKTtcclxuICAgICAgICBsZXQgdGlsZUlkcyA9IHRpbGVzLm1hcCh4ID0+IHguaWQpO1xyXG5cclxuICAgICAgICByZXR1cm4gaW50ZWdlckFycmF5KGNvbGxhZ2UudG90YWxDZWxscykucmVkdWNlKChhY2MsIGkpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSBDb2xsYWdlLkZpbmRDb29yZGluYXRlcyhpLCBjb2xsYWdlLnRvdGFsUm93cywgY29sbGFnZS50b3RhbENvbHVtbnMpO1xyXG4gICAgICAgICAgICBpZiAoIWNlbGxzW2Nvb3JkaW5hdGVzLnJvd11bY29vcmRpbmF0ZXMuY29sdW1uXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBhdmFpbGFibGVEaW1lbnNpb25zID0gQ29sbGFnZS5BdmFpbGFibGVEaW1lbnNpb25zKGNvbGxhZ2UudGlsZURpbWVuc2lvbnMsIGNvb3JkaW5hdGVzLnJvdywgY29vcmRpbmF0ZXMuY29sdW1uLCBjb2xsYWdlLm1heFJvd3MsIGNvbGxhZ2UubWF4Q29sdW1ucywgY2VsbHMpO1xyXG4gICAgICAgICAgICBjb25zdCB0aWxlID0gQ29sbGFnZS5GaW5kTmV4dFRpbGUodGlsZXMsIHRpbGVJZHMsIGF2YWlsYWJsZURpbWVuc2lvbnMpO1xyXG4gICAgICAgICAgICB0aWxlLmNvb3JkaW5hdGVzID0gY29vcmRpbmF0ZXM7XHJcbiAgICAgICAgICAgIGNlbGxzID0gQ29sbGFnZS5NYXJrQ2VsbHNBc0ZpbGxlZChjZWxscywgaSwgdGlsZS5kaW1lbnNpb25zLCBjb2xsYWdlLnRvdGFsUm93cywgY29sbGFnZS50b3RhbENvbHVtbnMpO1xyXG4gICAgICAgICAgICB0aWxlSWRzID0gQ29sbGFnZS5DaG9vc2VUaWxlSWQodGlsZS5pZCwgdGlsZUlkcyk7XHJcbiAgICAgICAgICAgIHJldHVybiBbLi4uYWNjLCB0aWxlXTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNlbGxIZWlnaHQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXNIZWlnaHQgLyB0aGlzLnRvdGFsUm93cztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2VsbFdpZHRoKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzV2lkdGggLyB0aGlzLnRvdGFsQ29sdW1ucztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZW1wdHlDZWxscygpOiBib29sZWFuW11bXSB7XHJcbiAgICAgICAgcmV0dXJuIENvbGxhZ2UuQnVpbGRFbXB0eUNlbGxzKHRoaXMudG90YWxSb3dzLCB0aGlzLnRvdGFsQ29sdW1ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGltYWdlcygpOiBJbWFnZVtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBpbWFnZXModmFsdWU6IEltYWdlW10pIHtcclxuICAgICAgICB0aGlzLl9pbWFnZXMgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnRpbGVzID0gQ29sbGFnZS5CdWlsZFRpbGVzKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0aWxlRGltZW5zaW9ucygpOiBEaW1lbnNpb25zW10ge1xyXG4gICAgICAgIHJldHVybiBDb2xsYWdlLkdldFRpbGVEaW1lbnNpb25zKHRoaXMuY2VsbEhlaWdodCwgdGhpcy5jZWxsV2lkdGgsIHRoaXMubWF4Um93cywgdGhpcy5tYXhDb2x1bW5zKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdGlsZXMoKTogVGlsZVtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdGlsZXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHRpbGVzKHZhbHVlOiBUaWxlW10pIHtcclxuICAgICAgICB0aGlzLl90aWxlcyA9IENvbGxhZ2UuUG9zaXRpb25UaWxlcyh2YWx1ZSwgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRvdGFsQ2VsbHMoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50b3RhbFJvd3MgKiB0aGlzLnRvdGFsQ29sdW1ucztcclxuICAgIH1cclxuXHJcbn1cclxuIl19